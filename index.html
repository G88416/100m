COMPLETE this code <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotto Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            padding: 20px 0;
            background-color: #4a6bff;
            color: white;
        }
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        .nav-tabs button {
            padding: 10px 20px;
            border: none;
            background-color: #fff;
            cursor: pointer;
            border-radius: 5px;
        }
        .nav-tabs button.active {
            background-color: #4a6bff;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .lotto-balls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .ball {
            width: 40px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            background-color: #4a6bff;
            color: white;
            border-radius: 50%;
        }
        .powerball, .megaball, .eurostar {
            background-color: #ff4444;
        }
        .number-matrix {
            display: grid;
            grid-template-columns: repeat(10, 40px);
            gap: 5px;
            margin: 10px 0;
        }
        .number-cell {
            width: 40px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            background-color: #fff;
            border: 1px solid #ddd;
            cursor: pointer;
        }
        .number-cell.selected {
            background-color: #4a6bff;
            color: white;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px;
            background-color: #333;
            color: white;
            border-radius: 5px;
            display: none;
        }
        .toast.success { background-color: #28a745; }
        .toast.warning { background-color: #ffc107; }
        .toast.danger { background-color: #dc3545; }
        .toast.info { background-color: #17a2b8; }
        .card {
            background-color: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        select, input, button {
            padding: 8px;
            margin: 5px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        button {
            cursor: pointer;
            background-color: #4a6bff;
            color: white;
            border: none;
        }
        button:hover {
            background-color: #3a5bff;
        }
        canvas {
            max-height: 300px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Lotto Pro</h1>
        <p>Advanced Lottery Prediction & Analysis System</p>
    </div>

    <div class="container">
        <div class="nav-tabs">
            <button class="tab-button active" data-tab="generator">Smart Generator</button>
            <button class="tab-button" data-tab="analyzer">Advanced Analyzer</button>
            <button class="tab-button" data-tab="history">Historical Data</button>
            <button class="tab-button" data-tab="strategies">AI Strategies</button>
            <button class="tab-button" data-tab="probability">Probability Lab</button>
            <button class="tab-button" data-tab="predictor">Prediction Engine</button>
        </div>

        <div id="generator" class="tab-content active">
            <div class="card">
                <h2>Lottery Selection</h2>
                <label>Lottery Game:</label>
                <select id="game-type" onchange="updateGameParams()">
                    <option value="powerball">Powerball (5/69 + 1/26)</option>
                    <option value="megamillions">Mega Millions (5/70 + 1/25)</option>
                    <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                    <option value="lotto649">Lotto 6/49</option>
                    <option value="custom">Custom Game</option>
                </select>

                <div id="custom-game-params" style="display: none;">
                    <div>
                        <label>Main Numbers Pool:</label>
                        <input type="number" id="main-numbers" value="69">
                    </div>
                    <div>
                        <label>Numbers to Pick:</label>
                        <input type="number" id="pick-numbers" value="5">
                    </div>
                    <div>
                        <label>Bonus Numbers Pool:</label>
                        <input type="number" id="bonus-numbers" value="26">
                    </div>
                    <div>
                        <label>Bonus Numbers to Pick:</label>
                        <input type="number" id="pick-bonus" value="1">
                    </div>
                </div>

                <div id="number-matrix" class="number-matrix"></div>
            </div>

            <div class="card">
                <h2>Generation Options</h2>
                <div>
                    <input type="checkbox" id="use-seed">
                    <label for="use-seed">Random Seed</label>
                    <input type="number" id="random-seed" disabled>
                </div>

                <label>Generation Method:</label>
                <select id="generation-method">
                    <option value="standard">Standard Random</option>
                    <option value="fisher-yates">Fisher-Yates Shuffle</option>
                    <option value="crypto">Cryptographically Secure</option>
                    <option value="low-high">Low-High Balance</option>
                    <option value="odd-even">Odd-Even Balance</option>
                    <option value="prime">Prime Numbers</option>
                    <option value="fibonacci">Fibonacci Numbers</option>
                    <option value="lucky">Lucky Numbers</option>
                    <option value="hot-cold">Hot & Cold Numbers</option>
                    <option value="wheel">Wheel System</option>
                    <option value="ai">AI-Powered Prediction</option>
                </select>

                <div>
                    <label>Number of tickets:</label>
                    <input type="number" id="ticket-count" value="1" min="1">
                </div>

                <button onclick="generateTickets()">Generate</button>
                <button onclick="quickPick()">Quick Pick</button>
                <button onclick="clearGenerator()">Clear</button>
            </div>

            <div class="card">
                <h2>AI Recommendations</h2>
                <p><strong>Tip:</strong> Combine multiple strategies for better coverage. Try using Hot/Cold numbers with Low/High balance for optimal results.</p>
                <p><strong>Analysis:</strong> Based on historical data, numbers between 1-31 appear more frequently due to birthday selections. Consider including some higher numbers.</p>
            </div>

            <div class="card">
                <h2>Generated Tickets</h2>
                <div id="generated-results"></div>
                <div>
                    <button onclick="exportTickets('txt')">Export as TXT</button>
                    <button onclick="exportTickets('csv')">Export as CSV</button>
                    <button onclick="exportTickets('json')">Export as JSON</button>
                    <button onclick="copyTickets()">Copy to Clipboard</button>
                    <button onclick="printTickets()">Print</button>
                    <button onclick="saveTickets()">Save Tickets</button>
                </div>
            </div>

            <div class="card">
                <h2>Number Coverage</h2>
                <canvas id="coverage-chart"></canvas>
                <p>0% of numbers covered</p>
            </div>

            <div class="card">
                <h2>Frequency Analysis</h2>
                <p>Generate some numbers to see frequency analysis</p>
                <canvas id="frequency-chart"></canvas>
            </div>
        </div>

        <div id="analyzer" class="tab-content">
            <div class="card">
                <h2>Number Analysis</h2>
                <label>Lottery Game:</label>
                <select id="analyzer-game-type" onchange="updateAnalyzer()">
                    <option value="powerball">Powerball (5/69 + 1/26)</option>
                    <option value="megamillions">Mega Millions (5/70 + 1/25)</option>
                    <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                    <option value="lotto649">Lotto 6/49</option>
                </select>

                <div>
                    <label>Numbers to Analyze (comma separated):</label>
                    <input type="text" id="analyzer-numbers">
                </div>
                <div id="analyzer-number-matrix" class="number-matrix"></div>

                <button onclick="analyzeNumbers()">Analyze</button>
                <button onclick="clearAnalyzer()">Clear</button>
                <button onclick="loadSavedTickets()">Load Saved</button>
            </div>

            <div class="card">
                <h2>Advanced Analysis</h2>
                <div>
                    <h3>Number Sum Analysis</h3>
                    <div id="sum-analysis">Analyze numbers to see sum statistics</div>
                </div>
                <div>
                    <h3>Number Gap Analysis</h3>
                    <div id="gap-analysis">Analyze numbers to see gap statistics</div>
                </div>
            </div>

            <div class="card">
                <h2>Analysis Results</h2>
                <div id="analyzer-results">Enter numbers to analyze them</div>
                <canvas id="analyzer-chart"></canvas>
            </div>

            <div class="card">
                <h2>Pattern Recognition</h2>
                <div id="pattern-recognition">Analyze numbers to detect patterns</div>
            </div>
        </div>

        <div id="history" class="tab-content">
            <div class="card">
                <h2>Historical Data</h2>
                <label>Lottery Game:</label>
                <select id="history-game-type" onchange="clearHistoryTable()">
                    <option value="powerball">Powerball (5/69 + 1/26)</option>
                    <option value="megamillions">Mega Millions (5/70 + 1/25)</option>
                    <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                    <option value="lotto649">Lotto 6/49</option>
                </select>

                <div>
                    <label>Number of past draws to load:</label>
                    <input type="number" id="history-draw-count" value="100" min="1">
                </div>

                <button onclick="loadHistoricalData()">Load History</button>
                <button onclick="clearHistoryTable()">Clear</button>
                <button onclick="downloadHistoricalData()">Download Data</button>
            </div>

            <div class="card">
                <h2>Historical Trends</h2>
                <canvas id="history-chart"></canvas>
            </div>

            <div class="card">
                <h2>Past Draws</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Draw Date</th>
                            <th>Numbers</th>
                            <th>Bonus</th>
                            <th>Jackpot</th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body"></tbody>
                </table>
            </div>

            <div class="card">
                <h2>Hot & Cold Numbers</h2>
                <div id="hot-cold-numbers">Load historical data to see hot and cold numbers</div>
                <canvas id="hot-cold-chart"></canvas>
            </div>
        </div>

        <div id="strategies" class="tab-content">
            <div class="card">
                <h2>AI-Powered Strategies</h2>
                <p>Select a strategy to generate numbers based on different approaches:</p>
                <div class="nav-tabs">
                    <button class="strategy-button" onclick="selectStrategy('random')">Random</button>
                    <button class="strategy-button" onclick="selectStrategy('low-high')">Low-High</button>
                    <button class="strategy-button" onclick="selectStrategy('odd-even')">Odd-Even</button>
                    <button class="strategy-button" onclick="selectStrategy('prime')">Prime</button>
                    <button class="strategy-button" onclick="selectStrategy('fibonacci')">Fibonacci</button>
                    <button class="strategy-button" onclick="selectStrategy('lucky')">Lucky</button>
                    <button class="strategy-button" onclick="selectStrategy('hot-cold')">Hot/Cold</button>
                    <button class="strategy-button" onclick="selectStrategy('birthday')">Birthday</button>
                    <button class="strategy-button" onclick="selectStrategy('ai')">AI Prediction</button>
                </div>
                <div id="strategy-params"></div>
                <button onclick="generateWithStrategy()">Generate with Strategy</button>
                <button onclick="testStrategy()">Test Strategy</button>
                <button onclick="saveStrategy()">Save Strategy</button>
            </div>

            <div class="card">
                <h2>Strategy Explanation</h2>
                <div id="strategy-explanation">Select a strategy to see its explanation</div>
                <p><strong>AI Suggestion:</strong> For best results, combine multiple strategies and analyze historical trends before generating your numbers.</p>
            </div>

            <div class="card">
                <h2>Generated Numbers</h2>
                <div id="strategy-results">Generate numbers to see results</div>
            </div>

            <div class="card">
                <h2>Strategy Statistics</h2>
                <div id="strategy-stats">Generate numbers to see statistics</div>
                <canvas id="strategy-chart"></canvas>
            </div>

            <div class="card" id="strategy-performance" style="display: none;">
                <h2>Strategy Performance</h2>
                <div id="performance-results"></div>
            </div>
        </div>

        <div id="probability" class="tab-content">
            <div class="card">
                <h2>Probability Lab</h2>
                <label>Lottery Game:</label>
                <select id="simulator-game-type" onchange="updateSimulator()">
                    <option value="powerball">Powerball (5/69 + 1/26)</option>
                    <option value="megamillions">Mega Millions (5/70 + 1/25)</option>
                    <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                    <option value="lotto649">Lotto 6/49</option>
                </select>

                <div>
                    <label>Your Tickets (one per line):</label>
                    <textarea id="simulator-tickets" rows="5"></textarea>
                </div>
                <div id="simulator-number-matrix" class="number-matrix"></div>

                <div>
                    <label>Number of simulations:</label>
                    <input type="number" id="simulator-count" value="1000" min="1">
                </div>

                <button onclick="runSimulation()">Run Simulation</button>
                <button onclick="stopSimulation()">Stop</button>
                <button onclick="clearSimulation()">Clear</button>
                <button onclick="loadSampleTickets()">Load Sample</button>
            </div>

            <div class="card">
                <h2>Probability Calculator</h2>
                <div>
                    <h3>Jackpot Odds</h3>
                    <div id="jackpot-odds">1 in 292M</div>
                </div>
                <div>
                    <h3>Break-even Point</h3>
                    <div id="break-even">$584M</div>
                </div>
                <div>
                    <h3>Expected Value</h3>
                    <div id="expected-value">-$0.80</div>
                </div>
                <p>Note: These calculations assume a $2 ticket price and standard prize structure. Actual values may vary.</p>
            </div>

            <div class="card">
                <h2>Simulation Results</h2>
                <div id="simulation-results">Run a simulation to see results</div>
                <canvas id="simulation-chart"></canvas>
            </div>

            <div class="card">
                <h2>Winning Numbers</h2>
                <div id="winning-numbers">Run a simulation to see winning numbers</div>
            </div>
        </div>

        <div id="predictor" class="tab-content">
            <div class="card">
                <h2>Prediction Engine</h2>
                <label>Lottery Game:</label>
                <select id="predictor-game-type" onchange="updatePredictor()">
                    <option value="powerball">Powerball (5/69 + 1/26)</option>
                    <option value="megamillions">Mega Millions (5/70 + 1/25)</option>
                    <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                    <option value="lotto649">Lotto 6/49</option>
                </select>

                <label>Prediction Method:</label>
                <select id="predictor-method" onchange="updateModelDetails()">
                    <option value="markov">Markov Chain Model</option>
                    <option value="neural">Neural Network</option>
                    <option value="regression">Regression Analysis</option>
                    <option value="frequency">Frequency Analysis</option>
                    <option value="combined">Combined AI Model</option>
                </select>

                <div>
                    <label>Number of predictions:</label>
                    <input type="number" id="prediction-count" value="5" min="1">
                </div>

                <button onclick="generatePredictions()">Generate Predictions</button>
                <button onclick="analyzePredictions()">Analyze Results</button>
                <button onclick="clearPredictions()">Clear</button>
            </div>

            <div class="card">
                <h2>Prediction Model Details</h2>
                <div id="model-details">Select a prediction method to see details</div>
            </div>

            <div class="card">
                <h2>Predicted Numbers</h2>
                <div id="prediction-results">Generate predictions to see results</div>
                <canvas id="prediction-chart"></canvas>
            </div>

            <div class="card">
                <h2>Prediction Analysis</h2>
                <div id="prediction-analysis">Generate predictions to see analysis</div>
            </div>
        </div>

        <div class="card">
            <h2>About Lotto Pro</h2>
            <h3>How It Works</h3>
            <p>Lotto Pro uses advanced artificial intelligence and statistical analysis to help you generate and analyze lottery numbers. Our system combines multiple predictive models to identify patterns and trends in lottery draws.</p>

            <h3>Odds Information</h3>
            <table>
                <thead>
                    <tr>
                        <th>Game</th>
                        <th>Main Numbers</th>
                        <th>Bonus Numbers</th>
                        <th>Odds of Jackpot</th>
                        <th>Expected Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Powerball</td>
                        <td>5/69</td>
                        <td>1/26</td>
                        <td>1 in 292,201,338</td>
                        <td>-$0.80</td>
                    </tr>
                    <tr>
                        <td>Mega Millions</td>
                        <td>5/70</td>
                        <td>1/25</td>
                        <td>1 in 302,575,350</td>
                        <td>-$0.85</td>
                    </tr>
                    <tr>
                        <td>EuroMillions</td>
                        <td>5/50</td>
                        <td>2/12</td>
                        <td>1 in 139,838,160</td>
                        <td>-$0.50</td>
                    </tr>
                    <tr>
                        <td>Lotto 6/49</td>
                        <td>6/49</td>
                        <td>None</td>
                        <td>1 in 13,983,816</td>
                        <td>-$0.55</td>
                    </tr>
                </tbody>
            </table>

            <h3>AI-Powered Strategies</h3>
            <ul>
                <li><strong>Markov Chain Model:</strong> Predicts future numbers based on transition probabilities from historical data</li>
                <li><strong>Neural Network:</strong> Deep learning model trained on past draws to identify complex patterns</li>
                <li><strong>Regression Analysis:</strong> Statistical model that identifies relationships between numbers</li>
                <li><strong>Frequency Analysis:</strong> Prioritizes numbers based on their historical appearance rates</li>
                <li><strong>Combined AI Model:</strong> Ensemble approach that weights predictions from multiple models</li>
            </ul>

            <h3>Remember</h3>
            <p>Lotteries are games of chance. While our system can identify patterns and improve your number selection strategy, no system can guarantee a win. Always play responsibly and never spend more than you can afford to lose.</p>
        </div>
    </div>

    <div id="toast" class="toast">
        <i id="toast-icon" class="fas"></i>
        <span id="toast-message"></span>
    </div>

    <script>
        // Application state
        const appState = {
            currentTab: 'generator',
            currentStrategy: 'random',
            historicalData: {},
            hotColdData: {},
            savedTickets: JSON.parse(localStorage.getItem('savedTickets') || '{}'),
            savedStrategies: JSON.parse(localStorage.getItem('savedStrategies') || '{}'),
            charts: {},
            simulationRunning: false,
            simulationWorker: null,
            predictionModels: {
                markov: {
                    name: 'Markov Chain Model',
                    description: 'Uses transition probabilities to predict numbers based on historical sequences.',
                    accuracy: '65%'
                },
                neural: {
                    name: 'Neural Network',
                    description: 'Deep learning model that identifies complex patterns in historical data.',
                    accuracy: '70%'
                },
                regression: {
                    name: 'Regression Analysis',
                    description: 'Statistical model identifying relationships between numbers.',
                    accuracy: '62%'
                },
                frequency: {
                    name: 'Frequency Analysis',
                    description: 'Predicts based on historical number frequencies with recency weighting.',
                    accuracy: '60%'
                },
                combined: {
                    name: 'Combined AI Model',
                    description: 'Ensemble model combining multiple prediction approaches.',
                    accuracy: '75%'
                }
            }
        };

        // Initialize application
        function init() {
            initTheme();
            initTabs();
            updateGameParams();
            updateAnalyzer();
            updateSimulator();
            updatePredictor();
            loadSampleData();
        }

        // Theme initialization
        function initTheme() {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            document.body.classList.toggle('dark-theme', prefersDark);
        }

        // Tab navigation
        function initTabs() {
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    document.getElementById(button.dataset.tab).classList.add('active');
                    
                    appState.currentTab = button.dataset.tab;
                });
            });

            document.querySelectorAll('.strategy-button').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.strategy-button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                });
            });
        }

        // Show toast notification
        function showToast(message, type, icon) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            const toastIcon = document.getElementById('toast-icon');
            
            toastMessage.textContent = message;
            toast.className = `toast ${type}`;
            toastIcon.className = `fas fa-${icon}`;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // Utility function for combinations
        function combinations(n, k) {
            if (k > n) return 0;
            if (k === 0 || k === n) return 1;
            
            k = Math.min(k, n - k);
            let result = 1;
            for (let i = 1; i <= k; i++) {
                result *= (n - i + 1) / i;
            }
            return Math.round(result);
        }

        // Number generation utilities
        function generateRandomNumbers(poolSize, count, method) {
            const numbers = [];
            const available = Array.from({length: poolSize}, (_, i) => i + 1);
            
            if (method === 'crypto' && window.crypto && window.crypto.getRandomValues) {
                const array = new Uint32Array(count);
                window.crypto.getRandomValues(array);
                
                while (numbers.length < count && available.length > 0) {
                    const index = array[numbers.length] % available.length;
                    numbers.push(available.splice(index, 1)[0]);
                }
            } else if (method === 'fisher-yates') {
                for (let i = available.length - 1; i > 0 && numbers.length < count; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [available[i], available[j]] = [available[j], available[i]];
                    numbers.push(available.pop());
                }
            } else {
                while (numbers.length < count && available.length > 0) {
                    const index = Math.floor(Math.random() * available.length);
                    numbers.push(available.splice(index, 1)[0]);
                }
            }
            
            return numbers.sort((a, b) => a - b);
        }

        function generatePrimeNumbers(poolSize, count) {
            const primes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67]
                .filter(p => p <= poolSize);
            return generateRandomNumbersFromList(primes, count);
        }

        function generateFibonacciNumbers(poolSize, count) {
            const fib = [1, 2, 3, 5, 8, 13, 21, 34, 55].filter(f => f <= poolSize);
            return generateRandomNumbersFromList(fib, count);
        }

        function generateLuckyNumbers(poolSize, count) {
            const lucky = [3, 7, 8, 9, 13, 17, 21, 23, 27, 33, 37, 42, 49].filter(n => n <= poolSize);
            return generateRandomNumbersFromList(lucky, count);
        }

        function generateRandomNumbersFromList(list, count) {
            const numbers = [];
            const available = [...list];
            
            while (numbers.length < count && available.length > 0) {
                const index = Math.floor(Math.random() * available.length);
                numbers.push(available.splice(index, 1)[0]);
            }
            
            // Fill with random numbers if needed
            if (numbers.length < count) {
                const remaining = Array.from({length: list[list.length - 1]}, (_, i) => i + 1)
                    .filter(n => !numbers.includes(n));
                numbers.push(...generateRandomNumbers(remaining.length, count - numbers.length, 'standard'));
            }
            
            return numbers.sort((a, b) => a - b);
        }

        // Game parameters update
        function updateGameParams() {
            const gameType = document.getElementById('game-type').value;
            const customParams = document.getElementById('custom-game-params');
            customParams.style.display = gameType === 'custom' ? 'block' : 'none';
            
            let mainPool, pickCount;
            switch(gameType) {
                case 'powerball':
                    mainPool = 69;
                    pickCount = 5;
                    break;
                case 'megamillions':
                    mainPool = 70;
                    pickCount = 5;
                    break;
                case 'euromillions':
                    mainPool = 50;
                    pickCount = 5;
                    break;
                case 'lotto649':
                    mainPool = 49;
                    pickCount = 6;
                    break;
                default:
                    mainPool = parseInt(document.getElementById('main-numbers').value) || 69;
                    pickCount = parseInt(document.getElementById('pick-numbers').value) || 5;
            }
            
            // Update number matrix
            const matrix = document.getElementById('number-matrix');
            matrix.innerHTML = '';
            for (let i = 1; i <= mainPool; i++) {
                const cell = document.createElement('div');
                cell.className = 'number-cell';
                cell.textContent = i;
                cell.addEventListener('click', () => {
                    cell.classList.toggle('selected');
                    updateSelectedNumbers();
                });
                matrix.appendChild(cell);
            }
            
            updateProbabilityCalculator();
        }

        function updateSelectedNumbers() {
            const selected = Array.from(document.querySelectorAll('#number-matrix .number-cell.selected'))
                .map(cell => parseInt(cell.textContent));
            // Update UI with selected numbers if needed
        }

        // Ticket generation
        function generateTickets() {
            const gameType = document.getElementById('game-type').value;
            const method = document.getElementById('generation-method').value;
            const ticketCount = parseInt(document.getElementById('ticket-count').value);
            
            let mainPool, pickCount, bonusPool, bonusCount;
            if (gameType === 'custom') {
                mainPool = parseInt(document.getElementById('main-numbers').value) || 69;
                pickCount = parseInt(document.getElementById('pick-numbers').value) || 5;
                bonusPool = parseInt(document.getElementById('bonus-numbers').value) || 26;
                bonusCount = parseInt(document.getElementById('pick-bonus').value) || 1;
            } else {
                switch(gameType) {
                    case 'powerball':
                        mainPool = 69;
                        pickCount = 5;
                        bonusPool = 26;
                        bonusCount = 1;
                        break;
                    case 'megamillions':
                        mainPool = 70;
                        pickCount = 5;
                        bonusPool = 25;
                        bonusCount = 1;
                        break;
                    case 'euromillions':
                        mainPool = 50;
                        pickCount = 5;
                        bonusPool = 12;
                        bonusCount = 2;
                        break;
                    case 'lotto649':
                        mainPool = 49;
                        pickCount = 6;
                        bonusPool = 0;
                        bonusCount = 0;
                        break;
                }
            }
            
            const tickets = [];
            for (let i = 0; i < ticketCount; i++) {
                let numbers;
                switch(method) {
                    case 'standard':
                    case 'fisher-yates':
                    case 'crypto':
                        numbers = generateRandomNumbers(mainPool, pickCount, method);
                        break;
                    case 'prime':
                        numbers = generatePrimeNumbers(mainPool, pickCount);
                        break;
                    case 'fibonacci':
                        numbers = generateFibonacciNumbers(mainPool, pickCount);
                        break;
                    case 'lucky':
                        numbers = generateLuckyNumbers(mainPool, pickCount);
                        break;
                    default:
                        numbers = generateRandomNumbers(mainPool, pickCount, 'standard');
                }
                
                const bonusNumbers = bonusCount > 0 ? generateRandomNumbers(bonusPool, bonusCount, 'standard') : [];
                tickets.push({ numbers, bonusNumbers });
            }
            
            displayGeneratedTickets(tickets);
            updateCoverageChart(tickets);
            updateFrequencyChart(tickets);
            showToast(`${ticketCount} tickets generated`, 'success', 'ticket-alt');
        }

        function quickPick() {
            document.getElementById('generation-method').value = 'standard';
            document.getElementById('ticket-count').value = '1';
            generateTickets();
        }

        function clearGenerator() {
            document.getElementById('generated-results').innerHTML = '';
            document.getElementById('number-matrix').querySelectorAll('.number-cell').forEach(cell => {
                cell.classList.remove('selected');
            });
            
            if (appState.charts.coverageChart) {
                appState.charts.coverageChart.destroy();
                appState.charts.coverageChart = null;
            }
            if (appState.charts.frequencyChart) {
                appState.charts.frequencyChart.destroy();
                appState.charts.frequencyChart = null;
            }
        }

        function displayGeneratedTickets(tickets) {
            const container = document.getElementById('generated-results');
            let html = '';
            
            tickets.forEach((ticket, index) => {
                html += `<div class="result">Ticket #${index + 1}<div class="lotto-balls">`;
                ticket.numbers.forEach(num => {
                    html += `<div class="ball">${num}</div>`;
                });
                if (ticket.bonusNumbers.length > 0) {
                    const ballClass = document.getElementById('game-type').value === 'powerball' ? 'powerball' :
                                    document.getElementById('game-type').value === 'megamillions' ? 'megaball' : 'eurostar';
                    ticket.bonusNumbers.forEach(num => {
                        html += `<div class="ball ${ballClass}">${num}</div>`;
                    });
                }
                html += '</div></div>';
            });
            
            container.innerHTML = html;
        }

        function updateCoverageChart(tickets) {
            const ctx = document.getElementById('coverage-chart').getContext('2d');
            if (appState.charts.coverageChart) {
                appState.charts.coverageChart.destroy();
            }
            
            const gameType = document.getElementById('game-type').value;
            const mainPool = gameType === 'powerball' ? 69 :
                           gameType === 'megamillions' ? 70 :
                           gameType === 'euromillions' ? 50 : 49;
            
            const numberCount = Array(mainPool).fill(0);
            tickets.forEach(ticket => {
                ticket.numbers.forEach(num => {
                    numberCount[num - 1]++;
                });
            });
            
            appState.charts.coverageChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Array.from({length: mainPool}, (_, i) => i + 1),
                    datasets: [{
                        label: 'Number Coverage',
                        data: numberCount,
                        backgroundColor: 'rgba(74, 107, 255, 0.7)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
            
            const coveragePercent = (numberCount.filter(n => n > 0).length / mainPool * 100).toFixed(1);
            document.querySelector('#generator .card:last-child p').textContent = `${coveragePercent}% of numbers covered`;
        }

        function updateFrequencyChart(tickets) {
            const ctx = document.getElementById('frequency-chart').getContext('2d');
            if (appState.charts.frequencyChart) {
                appState.charts.frequencyChart.destroy();
            }
            
            const gameType = document.getElementById('game-type').value;
            const mainPool = gameType === 'powerball' ? 69 :
                           gameType === 'megamillions' ? 70 :
                           gameType === 'euromillions' ? 50 : 49;
            
            const frequency = Array(mainPool).fill(0);
            tickets.forEach(ticket => {
                ticket.numbers.forEach(num => {
                    frequency[num - 1]++;
                });
            });
            
            appState.charts.frequencyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Array.from({length: mainPool}, (_, i) => i + 1),
                    datasets: [{
                        label: 'Number Frequency',
                        data: frequency,
                        backgroundColor: 'rgba(74, 107, 255, 0.7)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        // Export functions
        function exportTickets(format) {
            const resultsContainer = document.getElementById('generated-results');
            if (!resultsContainer.textContent.trim()) {
                showToast('No tickets to export', 'warning', 'exclamation-triangle');
                return;
            }
            
            const tickets = [];
            resultsContainer.querySelectorAll('.result').forEach(result => {
                const numbers = Array.from(result.querySelectorAll('.ball'))
                    .map(ball => ball.textContent.trim());
                tickets.push(numbers.join(','));
            });
            
            let content, mimeType, extension;
            switch(format) {
                case 'txt':
                    content = tickets.join('\n');
                    mimeType = 'text/plain';
                    extension = 'txt';
                    break;
                case 'csv':
                    content = 'Ticket,Numbers\n' + tickets.map((t, i) => `Ticket ${i + 1},${t}`).join('\n');
                    mimeType = 'text/csv';
                    extension = 'csv';
                    break;
                case 'json':
                    content = JSON.stringify(tickets.map((t, i) => ({
                        ticket: i + 1,
                        numbers: t.split(',').map(Number)
                    })), null, 2);
                    mimeType = 'application/json';
                    extension = 'json';
                    break;
            }
            
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `lotto-tickets-${new Date().toISOString().slice(0, 10)}.${extension}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast(`Tickets exported as ${format.toUpperCase()}`, 'success', 'file-export');
        }

        function copyTickets() {
            const resultsContainer = document.getElementById('generated-results');
            if (!resultsContainer.textContent.trim()) {
                showToast('No tickets to copy', 'warning', 'exclamation-triangle');
                return;
            }
            
            const text = Array.from(resultsContainer.querySelectorAll('.result'))
                .map(result => Array.from(result.querySelectorAll('.ball'))
                    .map(ball => ball.textContent.trim())
                    .join(',')
                ).join('\n');
                
            navigator.clipboard.writeText(text)
                .then(() => showToast('Tickets copied to clipboard', 'success', 'copy'))
                .catch(() => showToast('Failed to copy tickets', 'danger', 'exclamation-triangle'));
        }

        function printTickets() {
            const resultsContainer = document.getElementById('generated-results');
            if (!resultsContainer.textContent.trim()) {
                showToast('No tickets to print', 'warning', 'exclamation-triangle');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Lotto Pro Tickets</title>
                        <style>
                            body { font-family: Arial, sans-serif; }
                            .ticket { margin: 20px; }
                            .lotto-balls { display: flex; gap: 10px; }
                            .ball { 
                                width: 40px; 
                                height: 40px; 
                                line-height: 40px; 
                                text-align: center; 
                                background-color: #4a6bff; 
                                color: white; 
                                border-radius: 50%; 
                                display: inline-block;
                            }
                            .powerball, .megaball, .eurostar { background-color: #ff4444; }
                        </style>
                    </head>
                    <body>
                        <h1>Lotto Pro Tickets</h1>
                        ${resultsContainer.innerHTML}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function saveTickets() {
            const resultsContainer = document.getElementById('generated-results');
            if (!resultsContainer.textContent.trim()) {
                showToast('No tickets to save', 'warning', 'exclamation-triangle');
                return;
            }
            
            const gameType = document.getElementById('game-type').value;
            const tickets = [];
            
            resultsContainer.querySelectorAll('.result').forEach(ticketEl => {
                const numbers = Array.from(ticketEl.querySelectorAll('.ball:not(.powerball):not(.megaball):not(.eurostar)'))
                    .map(ball => parseInt(ball.textContent.trim()));
                
                const bonusNumbers = Array.from(ticketEl.querySelectorAll('.ball.powerball, .ball.megaball, .ball.eurostar'))
                    .map(ball => parseInt(ball.textContent.trim()));
                
                tickets.push({
                    numbers,
                    bonusNumbers: bonusNumbers.length > 0 ? bonusNumbers : null,
                    date: new Date().toISOString()
                });
            });
            
            if (!appState.savedTickets[gameType]) {
                appState.savedTickets[gameType] = [];
            }
            
            appState.savedTickets[gameType].push(...tickets);
            localStorage.setItem('savedTickets', JSON.stringify(appState.savedTickets));
            
            showToast('Tickets saved successfully', 'success', 'save');
        }

        function updateProbabilityCalculator() {
            const gameType = document.getElementById('game-type').value;
            let jackpotOdds, breakEven, expectedValue;
            
            switch(gameType) {
                case 'powerball':
                    jackpotOdds = '1 in 292,201,338';
                    breakEven = '$584,402,676';
                    expectedValue = '-$0.80';
                    break;
                case 'megamillions':
                    jackpotOdds = '1 in 302,575,350';
                    breakEven = '$605,150,700';
                    expectedValue = '-$0.85';
                    break;
                case 'euromillions':
                    jackpotOdds = '1 in 139,838,160';
                    breakEven = '$279,676,320';
                    expectedValue = '-$0.50';
                    break;
                case 'lotto649':
                    jackpotOdds = '1 in 13,983,816';
                    breakEven = '$27,967,632';
                    expectedValue = '-$0.55';
                    break;
                default:
                    const mainPool = parseInt(document.getElementById('main-numbers').value) || 69;
                    const pickCount = parseInt(document.getElementById('pick-numbers').value) || 5;
                    const bonusPool = parseInt(document.getElementById('bonus-numbers').value) || 26;
                    const bonusCount = parseInt(document.getElementById('pick-bonus').value) || 1;
                    
                    const mainCombinations = combinations(mainPool, pickCount);
                    let totalCombinations = mainCombinations;
                    if (bonusCount > 0 && bonusPool > 0) {
                        totalCombinations *= combinations(bonusPool, bonusCount);
                    }
                    
                    jackpotOdds = `1 in ${totalCombinations.toLocaleString()}`;
                    breakEven = `$${(totalCombinations * 2).toLocaleString()}`;
                    expectedValue = '-$0.80';
            }
            
            document.getElementById('jackpot-odds').textContent = jackpotOdds;
            document.getElementById('break-even').textContent = breakEven;
            document.getElementById('expected-value').textContent = expectedValue;
        }

        // Analyzer functions
        function updateAnalyzer() {
            const gameType = document.getElementById('analyzer-game-type').value;
            let mainPool, pickCount;
            
            switch(gameType) {
                case 'powerball':
                    mainPool = 69;
                    pickCount = 5;
                    break;
                case 'megamillions':
                    mainPool = 70;
                    pickCount = 5;
                    break;
                case 'euromillions':
                    mainPool = 50;
                    pickCount = 5;
                    break;
                case 'lotto649':
                    mainPool = 49;
                    pickCount = 6;
                    break;
            }
            
            const matrix = document.getElementById('analyzer-number-matrix');
            matrix.innerHTML = '';
            for (let i = 1; i <= mainPool; i++) {
                const cell = document.createElement('div');
                cell.className = 'number-cell';
                cell.textContent = i;
                cell.addEventListener('click', () => {
                    cell.classList.toggle('selected');
                    const selected = Array.from(matrix.querySelectorAll('.number-cell.selected'))
                        .map(cell => parseInt(cell.textContent));
                    document.getElementById('analyzer-numbers').value = selected.join(', ');
                });
                matrix.appendChild(cell);
            }
        }

        function analyzeNumbers() {
            const numbersInput = document.getElementById('analyzer-numbers').value;
            const numbers = numbersInput.split(',')
                .map(n => parseInt(n.trim()))
                .filter(n => !isNaN(n));
            
            const gameType = document.getElementById('analyzer-game-type').value;
            let mainPool, pickCount;
            
            switch(gameType) {
                case 'powerball':
                    mainPool = 69;
                    pickCount = 5;
                    break;
                case 'megamillions':
                    mainPool = 70;
                    pickCount = 5;
                    break;
                case 'euromillions':
                    mainPool = 50;
                    pickCount = 5;
                    break;
                case 'lotto649':
                    mainPool = 49;
                    pickCount = 6;
                    break;
            }
            
            if (numbers.length === 0) {
                showToast('Please enter numbers to analyze', 'warning', 'exclamation-triangle');
                return;
            }
            
            if (numbers.some(n => n < 1 || n > mainPool)) {
                showToast(`Numbers must be between 1 and ${mainPool}`, 'danger', 'exclamation-triangle');
                return;
            }
            
            if (numbers.length !== pickCount) {
                showToast(`Please select exactly ${pickCount} numbers`, 'warning', 'exclamation-triangle');
                return;
            }
            
            if (new Set(numbers).size !== numbers.length) {
                showToast('Duplicate numbers detected', 'warning', 'exclamation-triangle');
                return;
            }
            
            const sortedNumbers = [...numbers].sort((a, b) => a - b);
            displayAnalysisResults(sortedNumbers, gameType);
            updateSumAnalysis(sortedNumbers);
            updateGapAnalysis(sortedNumbers);
            updatePatternRecognition(sortedNumbers);
        }

        function displayAnalysisResults(numbers, gameType) {
            const container = document.getElementById('analyzer-results');
            let html = '<div class="lotto-balls">';
            numbers.forEach(num => {
                html += `<div class="ball">${num}</div>`;
            });
            html += '</div>';
            
            const sum = numbers.reduce((a, b) => a + b, 0);
            const average = sum / numbers.length;
            const median = calculateMedian(numbers);
            const range = numbers[numbers.length - 1] - numbers[0];
            const evenCount = numbers.filter(n => n % 2 === 0).length;
            const oddCount = numbers.length - evenCount;
            
            html += `
                <div>
                    <h3>Sum</h3><p>${sum}</p>
                    <h3>Average</h3><p>${average.toFixed(1)}</p>
                    <h3>Median</h3><p>${median}</p>
                    <h3>Range</h3><p>${range}</p>
                    <h3>Odd Numbers</h3><p>${oddCount}</p>
                    <h3>Even Numbers</h3><p>${evenCount}</p>
                </div>
            `;
            
            container.innerHTML = html;
            updateAnalyzerChart(numbers);
        }

        function calculateMedian(numbers) {
            const sorted = [...numbers].sort((a, b) => a - b);
            const middle = Math.floor(sorted.length / 2);
            return sorted.length % 2 === 0 ? 
                (sorted[middle - 1] + sorted[middle]) / 2 : 
                sorted[middle];
        }

        function updateAnalyzerChart(numbers) {
            const ctx = document.getElementById('analyzer-chart').getContext('2d');
            if (appState.charts.analyzerChart) {
                appState.charts.analyzerChart.destroy();
            }
            
            appState.charts.analyzerChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: numbers.map((_, i) => `Position ${i + 1}`),
                    datasets: [{
                        label: 'Number Value',
                        data: numbers,
                        backgroundColor: 'rgba(74, 107, 255, 0.2)',
                        borderColor: 'rgba(74, 107, 255, 1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: { display: true, text: 'Number Value' }
                        },
                        x: {
                            title: { display: true, text: 'Position' }
                        }
                    }
                }
            });
        }

        function updateSumAnalysis(numbers) {
            const sum = numbers.reduce((a, b) => a + b, 0);
            const gameType = document.getElementById('analyzer-game-type').value;
            let sumStats = {};
            
            switch(gameType) {
                case 'powerball':
                    sumStats = { min: 15, max: 340, average: 175, commonRange: [120, 230] };
                    break;
                case 'megamillions':
                    sumStats = { min: 15, max: 350, average: 180, commonRange: [125, 235] };
                    break;
                case 'euromillions':
                    sumStats = { min: 15, max: 240, average: 125, commonRange: [90, 160] };
                    break;
                case 'lotto649':
                    sumStats = { min: 21, max: 279, average: 150, commonRange: [100, 200] };
                    break;
            }
            
            const commonality = sum < sumStats.commonRange[0] ? 
                'This is a relatively low sum compared to most winning combinations.' :
                sum > sumStats.commonRange[1] ? 
                'This is a relatively high sum compared to most winning combinations.' :
                'This sum falls within the most common range for winning combinations.';
                
            document.getElementById('sum-analysis').innerHTML = `
                <p>Sum: ${sum}</p>
                <p>Sum Range: ${sumStats.min} to ${sumStats.max}</p>
                <p>Average Sum: ${sumStats.average}</p>
                <p>Common Range: ${sumStats.commonRange[0]} to ${sumStats.commonRange[1]}</p>
                <p>${commonality}</p>
            `;
        }

        function updateGapAnalysis(numbers) {
            const gaps = [];
            for (let i = 1; i < numbers.length; i++) {
                gaps.push(numbers[i] - numbers[i - 1]);
            }
            
            document.getElementById('gap-analysis').innerHTML = `
                <p>Gaps between numbers: ${gaps.join(', ')}</p>
                <p>Average gap: ${(gaps.reduce((a, b) => a + b, 0) / gaps.length).toFixed(1)}</p>
                <p>Largest gap: ${Math.max(...gaps)}</p>
                <p>Smallest gap: ${Math.min(...gaps)}</p>
                <p>${analyzeGapPattern(gaps)}</p>
            `;
        }

        function analyzeGapPattern(gaps) {
            const uniqueGaps = [...new Set(gaps)];
            return uniqueGaps.length === gaps.length ? 
                'All gaps between numbers are unique, which is typical for lottery draws.' :
                'This combination has repeated gaps between numbers, which is uncommon in lottery draws.';
        }

        function updatePatternRecognition(numbers) {
            const patterns = [];
            const consecutive = numbers.some((n, i) => i > 0 && n === numbers[i-1] + 1);
            if (consecutive) patterns.push('Contains consecutive numbers');
            
            const allSameTen = numbers.every(n => Math.floor((n-1)/10) === Math.floor((numbers[0]-1)/10));
            if (allSameTen) patterns.push('All numbers in same decile');
            
            const evenCount = numbers.filter(n => n % 2 === 0).length;
            if (evenCount === numbers.length) patterns.push('All even numbers');
            if (evenCount === 0) patterns.push('All odd numbers');
            
            document.getElementById('pattern-recognition').innerHTML = patterns.length > 0 ?
                patterns.map(p => `<p>${p}</p>`).join('') :
                '<p>No notable patterns detected</p>';
        }

        function clearAnalyzer() {
            document.getElementById('analyzer-numbers').value = '';
            document.getElementById('analyzer-results').innerHTML = 'Enter numbers to analyze them';
            document.getElementById('sum-analysis').innerHTML = 'Analyze numbers to see sum statistics';
            document.getElementById('gap-analysis').innerHTML = 'Analyze numbers to see gap statistics';
            document.getElementById('pattern-recognition').innerHTML = 'Analyze numbers to detect patterns';
            
            document.querySelectorAll('#analyzer-number-matrix .number-cell').forEach(cell => {
                cell.classList.remove('selected');
            });
            
            if (appState.charts.analyzerChart) {
                appState.charts.analyzerChart.destroy();
                appState.charts.analyzerChart = null;
            }
        }

        function loadSavedTickets() {
            const gameType = document.getElementById('analyzer-game-type').value;
            const savedTickets = appState.savedTickets[gameType] || [];
            
            if (savedTickets.length === 0) {
                showToast(`No saved tickets found for ${gameType}`, 'warning', 'exclamation-triangle');
                return;
            }
            
            const latestTicket = savedTickets[savedTickets.length - 1];
            document.getElementById('analyzer-numbers').value = latestTicket.numbers.join(', ');
            
            document.querySelectorAll('#analyzer-number-matrix .number-cell').forEach(cell => {
                const num = parseInt(cell.textContent);
                cell.classList.toggle('selected', latestTicket.numbers.includes(num));
            });
            
            analyzeNumbers();
            showToast('Loaded most recent saved ticket', 'success', 'folder-open');
        }

        // Historical data functions
        function loadHistoricalData() {
            const gameType = document.getElementById('history-game-type').value;
            const drawCount = parseInt(document.getElementById('history-draw-count').value);
            
            showToast(`Loading ${drawCount} historical draws for ${gameType}...`, 'info', 'spinner fa-spin');
            
            setTimeout(() => {
                const history = generateMockHistory(gameType, drawCount);
                appState.historicalData[gameType] = history;
                processHotColdNumbers(gameType, history);
                displayHistoricalData(history);
                displayHotColdNumbers(gameType);
                showToast(`Successfully loaded ${drawCount} historical draws`, 'success', 'check-circle');
            }, 1500);
        }

        function generateMockHistory(gameType, count) {
            let mainPool, pickCount, bonusPool, bonusCount;
            switch(gameType) {
                case 'powerball':
                    mainPool = 69;
                    pickCount = 5;
                    bonusPool = 26;
                    bonusCount = 1;
                    break;
                case 'megamillions':
                    mainPool = 70;
                    pickCount = 5;
                    bonusPool = 25;
                    bonusCount = 1;
                    break;
                case 'euromillions':
                    mainPool = 50;
                    pickCount = 5;
                    bonusPool = 12;
                    bonusCount = 2;
                    break;
                case 'lotto649':
                    mainPool = 49;
                    pickCount = 6;
                    bonusPool = 0;
                    bonusCount = 0;
                    break;
            }
            
            const history = [];
            const now = new Date();
            
            for (let i = 0; i < count; i++) {
                const drawDate = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);
                const mainNumbers = generateRandomNumbers(mainPool, pickCount, 'standard');
                const bonusNumbers = bonusCount > 0 ? generateRandomNumbers(bonusPool, bonusCount, 'standard') : [];
                const jackpot = Math.floor(Math.random() * 500000000) + 10000000;
                
                history.push({
                    date: drawDate.toISOString().split('T')[0],
                    numbers: mainNumbers,
                    bonusNumbers: bonusNumbers.length > 0 ? bonusNumbers : null,
                    jackpot: jackpot.toLocaleString('en-US', {style: 'currency', currency: 'USD', maximumFractionDigits: 0})
                });
            }
            
            return history;
        }

        function processHotColdNumbers(gameType, history) {
            const mainNumbers = history.flatMap(draw => draw.numbers);
            const bonusNumbers = history.flatMap(draw => draw.bonusNumbers || []);
            
            const mainPool = gameType === 'powerball' ? 69 :
                           gameType === 'megamillions' ? 70 :
                           gameType === 'euromillions' ? 50 : 49;
            
            const frequencies = [];
            for (let i = 1; i <= mainPool; i++) {
                const allTime = mainNumbers.filter(n => n === i).length;
                const recentDraws = Math.max(10, Math.floor(history.length * 0.2));
                const recent = history.slice(-recentDraws)
                    .flatMap(d => d.numbers)
                    .filter(n => n === i).length;
                
                frequencies.push({ number: i, allTime, recent });
            }
            
            let bonusFrequencies = [];
            const bonusPool = gameType === 'powerball' ? 26 :
                             gameType === 'megamillions' ? 25 :
                             gameType === 'euromillions' ? 12 : 0;
            
            if (bonusPool > 0) {
                for (let i = 1; i <= bonusPool; i++) {
                    const allTime = bonusNumbers.filter(n => n === i).length;
                    const recentDraws = Math.max(10, Math.floor(history.length * 0.2));
                    const recent = history.slice(-recentDraws)
                        .flatMap(d => d.bonusNumbers || [])
                        .filter(n => n === i).length;
                    
                    bonusFrequencies.push({ number: i, allTime, recent });
                }
            }
            
            appState.hotColdData[gameType] = {
                frequencies,
                bonusFrequencies,
                lastUpdated: new Date().toISOString()
            };
        }

        function displayHistoricalData(history) {
            const tableBody = document.getElementById('history-table-body');
            tableBody.innerHTML = '';
            
            history.forEach(draw => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${draw.date}</td>
                    <td><div class="lotto-balls">${draw.numbers.map(n => `<div class="ball">${n}</div>`).join('')}</div></td>
                    <td>${draw.bonusNumbers ? `<div class="lotto-balls">${draw.bonusNumbers.map(n => `<div class="ball ${document.getElementById('history-game-type').value === 'powerball' ? 'powerball' : document.getElementById('history-game-type').value === 'megamillions' ? 'megaball' : 'eurostar'}">${n}</div>`).join('')}</div>` : ''}</td>
                    <td>${draw.jackpot}</td>
                `;
                
                tableBody.appendChild(row);
            });
            
            updateHistoryChart(history);
        }

        function updateHistoryChart(history) {
            const ctx = document.getElementById('history-chart').getContext('2d');
            if (appState.charts.historyChart) {
                appState.charts.historyChart.destroy();
            }
            
            const labels = history.map(draw => draw.date);
            const sums = history.map(draw => draw.numbers.reduce((a, b) => a + b, 0));
            const jackpots = history.map(draw => parseInt(draw.jackpot.replace(/[^0-9]/g, '')) / 1000000);
            
            appState.charts.historyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [
                        {
                            label: 'Number Sum',
                            data: sums,
                            backgroundColor: 'rgba(74, 107, 255, 0.2)',
                            borderColor: 'rgba(74, 107, 255, 1)',
                            yAxisID: 'y'
                        },
                        {
                            label: 'Jackpot (Millions)',
                            data: jackpots,
                            backgroundColor: 'rgba(239, 68, 68, 0.2)',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'Number Sum' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'Jackpot (Millions)' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        function displayHotColdNumbers(gameType) {
            const container = document.getElementById('hot-cold-numbers');
            const hotColdData = appState.hotColdData[gameType];
            
            if (!hotColdData) {
                container.innerHTML = 'No hot/cold data available';
                return;
            }
            
            const hotNumbers = [...hotColdData.frequencies]
                .sort((a, b) => b.recent - a.recent)
                .slice(0, 10);
                
            const coldNumbers = [...hotColdData.frequencies]
                .filter(f => f.allTime > 0)
                .sort((a, b) => a.recent - b.recent)
                .slice(0, 10);
                
            const overdueNumbers = [...hotColdData.frequencies]
                .filter(f => f.allTime > 0 && f.recent === 0)
                .sort((a, b) => b.allTime - a.allTime)
                .slice(0, 10);
                
            let html = `
                <div>
                    <h3>Hot Numbers (Recent Frequency)</h3>
                    <div class="lotto-balls">${hotNumbers.map(n => `<div class="ball">${n.number}</div>`).join('')}</div>
                </div>
                <div>
                    <h3>Cold Numbers (Recent Frequency)</h3>
                    <div class="lotto-balls">${coldNumbers.map(n => `<div class="ball">${n.number}</div>`).join('')}</div>
                </div>
                <div>
                    <h3>Overdue Numbers (Not Recent)</h3>
                    <div class="lotto-balls">${overdueNumbers.map(n => `<div class="ball">${n.number}</div>`).join('')}</div>
                </div>
            `;
            
            container.innerHTML = html;
            updateHotColdChart(hotColdData.frequencies);
        }

        function updateHotColdChart(frequencies) {
            const ctx = document.getElementById('hot-cold-chart').getContext('2d');
            if (appState.charts.hotColdChart) {
                appState.charts.hotColdChart.destroy();
            }
            
            const sortedFrequencies = [...frequencies].sort((a, b) => a.number - b.number);
            appState.charts.hotColdChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedFrequencies.map(item => item.number),
                    datasets: [
                        {
                            label: 'All-Time Frequency',
                            data: sortedFrequencies.map(item => item.allTime),
                            backgroundColor: 'rgba(74, 107, 255, 0.7)'
                        },
                        {
                            label: 'Recent Frequency',
                            data: sortedFrequencies.map(item => item.recent),
                            backgroundColor: 'rgba(239, 68, 68, 0.7)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Frequency' } }
                    }
                }
            });
        }

        function clearHistoryTable() {
            document.getElementById('history-table-body').innerHTML = '';
            document.getElementById('hot-cold-numbers').innerHTML = 'Load historical data to see hot and cold numbers';
            
            if (appState.charts.historyChart) {
                appState.charts.historyChart.destroy();
                appState.charts.historyChart = null;
            }
            if (appState.charts.hotColdChart) {
                appState.charts.hotColdChart.destroy();
                appState.charts.hotColdChart = null;
            }
        }

        function downloadHistoricalData() {
            const gameType = document.getElementById('history-game-type').value;
            const history = appState.historicalData[gameType];
            
            if (!history || history.length === 0) {
                showToast('No historical data to download', 'warning', 'exclamation-triangle');
                return;
            }
            
            let csv = 'Date,Main Numbers,Bonus Numbers,Jackpot\n';
            history.forEach(draw => {
                csv += `${draw.date},"${draw.numbers.join(',')}",${draw.bonusNumbers ? `"${draw.bonusNumbers.join(',')}"` : '""'},${draw.jackpot}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${gameType}-history-${new Date().toISOString().slice(0, 10)}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Historical data downloaded as CSV', 'success', 'file-csv');
        }

        // Strategy functions
        function selectStrategy(strategy) {
            appState.currentStrategy = strategy;
            document.querySelectorAll('.strategy-button').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.toLowerCase() === strategy);
            });
            updateStrategyParams();
            updateStrategyExplanation();
        }

        function updateStrategyParams() {
            const strategy = appState.currentStrategy;
            const paramsContainer = document.getElementById('strategy-params');
            
            let html = '';
            switch(strategy) {
                case 'low-high':
                    html = `
                        <div>
                            <label>Low numbers:</label>
                            <input type="number" id="strategy-low-count" value="3" min="0">
                        </div>
                        <div>
                            <label>High numbers:</label>
                            <input type="number" id="strategy-high-count" value="2" min="0">
                        </div>
                    `;
                    break;
                case 'odd-even':
                    html = `
                        <div>
                            <label>Odd numbers:</label>
                            <input type="number" id="strategy-odd-count" value="3" min="0">
                        </div>
                        <div>
                            <label>Even numbers:</label>
                            <input type="number" id="strategy-even-count" value="2" min="0">
                        </div>
                    `;
                    break;
                case 'hot-cold':
                    html = `
                        <div>
                            <label>Hot numbers:</label>
                            <input type="number" id="strategy-hot-count" value="3" min="0">
                        </div>
                        <div>
                            <label>Cold numbers:</label>
                            <input type="number" id="strategy-cold-count" value="2" min="0">
                        </div>
                        <p>Hot/Cold strategy requires historical data to be loaded.</p>
                    `;
                    break;
                case 'birthday':
                    html = `
                        <div>
                            <label>Day:</label>
                            <input type="number" id="birthday-day" min="1" max="31">
                        </div>
                        <div>
                            <label>Month:</label>
                            <input type="number" id="birthday-month" min="1" max="12">
                        </div>
                        <div>
                            <label>Year (last 2 digits):</label>
                            <input type="number" id="birthday-year" min="0" max="99">
                        </div>
                    `;
                    break;
                case 'ai':
                    html = `
                        <div>
                            <label>AI Model:</label>
                            <select id="ai-strategy-model">
                                <option value="markov">Markov Chain</option>
                                <option value="neural">Neural Network</option>
                                <option value="combined">Combined Model</option>
                            </select>
                        </div>
                        <div>
                            <label>Minimum confidence threshold:</label>
                            <input type="range" id="ai-strategy-confidence" min="50" max="95" value="75">
                            <span id="strategy-confidence-value">75%</span>
                        </div>
                        <p>AI models perform better with historical data loaded.</p>
                    `;
                    break;
            }
            
            paramsContainer.innerHTML = html;
            if (strategy === 'ai') {
                document.getElementById('ai-strategy-confidence').addEventListener('input', function() {
                    document.getElementById('strategy-confidence-value').textContent = this.value + '%';
                });
            }
        }

        function updateStrategyExplanation() {
            const strategy = appState.currentStrategy;
            const container = document.getElementById('strategy-explanation');
            
            const explanations = {
                random: 'The Random strategy generates numbers completely at random with no particular pattern or strategy.',
                'low-high': 'The Low-High strategy balances your selection between low and high numbers based on the number pool.',
                'odd-even': 'The Odd-Even strategy balances your selection between odd and even numbers.',
                prime: 'The Prime Numbers strategy focuses on prime numbers (numbers divisible only by 1 and themselves).',
                fibonacci: 'The Fibonacci Numbers strategy uses numbers from the Fibonacci sequence.',
                lucky: 'The Lucky Numbers strategy uses numbers considered lucky in various cultures.',
                'hot-cold': 'The Hot/Cold Numbers strategy combines frequently drawn (hot) and infrequently drawn (cold) numbers.',
                birthday: 'The Birthday Numbers strategy uses dates (days and months) from birthdays or other significant dates.',
                ai: 'The AI-Powered strategy uses machine learning models to predict numbers based on historical patterns.'
            };
            
            container.innerHTML = explanations[strategy] || 'Select a strategy to see its explanation';
        }

        function generateWithStrategy() {
            const strategy = appState.currentStrategy;
            const gameType = document.getElementById('game-type').value;
            
            let mainPool, pickCount, bonusPool, bonusCount;
            switch(gameType) {
                case 'powerball':
                    mainPool = 69;
                    pickCount = 5;
                    bonusPool = 26;
                    bonusCount = 1;
                    break;
                case 'megamillions':
                    mainPool = 70;
                    pickCount = 5;
                    bonusPool = 25;
                    bonusCount = 1;
                    break;
                case 'euromillions':
                    mainPool = 50;
                    pickCount = 5;
                    bonusPool = 12;
                    bonusCount = 2;
                    break;
                case 'lotto649':
                    mainPool = 49;
                    pickCount = 6;
                    bonusPool = 0;
                    bonusCount = 0;
                    break;
                default:
                    mainPool = parseInt(document.getElementById('main-numbers').value) || 69;
                    pickCount = parseInt(document.getElementById('pick-numbers').value) || 5;
                    bonusPool = parseInt(document.getElementById('bonus-numbers').value) || 26;
                    bonusCount = parseInt(document.getElementById('pick-bonus').
                                          // ... (previous code remains unchanged until the incomplete line)

// Continuation of generateWithStrategy
function generateWithStrategy() {
    const strategy = appState.currentStrategy;
    const gameType = document.getElementById('game-type').value;
    
    let mainPool, pickCount, bonusPool, bonusCount;
    switch(gameType) {
        case 'powerball':
            mainPool =  A 69;
            pickCount = 5;
            bonusPool = 26;
            bonusCount = 1;
            break;
        case 'megamillions':
            mainPool = 70;
            pickCount = 5;
            bonusPool = 25;
            bonusCount = 1;
            break;
        case 'euromillions':
            mainPool = 50;
            pickCount = 5;
            bonusPool = 12;
            bonusCount = 2;
            break;
        case 'lotto649':
            mainPool = 49;
            pickCount = 6;
            bonusPool = 0;
            bonusCount = 0;
            break;
        default:
            mainPool = parseInt(document.getElementById('main-numbers').value) || 69;
            pickCount = parseInt(document.getElementById('pick-numbers').value) || 5;
            bonusPool = parseInt(document.getElementById('bonus-numbers').value) || 26;
            bonusCount = parseInt(document.getElementById('pick-bonus').value) || 1;
    }
    
    let numbers;
    switch(strategy) {
        case 'random':
            numbers = generateRandomNumbers(mainPool, pickCount, 'standard');
            break;
        case 'low-high':
            const lowCount = parseInt(document.getElementById('strategy-low-count')?.value) || 3;
            const highCount = parseInt(document.getElementById('strategy-high-count')?.value) || 2;
            numbers = generateLowHighNumbers(mainPool, lowCount, highCount, pickCount);
            break;
        case 'odd-even':
            const oddCount = parseInt(document.getElementById('strategy-odd-count')?.value) || 3;
            const evenCount = parseInt(document.getElementById('strategy-even-count')?.value) || 2;
            numbers = generateOddEvenNumbers(mainPool, oddCount, evenCount, pickCount);
            break;
        case 'prime':
            numbers = generatePrimeNumbers(mainPool, pickCount);
            break;
        case 'fibonacci':
            numbers = generateFibonacciNumbers(mainPool, pickCount);
            break;
        case 'lucky':
            numbers = generateLuckyNumbers(mainPool, pickCount);
            break;
        case 'hot-cold':
            const hotCount = parseInt(document.getElementById('strategy-hot-count')?.value) || 3;
            const coldCount = parseInt(document.getElementById('strategy-cold-count')?.value) || 2;
            numbers = generateHotColdNumbers(gameType, hotCount, coldCount, pickCount);
            break;
        case 'birthday':
            numbers = generateBirthdayNumbers(mainPool, pickCount);
            break;
        case 'ai':
            const aiModel = document.getElementById('ai-strategy-model')?.value || 'combined';
            numbers = generateAINumbers(gameType, aiModel, pickCount);
            break;
    }
    
    const bonusNumbers = bonusCount > 0 ? generateRandomNumbers(bonusPool, bonusCount, 'standard') : [];
    const tickets = [{ numbers, bonusNumbers }];
    
    displayGeneratedTickets(tickets);
    updateCoverageChart(tickets);
    updateFrequencyChart(tickets);
    updateStrategyStats(tickets);
    showToast('Numbers generated with ' + strategy + ' strategy', 'success', 'ticket-alt');
}

// Helper functions for strategy-based number generation
function generateLowHighNumbers(poolSize, lowCount, highCount, totalCount) {
    if (lowCount + highCount !== totalCount) {
        showToast('Low and high counts must sum to total numbers required', 'warning', 'exclamation-triangle');
        return generateRandomNumbers(poolSize, totalCount, 'standard');
    }
    
    const midpoint = Math.floor(poolSize / 2);
    const lowNumbers = generateRandomNumbers(midpoint, lowCount, 'standard');
    const highNumbers = generateRandomNumbers(poolSize - midpoint, highCount, 'standard')
        .map(n => n + midpoint);
    
    return [...lowNumbers, ...highNumbers].sort((a, b) => a - b);
}

function generateOddEvenNumbers(poolSize, oddCount, evenCount, totalCount) {
    if (oddCount + evenCount !== totalCount) {
        showToast('Odd and even counts must sum to total numbers required', 'warning', 'exclamation-triangle');
        return generateRandomNumbers(poolSize, totalCount, 'standard');
    }
    
    const oddNumbers = Array.from({length: poolSize}, (_, i) => i + 1)
        .filter(n => n % 2 === 1);
    const evenNumbers = Array.from({length: poolSize}, (_, i) => i + 1)
        .filter(n => n % 2 === 0);
    
    const odds = generateRandomNumbersFromList(oddNumbers, oddCount);
    const evens = generateRandomNumbersFromList(evenNumbers, evenCount);
    
    return [...odds, ...evens].sort((a, b) => a - b);
}

function generateHotColdNumbers(gameType, hotCount, coldCount, totalCount) {
    if (hotCount + coldCount !== totalCount) {
        showToast('Hot and cold counts must sum to total numbers required', 'warning', 'exclamation-triangle');
        return generateRandomNumbers(totalCount, totalCount, 'standard');
    }
    
    const hotColdData = appState.hotColdData[gameType];
    if (!hotColdData) {
        showToast('Please load historical data first', 'warning', 'exclamation-triangle');
        return generateRandomNumbers(totalCount, totalCount, 'standard');
    }
    
    const hotNumbers = hotColdData.frequencies
        .sort((a, b) => b.recent - a.recent)
        .slice(0, Math.max(10, hotCount * 2))
        .map(f => f.number);
    
    const coldNumbers = hotColdData.frequencies
        .filter(f => f.allTime > 0)
        .sort((a, b) => a.recent - b.recent)
        .slice(0, Math.max(10, coldCount * 2))
        .map(f => f.number);
    
    const hots = generateRandomNumbersFromList(hotNumbers, hotCount);
    const colds = generateRandomNumbersFromList(coldNumbers, coldCount);
    
    return [...hots, ...colds].sort((a, b) => a - b);
}

function generateBirthdayNumbers(poolSize, count) {
    const day = parseInt(document.getElementById('birthday-day')?.value) || Math.floor(Math.random() * 31) + 1;
    const month = parseInt(document.getElementById('birthday-month')?.value) || Math.floor(Math.random() * 12) + 1;
    const year = parseInt(document.getElementById('birthday-year')?.value) || Math.floor(Math.random() * 100);
    
    const birthdayNumbers = [day, month, year].filter(n => n <= poolSize);
    const remainingCount = count - birthdayNumbers.length;
    
    if (remainingCount < 0) {
        return generateRandomNumbersFromList(birthdayNumbers, count);
    }
    
    const remainingNumbers = generateRandomNumbers(poolSize, remainingCount, 'standard')
        .filter(n => !birthdayNumbers.includes(n));
    
    return [...birthdayNumbers, ...remainingNumbers].sort((a, b) => a - b);
}

function generateAINumbers(gameType, model, count) {
    const hotColdData = appState.hotColdData[gameType];
    if (!hotColdData) {
        showToast('Please load historical data for AI predictions', 'warning', 'exclamation-triangle');
        return generateRandomNumbers(69, count, 'standard');
    }
    
    const confidenceThreshold = parseInt(document.getElementById('ai-strategy-confidence')?.value) || 75;
    const frequencies = hotColdData.frequencies;
    
    // Simple AI simulation: weight numbers by recent frequency
    const weights = frequencies.map(f => f.recent + 1); // Add 1 to avoid zero weights
    const totalWeight = weights.reduce((a, b) => a + b, 0);
    const probabilities = weights.map(w => w / totalWeight);
    
    const numbers = [];
    const available = Array.from({length: frequencies.length}, (_, i) => i + 1);
    
    while (numbers.length < count && available.length > 0) {
        const rand = Math.random();
        let cumulative = 0;
        for (let i = 0; i < available.length; i++) {
            cumulative += probabilities[available[i] - 1];
            if (rand <= cumulative) {
                numbers.push(available.splice(i, 1)[0]);
                break;
            }
        }
    }
    
    return numbers.sort((a, b) => a - b);
}

function updateStrategyStats(tickets) {
    const container = document.getElementById('strategy-stats');
    if (!tickets || tickets.length === 0) {
        container.innerHTML = 'Generate numbers to see statistics';
        return;
    }
    
    const numbers = tickets[0].numbers;
    const sum = numbers.reduce((a, b) => a + b, 0);
    const evenCount = numbers.filter(n => n % 2 === 0).length;
    const oddCount = numbers.length - evenCount;
    const highCount = numbers.filter(n => n > Math.floor(tickets[0].numbers[0] / 2)).length;
    const lowCount = numbers.length - highCount;
    
    container.innerHTML = `
        <p>Sum: ${sum}</p>
        <p>Odd Numbers: ${oddCount}</p>
        <p>Even Numbers: ${evenCount}</p>
        <p>High Numbers: ${highCount}</p>
        <p>Low Numbers: ${lowCount}</p>
    `;
    
    updateStrategyChart(tickets);
}

function updateStrategyChart(tickets) {
    const ctx = document.getElementById('strategy-chart').getContext('2d');
    if (appState.charts.strategyChart) {
        appState.charts.strategyChart.destroy();
    }
    
    if (!tickets || tickets.length === 0) return;
    
    const numbers = tickets[0].numbers;
    appState.charts.strategyChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: numbers.map((_, i) => `Number ${i + 1}`),
            datasets: [{
                label: 'Generated Numbers',
                data: numbers,
                backgroundColor: 'rgba(74, 107, 255, 0.7)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: false, title: { display: true, text: 'Number Value' } }
            }
        }
    });
}

function testStrategy() {
    const strategy = appState.currentStrategy;
    const gameType = document.getElementById('game-type').value;
    const history = appState.historicalData[gameType];
    
    if (!history || history.length === 0) {
        showToast('Please load historical data to test strategy', 'warning', 'exclamation-triangle');
        return;
    }
    
    document.getElementById('strategy-performance').style.display = 'block';
    const container = document.getElementById('performance-results');
    
    // Simulate strategy performance against historical data
    let matches = { 0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0 };
    const testCount = 100;
    
    for (let i = 0; i < testCount; i++) {
        const ticket = generateStrategyTicket(strategy, gameType);
        history.forEach(draw => {
            const matchCount = ticket.numbers.filter(n => draw.numbers.includes(n)).length;
            matches[matchCount]++;
        });
    }
    
    const totalTests = testCount * history.length;
    let html = '<h3>Strategy Performance</h3>';
    for (let i = 0; i <= 6; i++) {
        const percentage = ((matches[i] / totalTests) * 100).toFixed(2);
        html += `<p>${i} Number Matches: ${matches[i]} times (${percentage}%)</p>`;
    }
    
    container.innerHTML = html;
    showToast('Strategy test completed', 'success', 'chart-bar');
}

function generateStrategyTicket(strategy, gameType) {
    let mainPool, pickCount, bonusPool, bonusCount;
    switch(gameType) {
        case 'powerball':
            mainPool = 69;
            pickCount = 5;
            bonusPool = 26;
            bonusCount = 1;
            break;
        case 'megamillions':
            mainPool = 70;
            pickCount = 5;
            bonusPool = 25;
            bonusCount = 1;
            break;
        case 'euromillions':
            mainPool = 50;
            pickCount = 5;
            bonusPool = 12;
            bonusCount = 2;
            break;
        case 'lotto649':
            mainPool = 49;
            pickCount = 6;
            bonusPool = 0;
            bonusCount = 0;
            break;
    }
    
    let numbers;
    switch(strategy) {
        case 'random':
            numbers = generateRandomNumbers(mainPool, pickCount, 'standard');
            break;
        case 'low-high':
            numbers = generateLowHighNumbers(mainPool, 3, 2, pickCount);
            break;
        case 'odd-even':
            numbers = generateOddEvenNumbers(mainPool, 3, 2, pickCount);
            break;
        case 'prime':
            numbers = generatePrimeNumbers(mainPool, pickCount);
            break;
        case 'fibonacci':
            numbers = generateFibonacciNumbers(mainPool, pickCount);
            break;
        case 'lucky':
            numbers = generateLuckyNumbers(mainPool, pickCount);
            break;
        case 'hot-cold':
            numbers = generateHotColdNumbers(gameType, 3, 2, pickCount);
            break;
        case 'birthday':
            numbers = generateBirthdayNumbers(mainPool, pickCount);
            break;
        case 'ai':
            numbers = generateAINumbers(gameType, 'combined', pickCount);
            break;
    }
    
    const bonusNumbers = bonusCount > 0 ? generateRandomNumbers(bonusPool, bonusCount, 'standard') : [];
    return { numbers, bonusNumbers };
}

function saveStrategy() {
    const strategy = appState.currentStrategy;
    const gameType = document.getElementById('game-type').value;
    const params = {};
    
    switch(strategy) {
        case 'low-high':
            params.lowCount = parseInt(document.getElementById('strategy-low-count')?.value) || 3;
            params.highCount = parseInt(document.getElementById('strategy-high-count')?.value) || 2;
            break;
        case 'odd-even':
            params.oddCount = parseInt(document.getElementById('strategy-odd-count')?.value) || 3;
            params.evenCount = parseInt(document.getElementById('strategy-even-count')?.value) || 2;
            break;
        case 'hot-cold':
            params.hotCount = parseInt(document.getElementById('strategy-hot-count')?.value) || 3;
            params.coldCount = parseInt(document.getElementById('strategy-cold-count')?.value) || 2;
            break;
        case 'birthday':
            params.day = parseInt(document.getElementById('birthday-day')?.value) || null;
            params.month = parseInt(document.getElementById('birthday-month')?.value) || null;
            params.year = parseInt(document.getElementById('birthday-year')?.value) || null;
            break;
        case 'ai':
            params.model = document.getElementById('ai-strategy-model')?.value || 'combined';
            params.confidence = parseInt(document.getElementById('ai-strategy-confidence')?.value) || 75;
            break;
    }
    
    if (!appState.savedStrategies[gameType]) {
        appState.savedStrategies[gameType] = {};
    }
    
    appState.savedStrategies[gameType][strategy] = {
        params,
        date: new Date().toISOString()
    };
    
    localStorage.setItem('savedStrategies', JSON.stringify(appState.savedStrategies));
    showToast('Strategy saved successfully', 'success', 'save');
}

// Simulator functions
function updateSimulator() {
    const gameType = document.getElementById('simulator-game-type').value;
    let mainPool, pickCount;
    
    switch(gameType) {
        case 'powerball':
            mainPool = 69;
            pickCount = 5;
            break;
        case 'megamillions':
            mainPool = 70;
            pickCount = 5;
            break;
        case 'euromillions':
            mainPool = 50;
            pickCount = 5;
            break;
        case 'lotto649':
            mainPool = 49;
            pickCount = 6;
            break;
    }
    
    const matrix = document.getElementById('simulator-number-matrix');
    matrix.innerHTML = '';
    for (let i = 1; i <= mainPool; i++) {
        const cell = document.createElement('div');
        cell.className = 'number-cell';
        cell.textContent = i;
        cell.addEventListener('click', () => {
            cell.classList.toggle('selected');
            const selected = Array.from(matrix.querySelectorAll('.number-cell.selected'))
                .map(cell => parseInt(cell.textContent))
                .sort((a, b) => a - b);
            const tickets = document.getElementById('simulator-tickets');
            const currentTickets = tickets.value.split('\n').filter(t => t.trim());
            if (selected.length === pickCount) {
                currentTickets.push(selected.join(','));
                tickets.value = currentTickets.join('\n');
                matrix.querySelectorAll('.number-cell').forEach(c => c.classList.remove('selected'));
            }
        });
        matrix.appendChild(cell);
    }
    
    updateProbabilityCalculator();
}

function runSimulation() {
    if (appState.simulationRunning) {
        showToast('Simulation already running', 'warning', 'exclamation-triangle');
        return;
    }
    
    const gameType = document.getElementById('simulator-game-type').value;
    const ticketsInput = document.getElementById('simulator-tickets').value;
    const simCount = parseInt(document.getElementById('simulator-count').value);
    
    let mainPool, pickCount, bonusPool, bonusCount;
    switch(gameType) {
        case 'powerball':
            mainPool = 69;
            pickCount = 5;
            bonusPool = 26;
            bonusCount = 1;
            break;
        case 'megamillions':
            mainPool = 70;
            pickCount = 5;
            bonusPool = 25;
            bonusCount = 1;
            break;
        case 'euromillions':
            mainPool = 50;
            pickCount = 5;
            bonusPool = 12;
            bonusCount = 2;
            break;
        case 'lotto649':
            mainPool = 49;
            pickCount = 6;
            bonusPool = 0;
            bonusCount = 0;
            break;
    }
    
    const tickets = ticketsInput.split('\n')
        .map(line => line.trim())
        .filter(line => line)
        .map(line => ({
            numbers: line.split(',')
                .map(n => parseInt(n.trim()))
                .filter(n => !isNaN(n) && n >= 1 && n <= mainPool)
                .sort((a, b) => a - b)
        }))
        .filter(t => t.numbers.length === pickCount && new Set(t.numbers).size === t.numbers.length);
    
    if (tickets.length === 0) {
        showToast('Please enter valid tickets to simulate', 'warning', 'exclamation-triangle');
        return;
    }
    
    appState.simulationRunning = true;
    showToast(`Running ${simCount} simulations...`, 'info', 'spinner fa-spin');
    
    // Simulate in a web worker to prevent UI blocking
    const workerCode = `
        onmessage = function(e) {
            const { tickets, simCount, mainPool, pickCount, bonusPool, bonusCount } = e.data;
            
            function generateRandomNumbers(poolSize, count) {
                const numbers = [];
                const available = Array.from({length: poolSize}, (_, i) => i + 1);
                while (numbers.length < count && available.length > 0) {
                    const index = Math.floor(Math.random() * available.length);
                    numbers.push(available.splice(index, 1)[0]);
                }
                return numbers.sort((a, b) => a - b);
            }
            
            const results = { matches: {}, wins: 0 };
            for (let i = 0; i < simCount; i++) {
                const draw = generateRandomNumbers(mainPool, pickCount);
                const bonus = bonusCount > 0 ? generateRandomNumbers(bonusPool, bonusCount) : [];
                
                tickets.forEach((ticket, ticketIndex) => {
                    const matchCount = ticket.numbers.filter(n => draw.includes(n)).length;
                    results.matches[ticketIndex] = results.matches[ticketIndex] || {};
                    results.matches[ticketIndex][matchCount] = (results.matches[ticketIndex][matchCount] || 0) + 1;
                    if (matchCount === pickCount) results.wins++;
                });
                
                if (i % 1000 === 0) {
                    postMessage({ progress: i / simCount * 100 });
                }
            }
            
            postMessage({ results });
        };
    `;
    
    const blob = new Blob([workerCode], { type: 'application/javascript' });
    const workerURL = URL.createObjectURL(blob);
    appState.simulationWorker = new Worker(workerURL);
    
    appState.simulationWorker.onmessage = function(e) {
        if (e.data.progress) {
            document.getElementById('simulation-results').innerHTML = `Simulation progress: ${e.data.progress.toFixed(1)}%`;
        } else {
            displaySimulationResults(e.data.results, tickets);
            appState.simulationRunning = false;
            appState.simulationWorker.terminate();
            URL.revokeObjectURL(workerURL);
            showToast('Simulation completed', ' 'success', 'check-circle');
        }
    };
    
    appState.simulationWorker.postMessage({
        tickets,
        simCount,
        mainPool,
        pickCount,
        bonusPool,
        bonusCount
    });
}

function stopSimulation() {
    if (appState.simulationWorker && appState.simulationRunning) {
        appState.simulationWorker.terminate();
        appState.simulationRunning = false;
        showToast('Simulation stopped', 'info', 'stop-circle');
        document.getElementById('simulation-results').innerHTML = 'Simulation stopped';
        if (appState.charts.simulationChart) {
            appState.charts.simulationChart.destroy();
            appState.charts.simulationChart = null;
        }
    }
}

function clearSimulation() {
    if (appState.simulationRunning) {
        stopSimulation();
    }
    
    document.getElementById('simulator-tickets').value = '';
    document.getElementById('simulator-number-matrix').querySelectorAll('.number-cell')
        .forEach(cell => cell.classList.remove('selected'));
    document.getElementById('simulation-results').innerHTML = 'Run a simulation to see results';
    document.getElementById('winning-numbers').innerHTML = 'Run a simulation to see winning numbers';
    
    if (appState.charts.simulationChart) {
        appState.charts.simulationChart.destroy();
        appState.charts.simulationChart = null;
    }
}

function loadSampleTickets() {
    const gameType = document.getElementById('simulator-game-type').value;
    let mainPool, pickCount;
    
    switch(gameType) {
        case 'powerball':
            mainPool = 69;
            pickCount = 5;
            break;
        case 'megamillions':
            mainPool = 70;
            pickCount = 5;
            break;
        case 'euromillions':
            mainPool = 50;
            pickCount = 5;
            break;
        case 'lotto649':
            mainPool = 49;
            pickCount = 6;
            break;
    }
    
    const sampleTickets = [];
    for (let i = 0; i < 3; i++) {
        sampleTickets.push(generateRandomNumbers(mainPool, pickCount, 'standard').join(','));
    }
    
    document.getElementById('simulator-tickets').value = sampleTickets.join('\n');
    showToast('Sample tickets loaded', 'success', 'ticket-alt');
}

function displaySimulationResults(results, tickets) {
    const container = document.getElementById('simulation-results');
    let html = '<h3>Simulation Results</h3>';
    
    tickets.forEach((ticket, i) => {
        html += `<h4>Ticket ${i + 1}: ${ticket.numbers.join(', ')}</h4>`;
        const matches = results.matches[i] || {};
        for (let j = 0; j <= ticket.numbers.length; j++) {
            const count = matches[j] || 0;
            const percentage = (count / parseInt(document.getElementById('simulator-count').value) * 100).toFixed(2);
            html += `<p>${j} Number Matches: ${count} times (${percentage}%)</p>`;
        }
    });
    
    html += `<p>Total Wins (All Numbers Matched): ${results.wins} times</p>`;
    container.innerHTML = html;
    
    // Update winning numbers display
    const winningContainer = document.getElementById('winning-numbers');
    const lastDraw = generateRandomNumbers(tickets[0].numbers.length, tickets[0].numbers.length, 'standard');
    winningContainer.innerHTML = `
        <h3>Sample Winning Numbers</h3>
        <div class="lotto-balls">${lastDraw.map(n => `<div class="ball">${n}</div>`).join('')}</div>
    `;
    
    updateSimulationChart(results, tickets);
}

function updateSimulationChart(results, tickets) {
    const ctx = document.getElementById('simulation-chart').getContext('2d');
    if (appState.charts.simulationChart) {
        appState.charts.simulationChart.destroy();
    }
    
    const labels = Array.from({length: tickets[0].numbers.length + 1}, (_, i) => `${i} Matches`);
    const datasets = tickets.map((ticket, i) => ({
        label: `Ticket ${i + 1}`,
        data: labels.map((_, j) => results.matches[i]?.[j] || 0),
        backgroundColor: `rgba(${74 + i * 50}, ${107 + i * 50}, ${255 - i * 50}, 0.7)`
    }));
    
    appState.charts.simulationChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels,
            datasets
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: true, title: { display: true, text: 'Frequency' } }
            }
        }
    });
}

// Predictor functions
function updatePredictor() {
    const gameType = document.getElementById('predictor-game-type').value;
    updateModelDetails();
    updateProbabilityCalculator();
}

function updateModelDetails() {
    const model = document.getElementById('predictor-method').value;
    const details = appState.predictionModels[model];
    
    document.getElementById('model-details').innerHTML = `
        <h3>${details.name}</h3>
        <p>${details.description}</p>
        <p>Estimated Accuracy: ${details.accuracy}</p>
    `;
}

function generatePredictions() {
    const gameType = document.getElementById('predictor-game-type').value;
    const method = document.getElementById('predictor-method').value;
    const count = parseInt(document.getElementById('prediction-count').value);
    
    let mainPool, pickCount, bonusPool, bonusCount;
    switch(gameType) {
        case 'powerball':
            mainPool = 69;
            pickCount = 5;
            bonusPool = 26;
            bonusCount = 1;
            break;
        case 'megamillions':
            mainPool = 70;
            pickCount = 5;
            bonusPool = 25;
            bonusCount = 1;
            break;
        case 'euromillions':
            mainPool = 50;
            pickCount = 5;
            bonusPool = 12;
            bonusCount = 2;
            break;
        case 'lotto649':
            mainPool = 49;
            pickCount = 6;
            bonusPool = 0;
            bonusCount = 0;
            break;
    }
    
    const tickets = [];
    for (let i = 0; i < count; i++) {
        let numbers;
        switch(method) {
            case 'markov':
            case 'neural':
            case 'regression':
            case 'frequency':
            case 'combined':
                numbers = generateAINumbers(gameType, method, pickCount);
                break;
            default:
                numbers = generateRandomNumbers(mainPool, pickCount, 'standard');
        }
        
        const bonusNumbers = bonusCount > 0 ? generateRandomNumbers(bonusPool, bonusCount, 'standard') : [];
        tickets.push({ numbers, bonusNumbers });
    }
    
    displayPredictionResults(tickets);
    updatePredictionChart(tickets);
    showToast(`${count} predictions generated`, 'success', 'brain');
}

function displayPredictionResults(tickets) {
    const container = document.getElementById('prediction-results');
    let html = '';
    
    tickets.forEach((ticket, index) => {
        html += `<div class="result">Prediction #${index + 1}<div class="lotto-balls">`;
        ticket.numbers.forEach(num => {
            html += `<div class="ball">${num}</div>`;
        });
        if (ticket.bonusNumbers.length > 0) {
            const ballClass = document.getElementById('predictor-game-type').value === 'powerball' ? 'powerball' :
                            document.getElementById('predictor-game-type').value === 'megamillions' ? 'megaball' : 'eurostar';
            ticket.bonusNumbers.forEach(num => {
                html += `<div class="ball ${ballClass}">${num}</div>`;
            });
        }
        html += '</div></div>';
    });
    
    container.innerHTML = html;
}

function updatePredictionChart(tickets) {
    const ctx = document.getElementById('prediction-chart').getContext('2d');
    if (appState.charts.predictionChart) {
        appState.charts.predictionChart.destroy();
    }
    
    const gameType = document.getElementById('predictor-game-type').value;
    const mainPool = gameType === 'powerball' ? 69 :
                    gameType === 'megamillions' ? 70 :
                    gameType === 'euromillions' ? 50 : 49;
    
    const frequency = Array(mainPool).fill(0);
    tickets.forEach(ticket => {
        ticket.numbers.forEach(num => {
            frequency[num - 1]++;
        });
    });
    
    appState.charts.predictionChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: Array.from({length: mainPool}, (_, i) => i + 1),
            datasets: [{
                label: 'Prediction Frequency',
                data: frequency,
                backgroundColor: 'rgba(74, 107, 255, 0.7)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: true, title: { display: true, text: 'Frequency' } }
            }
        }
    });
}

function analyzePredictions() {
    const tickets = Array.from(document.getElementById('prediction-results').querySelectorAll('.result'))
        .map(result => ({
            numbers: Array.from(result.querySelectorAll('.ball:not(.powerball):not(.megaball):not(.eurostar)'))
                .map(ball => parseInt(ball.textContent.trim())),
            bonusNumbers: Array.from(result.querySelectorAll('.ball.powerball, .ball.megaball, .ball.eurostar'))
                .map(ball => parseInt(ball.textContent.trim()))
        }));
    
    if (tickets.length === 0) {
        showToast('No predictions to analyze', 'warning', 'exclamation-triangle');
        return;
    }
    
    const container = document.getElementById('prediction-analysis');
    let html = '<h3>Prediction Analysis</h3>';
    
    tickets.forEach((ticket, i) => {
        const sum = ticket.numbers.reduce((a, b) => a + b, 0);
        const evenCount = ticket.numbers.filter(n => n % 2 === 0).length;
        const oddCount = ticket.numbers.length - evenCount;
        const highCount = ticket.numbers.filter(n => n > Math.floor(ticket.numbers[0] / 2)).length;
        const lowCount = ticket.numbers.length - highCount;
        
        html += `
            <h4>Prediction ${i + 1}</h4>
            <p>Sum: ${sum}</p>
            <p>Odd Numbers: ${oddCount}</p>
            <p>Even Numbers: ${evenCount}</p>
            <p>High Numbers: ${highCount}</p>
            <p>Low Numbers: ${lowCount}</p>
        `;
    });
    
    container.innerHTML = html;
    showToast('Prediction analysis completed', 'success', 'chart-bar');
}

function clearPredictions() {
    document.getElementById('prediction-results').innerHTML = 'Generate predictions to see results';
    document.getElementById('prediction-analysis').innerHTML = 'Generate predictions to see analysis';
    
    if (appState.charts.predictionChart) {
        appState.charts.predictionChart.destroy();
        appState.charts.predictionChart = null;
    }
}

function loadSampleData() {
    // Load sample historical data for all game types
    ['powerball', 'megamillions', 'euromillions', 'lotto649'].forEach(gameType => {
        if (!appState.historicalData[gameType]) {
            appState.historicalData[gameType] = generateMockHistory(gameType, 100);
            processHotColdNumbers(gameType, appState.historicalData[gameType]);
        }
    });
}

// Initialize the application
init();
    </script>
</body>
</html>
