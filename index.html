<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotto Pro Advanced</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjs@11.6.0/lib/browser/math.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/regression@2.0.1/dist/regression.min.js"></script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .error { color: red; font-size: 0.875rem; }
        .number-ball {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            margin: 0.25rem;
            font-weight: bold;
            color: white;
        }
        .main-ball { background-color: #3b82f6; }
        .bonus-ball { background-color: #ef4444; }
        .hot-number { background-color: #ef4444; }
        .cold-number { background-color: #3b82f6; }
        .due-number { background-color: #f59e0b; }
        .dark .dark\:bg-gray-800 { background-color: #1f2937; }
        .dark .dark\:bg-gray-900 { background-color: #111827; }
        .dark .dark\:text-white { color: #f9fafb; }
        .dark .dark\:border-gray-700 { border-color: #374151; }
        .dark .dark\:bg-gray-700 { background-color: #374151; }
        .dark .dark\:bg-gray-600 { background-color: #4b5563; }
        .dark .dark\:text-gray-300 { color: #d1d5db; }
        .dark .dark\:bg-blue-700 { background-color: #1d4ed8; }
        .dark .dark\:bg-red-700 { background-color: #b91c1c; }
        .dark .dark\:bg-green-700 { background-color: #15803d; }
        .dark .dark\:bg-yellow-700 { background-color: #a16207; }
        .dark .dark\:bg-purple-700 { background-color: #7e22ce; }
        .dark .dark\:bg-indigo-700 { background-color: #4338ca; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="bg-gray-100 font-sans dark:bg-gray-900 dark:text-white transition-colors duration-300">
    <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-4 text-center shadow-lg">
        <h1 class="text-4xl font-bold">Lotto Pro Advanced</h1>
        <p class="text-xl mt-2">AI-Powered Lottery Prediction & Analysis System</p>
        <div class="flex justify-center mt-2 gap-4">
            <button id="theme-toggle" class="px-3 py-1 bg-white/20 rounded-full hover:bg-white/30 transition" onclick="toggleTheme()">
                <span id="theme-icon">üåô</span> Toggle Theme
            </button>
            <button class="px-3 py-1 bg-white/20 rounded-full hover:bg-white/30 transition" onclick="showNotification('System initialized', 'success')">
                üîî Notifications
            </button>
        </div>
    </header>

    <nav class="bg-gray-800 text-white p-4 shadow-md sticky top-0 z-10">
        <ul class="flex flex-wrap gap-2 justify-center" role="tablist">
            <li><button class="tab-button px-4 py-2 hover:bg-gray-700 rounded transition flex items-center gap-2" onclick="openTab('smart-generator')" role="tab" aria-selected="true">üé∞ Smart Generator</button></li>
            <li><button class="tab-button px-4 py-2 hover:bg-gray-700 rounded transition flex items-center gap-2" onclick="openTab('advanced-analyzer')" role="tab" aria-selected="false">üîç Advanced Analyzer</button></li>
            <li><button class="tab-button px-4 py-2 hover:bg-gray-700 rounded transition flex items-center gap-2" onclick="openTab('historical-data')" role="tab" aria-selected="false">üìä Historical Data</button></li>
            <li><button class="tab-button px-4 py-2 hover:bg-gray-700 rounded transition flex items-center gap-2" onclick="openTab('ai-strategies')" role="tab" aria-selected="false">üß† AI Strategies</button></li>
            <li><button class="tab-button px-4 py-2 hover:bg-gray-700 rounded transition flex items-center gap-2" onclick="openTab('probability-lab')" role="tab" aria-selected="false">üìà Probability Lab</button></li>
            <li><button class="tab-button px-4 py-2 hover:bg-gray-700 rounded transition flex items-center gap-2" onclick="openTab('prediction-engine')" role="tab" aria-selected="false">üîÆ Prediction Engine</button></li>
            <li><button class="tab-button px-4 py-2 hover:bg-gray-700 rounded transition flex items-center gap-2" onclick="openTab('seed-reverse-engineer')" role="tab" aria-selected="false">üõ†Ô∏è Seed Reverse</button></li>
        </ul>
    </nav>

    <main class="container mx-auto p-4 max-w-7xl">
        <!-- Smart Generator Tab -->
        <section id="smart-generator" class="tab-content active" role="tabpanel">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg col-span-1">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                        </svg>
                        Game Configuration
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-gray-300">Lottery Game:</label>
                            <select id="lottery-game" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" onchange="updateLotteryConfig()">
                                <option value="powerball">Powerball (5/69 + 1/26)</option>
                                <option value="mega-millions">Mega Millions (5/70 + 1/25)</option>
                                <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                                <option value="lotto-649">Lotto 6/49</option>
                                <option value="lotto-645">Lotto 6/45</option>
                                <option value="custom">Custom Game</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1 dark:text-gray-300">Main Pool:</label>
                                <input type="number" id="main-pool" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" min="1" value="69">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1 dark:text-gray-300">Pick Count:</label>
                                <input type="number" id="main-pick" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" min="1" value="5">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1 dark:text-gray-300">Bonus Pool:</label>
                                <input type="number" id="bonus-pool" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" min="0" value="26">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1 dark:text-gray-300">Bonus Count:</label>
                                <input type="number" id="bonus-pick" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" min="0" value="1">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-gray-300">Random Seed:</label>
                            <div class="flex gap-2">
                                <input type="text" id="random-seed" class="flex-1 p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Enter seed or leave blank">
                                <button onclick="document.getElementById('random-seed').value = Math.floor(Math.random() * 1000000)" class="bg-gray-600 text-white px-3 rounded hover:bg-gray-700 transition dark:bg-gray-600 dark:hover:bg-gray-500">
                                    Random
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg col-span-1">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                        </svg>
                        Generation Options
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-gray-300">Generation Method:</label>
                            <select id="generation-method" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="standard">Standard Random</option>
                                <option value="fisher-yates">Fisher-Yates Shuffle</option>
                                <option value="crypto">Cryptographically Secure</option>
                                <option value="low-high">Low-High Balance</option>
                                <option value="odd-even">Odd-Even Balance</option>
                                <option value="prime">Prime Number Filter</option>
                                <option value="fibonacci">Fibonacci Filter</option>
                                <option value="statistical">Statistical Weighted</option>
                                <option value="ai">AI-Powered</option>
                            </select>
                        </div>
                        
                        <div id="ai-options" class="hidden space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2" id="use-historical-data"> Use Historical Data
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2" id="use-hot-numbers"> Favor Hot Numbers
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2" id="use-due-numbers"> Include Due Numbers
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2" id="avoid-repeats"> Avoid Recent Repeats
                            </label>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-gray-300">Number of Tickets:</label>
                            <input type="range" id="num-tickets-range" min="1" max="20" value="5" class="w-full" oninput="document.getElementById('num-tickets').value = this.value">
                            <input type="number" id="num-tickets" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" min="1" max="100" value="5" oninput="document.getElementById('num-tickets-range').value = this.value">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-gray-300">Advanced Filters:</label>
                            <div class="grid grid-cols-2 gap-2">
                                <select id="sum-range" class="p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="any">Any Sum</option>
                                    <option value="low">Low Sum</option>
                                    <option value="medium">Medium Sum</option>
                                    <option value="high">High Sum</option>
                                    <option value="custom">Custom Range</option>
                                </select>
                                <select id="consecutive-filter" class="p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="any">Any Consecutives</option>
                                    <option value="none">No Consecutives</option>
                                    <option value="1">Max 1 Pair</option>
                                    <option value="2">Max 2 Pairs</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg col-span-1">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                        </svg>
                        Quick Actions
                    </h2>
                    <div class="space-y-3">
                        <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition flex items-center justify-center gap-2" onclick="generateTickets()">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                            </svg>
                            Generate Smart Numbers
                        </button>
                        <button class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg transition flex items-center justify-center gap-2" onclick="quickPick()">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z" />
                            </svg>
                            Quick Pick (Random)
                        </button>
                        <button class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-lg transition flex items-center justify-center gap-2" onclick="generateWheelingSystem()">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
                            </svg>
                            Generate Wheeling System
                        </button>
                        <button class="w-full bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-lg transition flex items-center justify-center gap-2" onclick="clearTickets()">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                            </svg>
                            Clear All
                        </button>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                        <p class="text-sm text-gray-600 dark:text-gray-400">Tip: Use AI-Powered generation with historical data for statistically optimized numbers.</p>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                        Generated Tickets
                    </h2>
                    <div class="flex gap-2">
                        <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition flex items-center gap-2" onclick="exportTickets('txt')">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                            TXT
                        </button>
                        <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition flex items-center gap-2" onclick="exportTickets('csv')">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                            CSV
                        </button>
                        <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition flex items-center gap-2" onclick="copyToClipboard()">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                                <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                            </svg>
                            Copy
                        </button>
                    </div>
                </div>
                
                <div id="generated-tickets-container" class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg">
                    <div id="generated-tickets" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="p-4 bg-white dark:bg-gray-600 rounded-lg shadow text-center">
                            <p class="text-gray-500 dark:text-gray-300">Generate some numbers to see results</p>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg">
                        <h3 class="font-semibold text-blue-800 dark:text-blue-200">Number Frequency</h3>
                        <div id="frequency-stats" class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                            Frequency analysis will appear here after generation.
                        </div>
                    </div>
                    <div class="bg-green-50 dark:bg-green-900/30 p-4 rounded-lg">
                        <h3 class="font-semibold text-green-800 dark:text-green-200">Sum Analysis</h3>
                        <div id="sum-stats" class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                            Sum statistics will appear here after generation.
                        </div>
                    </div>
                    <div class="bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg">
                        <h3 class="font-semibold text-purple-800 dark:text-purple-200">Pattern Analysis</h3>
                        <div id="pattern-stats" class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                            Pattern analysis will appear here after generation.
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Advanced Analyzer Tab -->
        <section id="advanced-analyzer" class="tab-content" role="tabpanel">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg col-span-1">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                        </svg>
                        Analysis Input
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-gray-300">Lottery Game:</label>
                            <select id="analyzer-game" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="powerball">Powerball (5/69 + 1/26)</option>
                                <option value="mega-millions">Mega Millions (5/70 + 1/25)</option>
                                <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                                <option value="lotto-649">Lotto 6/49</option>
                                <option value="lotto-645">Lotto 6/45</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-gray-300">Numbers to Analyze:</label>
                            <textarea id="numbers-to-analyze" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" rows="4" placeholder="Enter numbers separated by commas or spaces, or one set per line"></textarea>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2">
                            <button class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition flex items-center justify-center gap-2" onclick="analyzeNumbers()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                                </svg>
                                Analyze
                            </button>
                            <button class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg transition flex items-center justify-center gap-2" onclick="clearAnalysis()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                                Clear
                            </button>
                        </div>
                        
                        <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                            <h3 class="font-medium mb-2">Sample Input Formats:</h3>
                            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                <li>‚Ä¢ 5, 12, 23, 34, 45, 6</li>
                                <li>‚Ä¢ 5 12 23 34 45 6</li>
                                <li>‚Ä¢ 5-12-23-34-45-6</li>
                                <li>‚Ä¢ One set per line for multiple tickets</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg col-span-2">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                            </svg>
                            Analysis Results
                        </h2>
                        <div class="flex gap-2">
                            <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition flex items-center gap-2" onclick="exportAnalysis('txt')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                                Export
                            </button>
                        </div>
                    </div>
                    
                    <div id="analysis-results-container" class="space-y-6">
                        <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg text-center">
                            <p class="text-gray-500 dark:text-gray-300">Enter numbers to analyze them</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 hidden" id="analysis-stats">
                            <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg">
                                <h3 class="font-semibold text-blue-800 dark:text-blue-200 mb-2">Basic Statistics</h3>
                                <div id="basic-stats" class="text-sm"></div>
                            </div>
                            <div class="bg-green-50 dark:bg-green-900/30 p-4 rounded-lg">
                                <h3 class="font-semibold text-green-800 dark:text-green-200 mb-2">Number Properties</h3>
                                <div id="number-properties" class="text-sm"></div>
                            </div>
                            <div class="bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg">
                                <h3 class="font-semibold text-purple-800 dark:text-purple-200 mb-2">Pattern Analysis</h3>
                                <div id="pattern-analysis" class="text-sm"></div>
                            </div>
                            <div class="bg-yellow-50 dark:bg-yellow-900/30 p-4 rounded-lg">
                                <h3 class="font-semibold text-yellow-800 dark:text-yellow-200 mb-2">Advanced Metrics</h3>
                                <div id="advanced-metrics" class="text-sm"></div>
                            </div>
                        </div>
                        
                        <div class="hidden" id="analysis-charts">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                                    <h3 class="font-semibold mb-2">Number Frequency Distribution</h3>
                                    <canvas id="frequency-chart" height="250"></canvas>
                                </div>
                                <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                                    <h3 class="font-semibold mb-2">Last Digit Distribution</h3>
                                    <canvas id="last-digit-chart" height="250"></canvas>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                                    <h3 class="font-semibold mb-2">Number Sum Distribution</h3>
                                    <canvas id="sum-chart" height="250"></canvas>
                                </div>
                                <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                                    <h3 class="font-semibold mb-2">Odd/Even Distribution</h3>
                                    <canvas id="odd-even-chart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Historical Data Tab -->
        <section id="historical-data" class="tab-content" role="tabpanel">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg col-span-1">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        Data Configuration
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-gray-300">Lottery Game:</label>
                            <select id="history-game" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="powerball">Powerball (5/69 + 1/26)</option>
                                <option value="mega-millions">Mega Millions (5/70 + 1/25)</option>
                                <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                                <option value="lotto-649">Lotto 6/49</option>
                                <option value="lotto-645">Lotto 6/45</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-gray-300">Data Source:</label>
                            <select id="data-source" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="sample">Sample Data (Built-in)</option>
                                <option value="api" disabled>Live API (Premium)</option>
                                <option value="upload">Upload CSV</option>
                            </select>
                        </div>
                        
                        <div id="sample-data-options">
                            <label class="block text-sm font-medium mb-1 dark:text-gray-300">Number of Past Draws:</label>
                            <input type="range" id="num-draws-range" min="10" max="500" value="100" step="10" class="w-full" oninput="document.getElementById('num-draws').value = this.value">
                            <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 px-1">
                                <span>10</span>
                                <span>100</span>
                                <span>500</span>
                            </div>
                            <input type="number" id="num-draws" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white mt-1" min="10" max="500" value="100" oninput="document.getElementById('num-draws-range').value = this.value">
                        </div>
                        
                        <div id="upload-data-options" class="hidden">
                            <label class="block text-sm font-medium mb-1 dark:text-gray-300">Upload CSV File:</label>
                            <input type="file" id="csv-upload" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" accept=".csv">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">CSV format: Date,Number1,Number2,...,Bonus1,Bonus2</p>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2">
                            <button class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition flex items-center justify-center gap-2" onclick="loadHistory()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                                </svg>
                                Load Data
                            </button>
                            <button class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg transition flex items-center justify-center gap-2" onclick="clearHistory()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                                Clear
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg col-span-2">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                            </svg>
                            Historical Data Analysis
                        </h2>
                        <div class="flex gap-2">
                            <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition flex items-center gap-2" onclick="exportHistory('csv')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                                Export
                            </button>
                        </div>
                    </div>
                    
                    <div id="history-results-container" class="space-y-6">
                        <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg text-center">
                            <p class="text-gray-500 dark:text-gray-300">Load historical data to see results</p>
                        </div>
                        
                        <div class="hidden" id="history-stats">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg">
                                    <h3 class="font-semibold text-blue-800 dark:text-blue-200 mb-2">Data Summary</h3>
                                    <div id="data-summary" class="text-sm"></div>
                                </div>
                                <div class="bg-green-50 dark:bg-green-900/30 p-4 rounded-lg">
                                    <h3 class="font-semibold text-green-800 dark:text-green-200 mb-2">Most Frequent Numbers</h3>
                                    <div id="frequent-numbers" class="text-sm"></div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow mb-4">
                                <h3 class="font-semibold mb-2">Number Frequency Heatmap</h3>
                                <canvas id="heatmap-chart" height="350"></canvas>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                                    <h3 class="font-semibold mb-2">Frequency Over Time</h3>
                                    <canvas id="frequency-trend-chart" height="250"></canvas>
                                </div>
                                <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                                    <h3 class="font-semibold mb-2">Gap Analysis</h3>
                                    <canvas id="gap-chart" height="250"></canvas>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                                <h3 class="font-semibold mb-2">Historical Draws</h3>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Date</th>
                                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Numbers</th>
                                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Bonus</th>
                                            </tr>
                                        </thead>
                                        <tbody id="history-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        </tbody>
                                    </table>
                                </div>
                                <div class="mt-2 flex justify-between items-center">
                                    <div class="text-sm text-gray-500 dark:text-gray-400" id="history-pagination-info"></div>
                                    <div class="flex gap-1">
                                        <button class="px-3 py-1 border rounded dark:border-gray-600" id="prev-page">&lt;</button>
                                        <button class="px-3 py-1 border rounded dark:border-gray-600" id="next-page">&gt;</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- AI Strategies Tab -->
        <section id="ai-strategies" class="tab-content" role="tabpanel">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                    </svg>
                    AI-Powered Lottery Strategies
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-blue-600 to-indigo-700 text-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold mb-2">Frequency Analysis</h3>
                        <p class="mb-4">Identifies hot (frequently drawn) and cold (rarely drawn) numbers based on historical data.</p>
                        <button class="bg-white text-blue-600 hover:bg-blue-50 px-4 py-2 rounded-lg transition font-medium" onclick="applyStrategy('frequency')">Apply Strategy</button>
                    </div>
                    <div class="bg-gradient-to-br from-purple-600 to-pink-600 text-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold mb-2">Gap Analysis</h3>
                        <p class="mb-4">Finds numbers that are "due" to be drawn based on the time since their last appearance.</p>
                        <button class="bg-white text-purple-600 hover:bg-purple-50 px-4 py-2 rounded-lg transition font-medium" onclick="applyStrategy('gap')">Apply Strategy</button>
                    </div>
                    <div class="bg-gradient-to-br from-green-600 to-teal-600 text-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold mb-2">Pattern Recognition</h3>
                        <p class="mb-4">Detects number patterns and sequences that frequently occur in winning combinations.</p>
                        <button class="bg-white text-green-600 hover:bg-green-50 px-4 py-2 rounded-lg transition font-medium" onclick="applyStrategy('pattern')">Apply Strategy</button>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-700 p-6 rounded-xl shadow-lg mb-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" />
                        </svg>
                        Custom Strategy Builder
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium mb-2 dark:text-gray-300">Strategy Components:</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" name="strategy-component" value="frequency" checked>
                                    Number Frequency
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" name="strategy-component" value="gap" checked>
                                    Gap Analysis
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" name="strategy-component" value="pattern">
                                    Pattern Recognition
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" name="strategy-component" value="sum">
                                    Sum Analysis
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" name="strategy-component" value="prime">
                                    Prime Numbers
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" name="strategy-component" value="fibonacci">
                                    Fibonacci Numbers
                                </label>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 dark:text-gray-300">Weighting:</label>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-xs mb-1 dark:text-gray-400">Frequency Importance:</label>
                                    <input type="range" min="0" max="100" value="40" class="w-full" id="frequency-weight">
                                </div>
                                <div>
                                    <label class="block text-xs mb-1 dark:text-gray-400">Gap Importance:</label>
                                    <input type="range" min="0" max="100" value="30" class="w-full" id="gap-weight">
                                </div>
                                <div>
                                    <label class="block text-xs mb-1 dark:text-gray-400">Pattern Importance:</label>
                                    <input type="range" min="0" max="100" value="20" class="w-full" id="pattern-weight">
                                </div>
                                <div>
                                    <label class="block text-xs mb-1 dark:text-gray-400">Other Importance:</label>
                                    <input type="range" min="0" max="100" value="10" class="w-full" id="other-weight">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6">
                        <button class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition font-medium flex items-center gap-2 mx-auto" onclick="buildCustomStrategy()">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
                            </svg>
                            Build & Apply Custom Strategy
                        </button>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-700 p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9z" clip-rule="evenodd" />
                        </svg>
                        Strategy Results & Recommendations
                    </h3>
                    <div id="strategy-results" class="space-y-4">
                        <div class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg text-center">
                            <p class="text-gray-500 dark:text-gray-300">Apply a strategy to see recommendations</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Probability Lab Tab -->
        <section id="probability-lab" class="tab-content" role="tabpanel">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg col-span-1">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                        Probability Calculator
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-gray-300">Lottery Game:</label>
                            <select id="probability-game" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" onchange="updateProbabilityConfig()">
                                <option value="powerball">Powerball (5/69 + 1/26)</option>
                                <option value="mega-millions">Mega Millions (5/70 + 1/25)</option>
                                <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                                <option value="lotto-649">Lotto 6/49</option>
                                <option value="lotto-645">Lotto 6/45</option>
                                <option value="custom">Custom Game</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1 dark:text-gray-300">Main Pool:</label>
                                <input type="number" id="prob-main-pool" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" min="1" value="69">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1 dark:text-gray-300">Pick Count:</label>
                                <input type="number" id="prob-main-pick" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" min="1" value="5">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1 dark:text-gray-300">Bonus Pool:</label>
                                <input type="number" id="prob-bonus-pool" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" min="0" value="26">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1 dark:text-gray-300">Bonus Count:</label>
                                <input type="number" id="prob-bonus-pick" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" min="0" value="1">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-gray-300">Tickets to Play:</label>
                            <input type="number" id="prob-tickets" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" min="1" value="1">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2">
                            <button class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition flex items-center justify-center gap-2" onclick="calculateProbability()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" />
                                </svg>
                                Calculate
                            </button>
                            <button class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg transition flex items-center justify-center gap-2" onclick="resetProbability()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                                Reset
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg col-span-2">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                            </svg>
                            Probability Results
                        </h2>
                        <div class="flex gap-2">
                            <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition flex items-center gap-2" onclick="exportProbability('pdf')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                                Export
                            </button>
                        </div>
                    </div>
                    
                    <div id="probability-results-container" class="space-y-6">
                        <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg text-center">
                            <p class="text-gray-500 dark:text-gray-300">Calculate probabilities to see results</p>
                        </div>
                        
                        <div class="hidden" id="probability-results">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg">
                                    <h3 class="font-semibold text-blue-800 dark:text-blue-200 mb-2">Basic Probabilities</h3>
                                    <div id="basic-probabilities" class="text-sm"></div>
                                </div>
                                <div class="bg-green-50 dark:bg-green-900/30 p-4 rounded-lg">
                                    <h3 class="font-semibold text-green-800 dark:text-green-200 mb-2">Winning Chances</h3>
                                    <div id="winning-chances" class="text-sm"></div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow mb-4">
                                <h3 class="font-semibold mb-2">Probability Distribution</h3>
                                <canvas id="probability-chart" height="350"></canvas>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                                <h3 class="font-semibold mb-2">Expected Value Analysis</h3>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg">
                                        <h4 class="font-medium text-purple-800 dark:text-purple-200 mb-1">Jackpot Size</h4>
                                        <input type="range" id="jackpot-size" min="1000000" max="1000000000" step="1000000" value="10000000" class="w-full mb-2">
                                        <input type="number" id="jackpot-value" class="w-full p-2 border rounded dark:bg-gray-600 dark:border-gray-500 dark:text-white" value="10000000" oninput="updateExpectedValue()">
                                    </div>
                                    <div class="bg-yellow-50 dark:bg-yellow-900/30 p-4 rounded-lg">
                                        <h4 class="font-medium text-yellow-800 dark:text-yellow-200 mb-1">Tax Rate (%)</h4>
                                        <input type="range" id="tax-rate" min="0" max="50" step="1" value="30" class="w-full mb-2">
                                        <input type="number" id="tax-value" class="w-full p-2 border rounded dark:bg-gray-600 dark:border-gray-500 dark:text-white" value="30" oninput="updateExpectedValue()">
                                    </div>
                                    <div class="bg-indigo-50 dark:bg-indigo-900/30 p-4 rounded-lg">
                                        <h4 class="font-medium text-indigo-800 dark:text-indigo-200 mb-1">Expected Value</h4>
                                        <div id="expected-value" class="text-2xl font-bold text-indigo-600 dark:text-indigo-300">$0.00</div>
                                        <div id="ev-explanation" class="text-xs text-gray-500 dark:text-gray-400 mt-1"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Prediction Engine Tab -->
        <section id="prediction-engine" class="tab-content" role="tabpanel">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    AI Prediction Engine
                </h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-blue-600 to-indigo-700 text-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold mb-2">Next Draw Prediction</h3>
                        <p class="mb-4">Our AI analyzes historical patterns and trends to predict the most likely numbers for the next draw.</p>
                        <button class="bg-white text-blue-600 hover:bg-blue-50 px-4 py-2 rounded-lg transition font-medium" onclick="predictNextDraw()">
                            Generate Prediction
                        </button>
                    </div>
                    <div class="bg-gradient-to-br from-purple-600 to-pink-600 text-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold mb-2">Multiple Draw Forecast</h3>
                        <p class="mb-4">Get predictions for several upcoming draws with confidence scores for each number.</p>
                        <button class="bg-white text-purple-600 hover:bg-purple-50 px-4 py-2 rounded-lg transition font-medium" onclick="predictMultipleDraws()">
                            Forecast Next 5 Draws
                        </button>
                    </div>
                    <div class="bg-gradient-to-br from-green-600 to-teal-600 text-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold mb-2">Custom Prediction</h3>
                        <p class="mb-4">Configure specific parameters for the AI to focus on certain patterns or trends.</p>
                        <button class="bg-white text-green-600 hover:bg-green-50 px-4 py-2 rounded-lg transition font-medium" onclick="showCustomPredictionModal()">
                            Customize Prediction
                        </button>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-700 p-6 rounded-xl shadow-lg mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9z" clip-rule="evenodd" />
                            </svg>
                            Prediction Results
                        </h3>
                        <div class="flex gap-2">
                            <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition flex items-center gap-2" onclick="exportPredictions('csv')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                                Export
                            </button>
                        </div>
                    </div>
                    
                    <div id="prediction-results-container" class="space-y-6">
                        <div class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg text-center">
                            <p class="text-gray-500 dark:text-gray-300">Generate predictions to see results</p>
                        </div>
                        
                        <div class="hidden" id="prediction-results">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg">
                                    <h3 class="font-semibold text-blue-800 dark:text-blue-200 mb-2">Predicted Numbers</h3>
                                    <div id="predicted-numbers" class="flex flex-wrap gap-2"></div>
                                </div>
                                <div class="bg-green-50 dark:bg-green-900/30 p-4 rounded-lg">
                                    <h3 class="font-semibold text-green-800 dark:text-green-200 mb-2">Confidence Scores</h3>
                                    <div id="confidence-scores" class="text-sm"></div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow mb-4">
                                <h3 class="font-semibold mb-2">Prediction Visualization</h3>
                                <canvas id="prediction-chart" height="350"></canvas>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                                <h3 class="font-semibold mb-2">Prediction Analysis</h3>
                                <div id="prediction-analysis" class="text-sm"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-700 p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                        How Our AI Works
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold mb-2 text-blue-600 dark:text-blue-400">Machine Learning Models</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">
                                Our prediction engine uses an ensemble of machine learning models including Random Forests, 
                                Gradient Boosting, and Neural Networks to analyze historical lottery data and identify 
                                complex patterns that may influence future draws.
                            </p>
                            <h4 class="font-semibold mb-2 text-purple-600 dark:text-purple-400">Statistical Analysis</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">
                                Advanced statistical methods like Markov Chains, Monte Carlo simulations, and Bayesian 
                                inference are applied to calculate probabilities and identify trends beyond simple frequency 
                                analysis.
                            </p>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2 text-green-600 dark:text-green-400">Pattern Recognition</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">
                                The AI examines number sequences, gaps between numbers, sum distributions, and other 
                                mathematical properties to detect subtle patterns that might indicate higher probability 
                                combinations.
                            </p>
                            <h4 class="font-semibold mb-2 text-yellow-600 dark:text-yellow-400">Limitations</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-300">
                                While our AI provides sophisticated analysis, lottery draws are fundamentally random. 
                                These predictions should be used for entertainment purposes only, with no guarantee of 
                                winning.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seed Reverse Engineer Tab -->
        <section id="seed-reverse-engineer" class="tab-content" role="tabpanel">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg col-span-1">
                    <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                        </svg>
                        Seed Input
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-gray-300">Lottery Game:</label>
                            <select id="reverse-game" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" onchange="updateReverseConfig()">
                                <option value="powerball">Powerball (5/69 + 1/26)</option>
                                <option value="mega-millions">Mega Millions (5/70 + 1/25)</option>
                                <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                                <option value="lotto-649">Lotto 6/49</option>
                                <option value="lotto-645">Lotto 6/45</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-gray-300">Generated Numbers:</label>
                            <textarea id="generated-numbers" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" rows="4" placeholder="Enter numbers separated by commas or spaces"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1 dark:text-gray-300">Generation Method:</label>
                            <select id="reverse-method" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="standard">Standard Random</option>
                                <option value="fisher-yates">Fisher-Yates Shuffle</option>
                                <option value="crypto">Cryptographically Secure</option>
                                <option value="low-high">Low-High Balance</option>
                                <option value="odd-even">Odd-Even Balance</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2">
                            <button class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition flex items-center justify-center gap-2" onclick="reverseEngineerSeed()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                                </svg>
                                Reverse Engineer
                            </button>
                            <button class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg transition flex items-center justify-center gap-2" onclick="clearReverse()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                                Clear
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg col-span-2">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                            </svg>
                            Seed Analysis Results
                        </h2>
                        <div class="flex gap-2">
                            <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition flex items-center gap-2" onclick="exportSeedResults('txt')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                                Export
                            </button>
                        </div>
                    </div>
                    
                    <div id="seed-results-container" class="space-y-6">
                        <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg text-center">
                            <p class="text-gray-500 dark:text-gray-300">Enter numbers to see potential seed results</p>
                        </div>
                        
                        <div class="hidden" id="seed-results">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg">
                                    <h3 class="font-semibold text-blue-800 dark:text-blue-200 mb-2">Possible Seeds</h3>
                                    <div id="possible-seeds" class="text-sm"></div>
                                </div>
                                <div class="bg-green-50 dark:bg-green-900/30 p-4 rounded-lg">
                                    <h3 class="font-semibold text-green-800 dark:text-green-200 mb-2">Seed Validation</h3>
                                    <div id="seed-validation" class="text-sm"></div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow mb-4">
                                <h3 class="font-semibold mb-2">Seed Generation Test</h3>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Seed</th>
                                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Generated Numbers</th>
                                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Match</th>
                                            </tr>
                                        </thead>
                                        <tbody id="seed-test-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow">
                                <h3 class="font-semibold mb-2">Seed Analysis</h3>
                                <div id="seed-analysis" class="text-sm"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Custom Prediction Modal -->
    <div id="custom-prediction-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl p-6 w-full max-w-2xl">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">Custom Prediction Settings</h3>
                <button onclick="document.getElementById('custom-prediction-modal').classList.add('hidden')" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1 dark:text-gray-300">Prediction Model:</label>
                    <select id="prediction-model" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <option value="ensemble">Ensemble Model (Recommended)</option>
                        <option value="random-forest">Random Forest</option>
                        <option value="neural-network">Neural Network</option>
                        <option value="markov-chain">Markov Chain</option>
                        <option value="bayesian">Bayesian Network</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-1 dark:text-gray-300">Historical Data Range:</label>
                    <select id="history-range" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <option value="1">Last Year</option>
                        <option value="3" selected>Last 3 Years</option>
                        <option value="5">Last 5 Years</option>
                        <option value="10">Last 10 Years</option>
                        <option value="all">All Available Data</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-1 dark:text-gray-300">Focus Parameters:</label>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2" id="focus-frequency" checked>
                                Number Frequency
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2" id="focus-gaps" checked>
                                Gap Analysis
                            </label>
                        </div>
                        <div>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2" id="focus-patterns">
                                Number Patterns
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2" id="focus-sum">
                                Sum Analysis
                            </label>
                        </div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-1 dark:text-gray-300">Number of Predictions:</label>
                    <input type="number" id="num-predictions" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" min="1" max="20" value="5">
                </div>
                
                <div class="pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-2">
                    <button onclick="document.getElementById('custom-prediction-modal').classList.add('hidden')" class="px-4 py-2 border rounded-lg dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                        Cancel
                    </button>
                    <button onclick="runCustomPrediction()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition font-medium">
                        Run Prediction
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification-toast" class="fixed bottom-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-16 transition-transform duration-300 z-50 hidden">
        <div class="flex items-center gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span id="notification-message">Operation completed successfully!</span>
        </div>
    </div>

    <footer class="bg-gray-800 text-white p-6 mt-8">
        <div class="container mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-lg font-bold mb-4">Lotto Pro Advanced</h3>
                    <p class="text-gray-400">Advanced lottery prediction and analysis system powered by AI and statistical algorithms.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition" onclick="openTab('smart-generator')">Smart Generator</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition" onclick="openTab('advanced-analyzer')">Advanced Analyzer</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition" onclick="openTab('historical-data')">Historical Data</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition" onclick="openTab('ai-strategies')">AI Strategies</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Disclaimer</h3>
                    <p class="text-gray-400 text-sm">This application is for entertainment purposes only. There is no guarantee that using this system will result in winning lottery numbers. Please play responsibly.</p>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-400 text-sm">
                &copy; 2023 Lotto Pro Advanced. All rights reserved.
            </div>
        </div>
    </footer>

    <script>
        // Enhanced Lottery configurations
        const lotteryConfigs = {
            powerball: { mainPool: 69, mainPick: 5, bonusPool: 26, bonusPick: 1, name: "Powerball" },
            'mega-millions': { mainPool: 70, mainPick: 5, bonusPool: 25, bonusPick: 1, name: "Mega Millions" },
            euromillions: { mainPool: 50, mainPick: 5, bonusPool: 12, bonusPick: 2, name: "EuroMillions" },
            'lotto-649': { mainPool: 49, mainPick: 6, bonusPool: 0, bonusPick: 0, name: "Lotto 6/49" },
            'lotto-645': { mainPool: 45, mainPick: 6, bonusPool: 0, bonusPick: 0, name: "Lotto 6/45" },
            custom: { mainPool: 69, mainPick: 5, bonusPool: 26, bonusPick: 1, name: "Custom Game" }
        };

        // Sample historical data for demonstration
        const sampleHistoricalData = {
            powerball: generateSampleData(69, 26, 100),
            'mega-millions': generateSampleData(70, 25, 100),
            euromillions: generateSampleData(50, 12, 100),
            'lotto-649': generateSampleData(49, 0, 100),
            'lotto-645': generateSampleData(45, 0, 100)
        };

        // Global variables
        let generatedTickets = [];
        let analysisResults = {};
        let historicalData = [];
        let currentHistoryPage = 1;
        const HISTORY_PER_PAGE = 10;
        let charts = {};
        let currentTheme = localStorage.getItem('theme') || 'light';

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            updateLotteryConfig();
            updateReverseConfig();
            updateProbabilityConfig();
            applyTheme();
            setupEventListeners();
            
            // Check for saved theme preference
            if (localStorage.getItem('theme') === 'dark' || 
                (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.getElementById('theme').value = 'dark';
                applyTheme();
            }
            
            // Initialize charts placeholder
            initializeChartPlaceholders();
        });

        function setupEventListeners() {
            // Data source change
            document.getElementById('data-source').addEventListener('change', function() {
                if (this.value === 'upload') {
                    document.getElementById('sample-data-options').classList.add('hidden');
                    document.getElementById('upload-data-options').classList.remove('hidden');
                } else {
                    document.getElementById('sample-data-options').classList.remove('hidden');
                    document.getElementById('upload-data-options').classList.add('hidden');
                }
            });
            
            // Generation method change
            document.getElementById('generation-method').addEventListener('change', function() {
                if (this.value === 'ai') {
                    document.getElementById('ai-options').classList.remove('hidden');
                } else {
                    document.getElementById('ai-options').classList.add('hidden');
                }
            });
            
            // History pagination
            document.getElementById('prev-page').addEventListener('click', function() {
                if (currentHistoryPage > 1) {
                    currentHistoryPage--;
                    renderHistoryTable();
                }
            });
            
            document.getElementById('next-page').addEventListener('click', function() {
                const totalPages = Math.ceil(historicalData.length / HISTORY_PER_PAGE);
                if (currentHistoryPage < totalPages) {
                    currentHistoryPage++;
                    renderHistoryTable();
                }
            });
        }

        function initializeChartPlaceholders() {
            // Initialize all chart canvases with empty data
            const chartIds = [
                'frequency-chart', 'last-digit-chart', 'sum-chart', 'odd-even-chart',
                'heatmap-chart', 'frequency-trend-chart', 'gap-chart',
                'probability-chart', 'prediction-chart'
            ];
            
            chartIds.forEach(id => {
                const ctx = document.getElementById(id).getContext('2d');
                charts[id] = new Chart(ctx, {
                    type: 'bar',
                    data: { labels: [], datasets: [] },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            });
        }

        function updateLotteryConfig() {
            const game = document.getElementById('lottery-game').value;
            const config = lotteryConfigs[game];
            document.getElementById('main-pool').value = config.mainPool;
            document.getElementById('main-pick').value = config.mainPick;
            document.getElementById('bonus-pool').value = config.bonusPool;
            document.getElementById('bonus-pick').value = config.bonusPick;
            document.getElementById('main-pool').disabled = game !== 'custom';
            document.getElementById('main-pick').disabled = game !== 'custom';
            document.getElementById('bonus-pool').disabled = game !== 'custom';
            document.getElementById('bonus-pick').disabled = game !== 'custom';
        }

        function updateReverseConfig() {
            const game = document.getElementById('reverse-game').value;
            const config = lotteryConfigs[game];
            // Update placeholder or other UI elements if needed
        }

        function updateProbabilityConfig() {
            const game = document.getElementById('probability-game').value;
            const config = lotteryConfigs[game];
            document.getElementById('prob-main-pool').value = config.mainPool;
            document.getElementById('prob-main-pick').value = config.mainPick;
            document.getElementById('prob-bonus-pool').value = config.bonusPool;
            document.getElementById('prob-bonus-pick').value = config.bonusPick;
            document.getElementById('prob-main-pool').disabled = game !== 'custom';
            document.getElementById('prob-main-pick').disabled = game !== 'custom';
            document.getElementById('prob-bonus-pool').disabled = game !== 'custom';
            document.getElementById('prob-bonus-pick').disabled = game !== 'custom';
        }

        function openTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.setAttribute('aria-selected', 'false'));
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`button[onclick="openTab('${tabId}')"]`).setAttribute('aria-selected', 'true');
            
            // Destroy and recreate charts when tab becomes active to prevent rendering issues
            if (tabId === 'advanced-analyzer' && analysisResults.numbers) {
                renderAnalysisCharts();
            }
            if (tabId === 'historical-data' && historicalData.length > 0) {
                renderHistoryCharts();
            }
            if (tabId === 'probability-lab' && document.getElementById('probability-results').classList.contains('hidden') === false) {
                renderProbabilityCharts();
            }
            if (tabId === 'prediction-engine' && document.getElementById('prediction-results').classList.contains('hidden') === false) {
                renderPredictionCharts();
            }
        }

        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            localStorage.setItem('theme', currentTheme);
            applyTheme();
            
            // Update theme icon
            const themeIcon = document.getElementById('theme-icon');
            themeIcon.textContent = currentTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            
            showNotification(`Switched to ${currentTheme} theme`, 'success');
        }

        function applyTheme() {
            if (currentTheme === 'dark') {
                document.documentElement.classList.add('dark');
                document.body.classList.add('dark', 'bg-gray-900', 'text-white');
                document.body.classList.remove('bg-gray-100');
            } else {
                document.documentElement.classList.remove('dark');
                document.body.classList.remove('dark', 'bg-gray-900', 'text-white');
                document.body.classList.add('bg-gray-100');
            }
        }

        function showNotification(message, type = 'success') {
            const toast = document.getElementById('notification-toast');
            const messageEl = document.getElementById('notification-message');
            
            // Set message and style based on type
            messageEl.textContent = message;
            toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg transform translate-y-16 transition-transform duration-300 z-50 flex items-center gap-3 ${type === 'success' ? 'bg-green-600' : type === 'error' ? 'bg-red-600' : 'bg-blue-600'} text-white`;
            
            // Show the toast
            toast.classList.remove('hidden');
            setTimeout(() => toast.style.transform = 'translateY(0)', 10);
            
            // Hide after 5 seconds
            setTimeout(() => {
                toast.style.transform = 'translateY(16rem)';
                setTimeout(() => toast.classList.add('hidden'), 300);
            }, 5000);
        }

        function generateSampleData(mainPool, bonusPool, count) {
            const data = [];
            const now = new Date();
            
            for (let i = 0; i < count; i++) {
                const date = new Date(now);
                date.setDate(date.getDate() - i * 7); // Weekly draws
                
                const mainNumbers = [];
                const numbers = Array.from({ length: mainPool }, (_, i) => i + 1);
                
                // Fisher-Yates shuffle
                for (let j = numbers.length - 1; j > 0; j--) {
                    const k = Math.floor(Math.random() * (j + 1));
                    [numbers[j], numbers[k]] = [numbers[k], numbers[j]];
                }
                
                mainNumbers.push(...numbers.slice(0, 5).sort((a, b) => a - b));
                
                let bonusNumbers = [];
                if (bonusPool > 0) {
                    const bonus = Array.from({ length: bonusPool }, (_, i) => i + 1);
                    for (let j = bonus.length - 1; j > 0; j--) {
                        const k = Math.floor(Math.random() * (j + 1));
                        [bonus[j], bonus[k]] = [bonus[k], bonus[j]];
                    }
                    bonusNumbers.push(...bonus.slice(0, bonusPool === 26 ? 1 : 2).sort((a, b) => a - b));
                }
                
                data.push({
                    date: date.toISOString().split('T')[0],
                    numbers: mainNumbers,
                    bonus: bonusNumbers
                });
            }
            
            return data;
        }

        function generateTickets() {
            const game = document.getElementById('lottery-game').value;
            const config = lotteryConfigs[game];
            const mainPool = parseInt(document.getElementById('main-pool').value) || config.mainPool;
            const mainPick = parseInt(document.getElementById('main-pick').value) || config.mainPick;
            const bonusPool = parseInt(document.getElementById('bonus-pool').value) || config.bonusPool;
            const bonusPick = parseInt(document.getElementById('bonus-pick').value) || config.bonusPick;
            const numTickets = parseInt(document.getElementById('num-tickets').value) || 1;
            const seed = document.getElementById('random-seed').value || Date.now();
            const method = document.getElementById('generation-method').value;
            
            // Validate inputs
            if (mainPick > mainPool || bonusPick > bonusPool) {
                showNotification('Cannot pick more numbers than available in pool.', 'error');
                return;
            }
            if (numTickets < 1 || numTickets > 100) {
                showNotification('Number of tickets must be between 1 and 100.', 'error');
                return;
            }
            
            // Generate tickets
            generatedTickets = [];
            let seedValue = parseInt(seed);
            
            function seededRandom() {
                seedValue = (seedValue * 9301 + 49297) % 233280;
                return seedValue / 233280;
            }
            
            for (let i = 0; i < numTickets; i++) {
                let mainNumbers = [];
                let bonusNumbers = [];
                
                // Generate main numbers based on selected method
                switch (method) {
                    case 'fisher-yates':
                        let numbers = Array.from({ length: mainPool }, (_, i) => i + 1);
                        for (let j = numbers.length - 1; j > 0; j--) {
                            const k = Math.floor(seededRandom() * (j + 1));
                            [numbers[j], numbers[k]] = [numbers[k], numbers[j]];
                        }
                        mainNumbers = numbers.slice(0, mainPick).sort((a, b) => a - b);
                        break;
                        
                    case 'low-high':
                        const low = Array.from({ length: Math.floor(mainPool / 2) }, (_, i) => i + 1);
                        const high = Array.from({ length: Math.ceil(mainPool / 2) }, (_, i) => i + 1 + Math.floor(mainPool / 2));
                        
                        const lowPick = Math.ceil(mainPick / 2);
                        const highPick = Math.floor(mainPick / 2);
                        
                        for (let j = 0; j < lowPick; j++) {
                            const index = Math.floor(seededRandom() * low.length);
                            mainNumbers.push(low.splice(index, 1)[0]);
                        }
                        for (let j = 0; j < highPick; j++) {
                            const index = Math.floor(seededRandom() * high.length);
                            mainNumbers.push(high.splice(index, 1)[0]);
                        }
                        mainNumbers.sort((a, b) => a - b);
                        break;
                        
                    case 'odd-even':
                        const odd = Array.from({ length: mainPool }, (_, i) => i + 1).filter(n => n % 2 !== 0);
                        const even = Array.from({ length: mainPool }, (_, i) => i + 1).filter(n => n % 2 === 0);
                        
                        const oddPick = Math.floor(mainPick / 2);
                        const evenPick = Math.ceil(mainPick / 2);
                        
                        for (let j = 0; j < oddPick; j++) {
                            const index = Math.floor(seededRandom() * odd.length);
                            mainNumbers.push(odd.splice(index, 1)[0]);
                        }
                        for (let j = 0; j < evenPick; j++) {
                            const index = Math.floor(seededRandom() * even.length);
                            mainNumbers.push(even.splice(index, 1)[0]);
                        }
                        mainNumbers.sort((a, b) => a - b);
                        break;
                        
                    case 'prime':
                        const primes = Array.from({ length: mainPool }, (_, i) => i + 1).filter(isPrime);
                        const nonPrimes = Array.from({ length: mainPool }, (_, i) => i + 1).filter(n => !isPrime(n));
                        
                        const primePick = Math.min(Math.floor(mainPick / 3), primes.length);
                        const nonPrimePick = mainPick - primePick;
                        
                        for (let j = 0; j < primePick; j++) {
                            const index = Math.floor(seededRandom() * primes.length);
                            mainNumbers.push(primes.splice(index, 1)[0]);
                        }
                        for (let j = 0; j < nonPrimePick; j++) {
                            const index = Math.floor(seededRandom() * nonPrimes.length);
                            mainNumbers.push(nonPrimes.splice(index, 1)[0]);
                        }
                        mainNumbers.sort((a, b) => a - b);
                        break;
                        
                    case 'fibonacci':
                        const fibs = Array.from({ length: mainPool }, (_, i) => i + 1).filter(isFibonacci);
                        const nonFibs = Array.from({ length: mainPool }, (_, i) => i + 1).filter(n => !isFibonacci(n));
                        
                        const fibPick = Math.min(Math.floor(mainPick / 4), fibs.length);
                        const nonFibPick = mainPick - fibPick;
                        
                        for (let j = 0; j < fibPick; j++) {
                            const index = Math.floor(seededRandom() * fibs.length);
                            mainNumbers.push(fibs.splice(index, 1)[0]);
                        }
                        for (let j = 0; j < nonFibPick; j++) {
                            const index = Math.floor(seededRandom() * nonFibs.length);
                            mainNumbers.push(nonFibs.splice(index, 1)[0]);
                        }
                        mainNumbers.sort((a, b) => a - b);
                        break;
                        
                    case 'statistical':
                        // This would normally use historical data, but we'll simulate it
                        const weightedNumbers = Array.from({ length: mainPool }, (_, i) => i + 1);
                        // Simulate some numbers being more likely
                        for (let i = 0; i < weightedNumbers.length; i++) {
                            if (weightedNumbers[i] % 10 === 0) {
                                weightedNumbers.push(weightedNumbers[i]); // Duplicate to increase chance
                            }
                        }
                        
                        for (let j = 0; j < mainPick; j++) {
                            const index = Math.floor(seededRandom() * weightedNumbers.length);
                            mainNumbers.push(weightedNumbers.splice(index, 1)[0]);
                        }
                        mainNumbers = [...new Set(mainNumbers)].sort((a, b) => a - b);
                        while (mainNumbers.length < mainPick) {
                            const extra = Math.floor(seededRandom() * mainPool) + 1;
                            if (!mainNumbers.includes(extra)) {
                                mainNumbers.push(extra);
                            }
                        }
                        mainNumbers.sort((a, b) => a - b);
                        break;
                        
                    case 'ai':
                        // Simulate AI-generated numbers with some "intelligence"
                        const aiNumbers = [];
                        // Prefer numbers in 10-30 range (simulating observed pattern)
                        const preferredRange = Array.from({ length: 21 }, (_, i) => i + 10);
                        // Prefer numbers ending with 3, 7 (simulating observed pattern)
                        const preferredEndings = Array.from({ length: mainPool }, (_, i) => i + 1)
                            .filter(n => n % 10 === 3 || n % 10 === 7);
                            
                        // Get 2 numbers from preferred range
                        for (let j = 0; j < 2 && aiNumbers.length < mainPick; j++) {
                            const index = Math.floor(seededRandom() * preferredRange.length);
                            const num = preferredRange[index];
                            if (!aiNumbers.includes(num)) {
                                aiNumbers.push(num);
                            }
                        }
                        
                        // Get 1-2 numbers with preferred endings
                        for (let j = 0; j < 2 && aiNumbers.length < mainPick; j++) {
                            const index = Math.floor(seededRandom() * preferredEndings.length);
                            const num = preferredEndings[index];
                            if (!aiNumbers.includes(num)) {
                                aiNumbers.push(num);
                            }
                        }
                        
                        // Fill the rest randomly
                        while (aiNumbers.length < mainPick) {
                            const num = Math.floor(seededRandom() * mainPool) + 1;
                            if (!aiNumbers.includes(num)) {
                                aiNumbers.push(num);
                            }
                        }
                        
                        mainNumbers = aiNumbers.sort((a, b) => a - b);
                        break;
                        
                    default: // Standard random
                        const pool = Array.from({ length: mainPool }, (_, i) => i + 1);
                        for (let j = 0; j < mainPick; j++) {
                            const index = Math.floor(seededRandom() * pool.length);
                            mainNumbers.push(pool.splice(index, 1)[0]);
                        }
                        mainNumbers.sort((a, b) => a - b);
                }
                
                // Generate bonus numbers if needed
                if (bonusPick > 0) {
                    const bonusPool = Array.from({ length: bonusPool }, (_, i) => i + 1);
                    for (let j = 0; j < bonusPick; j++) {
                        const index = Math.floor(seededRandom() * bonusPool.length);
                        bonusNumbers.push(bonusPool.splice(index, 1)[0]);
                    }
                    bonusNumbers.sort((a, b) => a - b);
                }
                
                generatedTickets.push({
                    mainNumbers,
                    bonusNumbers,
                    ticketNumber: i + 1
                });
            }
            
            renderGeneratedTickets();
            showNotification(`${numTickets} tickets generated successfully!`, 'success');
        }

        function isPrime(num) {
            if (num <= 1) return false;
            if (num <= 3) return true;
            if (num % 2 === 0 || num % 3 === 0) return false;
            for (let i = 5; i * i <= num; i += 6) {
                if (num % i === 0 || num % (i + 2) === 0) return false;
            }
            return true;
        }

        function isFibonacci(num) {
            return isPerfectSquare(5 * num * num + 4) || isPerfectSquare(5 * num * num - 4);
        }

        function isPerfectSquare(n) {
            const s = Math.sqrt(n);
            return s === Math.floor(s);
        }

        function renderGeneratedTickets() {
            const container = document.getElementById('generated-tickets');
            container.innerHTML = '';
            
            if (generatedTickets.length === 0) {
                container.innerHTML = '<div class="p-4 bg-white dark:bg-gray-600 rounded-lg shadow text-center"><p class="text-gray-500 dark:text-gray-300">Generate some numbers to see results</p></div>';
                return;
            }
            
            generatedTickets.forEach(ticket => {
                const ticketEl = document.createElement('div');
                ticketEl.className = 'p-4 bg-white dark:bg-gray-600 rounded-lg shadow';
                
                const numbersHtml = ticket.mainNumbers.map(n => 
                    `<span class="number-ball main-ball">${n}</span>`
                ).join('');
                
                const bonusHtml = ticket.bonusNumbers.map(n => 
                    `<span class="number-ball bonus-ball">${n}</span>`
                ).join('');
                
                ticketEl.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-semibold">Ticket #${ticket.ticketNumber}</h4>
                        <span class="text-xs text-gray-500 dark:text-gray-300">${getTicketSum(ticket)} sum</span>
                    </div>
                    <div class="mb-2">${numbersHtml}</div>
                    ${bonusHtml ? `<div class="mt-1">Bonus: ${bonusHtml}</div>` : ''}
                    <div class="mt-2 flex justify-between text-xs text-gray-500 dark:text-gray-400">
                        <span>${getOddEvenRatio(ticket.mainNumbers)}</span>
                        <span>${getLowHighRatio(ticket.mainNumbers, document.getElementById('main-pool').value)}</span>
                    </div>
                `;
                
                container.appendChild(ticketEl);
            });
            
            // Update statistics
            updateGenerationStatistics();
        }

        function getTicketSum(ticket) {
            return ticket.mainNumbers.reduce((a, b) => a + b, 0) + 
                   (ticket.bonusNumbers ? ticket.bonusNumbers.reduce((a, b) => a + b, 0) : 0);
        }

        function getOddEvenRatio(numbers) {
            const odd = numbers.filter(n => n % 2 !== 0).length;
            const even = numbers.length - odd;
            return `${odd} odd / ${even} even`;
        }

        function getLowHighRatio(numbers, poolSize) {
            const mid = Math.floor(poolSize / 2);
            const low = numbers.filter(n => n <= mid).length;
            const high = numbers.length - low;
            return `${low} low / ${high} high`;
        }

        function updateGenerationStatistics() {
            if (generatedTickets.length === 0) return;
            
            // Frequency analysis
            const mainPool = parseInt(document.getElementById('main-pool').value);
            const frequencyMap = Array(mainPool).fill(0);
            
            generatedTickets.forEach(ticket => {
                ticket.mainNumbers.forEach(n => frequencyMap[n - 1]++);
                if (ticket.bonusNumbers) {
                    ticket.bonusNumbers.forEach(n => {
                        if (n <= mainPool) frequencyMap[n - 1]++;
                    });
                }
            });
            
            const frequencyStats = [];
            for (let i = 0; i < frequencyMap.length; i++) {
                if (frequencyMap[i] > 0) {
                    frequencyStats.push(`#${i + 1}: ${frequencyMap[i]} (${((frequencyMap[i] / generatedTickets.length) * 100).toFixed(1)}%)`);
                }
            }
            
            document.getElementById('frequency-stats').innerHTML = frequencyStats.length > 0 
                ? frequencyStats.join('<br>')
                : 'No frequency data available';
            
            // Sum analysis
            const sums = generatedTickets.map(t => getTicketSum(t));
            const avgSum = sums.reduce((a, b) => a + b, 0) / sums.length;
            const minSum = Math.min(...sums);
            const maxSum = Math.max(...sums);
            
            document.getElementById('sum-stats').innerHTML = `
                Average sum: ${avgSum.toFixed(1)}<br>
                Range: ${minSum} to ${maxSum}<br>
                Median: ${calculateMedian(sums).toFixed(1)}
            `;
            
            // Pattern analysis
            const oddEvenRatios = generatedTickets.map(t => {
                const numbers = t.mainNumbers;
                const odd = numbers.filter(n => n % 2 !== 0).length;
                return `${odd}/${numbers.length - odd}`;
            });
            
            const patternCounts = {};
            oddEvenRatios.forEach(ratio => {
                patternCounts[ratio] = (patternCounts[ratio] || 0) + 1;
            });
            
            const patternStats = Object.entries(patternCounts).map(([ratio, count]) => 
                `${ratio} odd/even: ${count} (${((count / generatedTickets.length) * 100).toFixed(1)}%)`
            );
            
            document.getElementById('pattern-stats').innerHTML = patternStats.join('<br>');
        }

        function calculateMedian(numbers) {
            const sorted = [...numbers].sort((a, b) => a - b);
            const mid = Math.floor(sorted.length / 2);
            return sorted.length % 2 !== 0 ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2;
        }

        function quickPick() {
            document.getElementById('random-seed').value = '';
            document.getElementById('generation-method').value = 'standard';
            generateTickets();
        }

        function clearTickets() {
            generatedTickets = [];
            renderGeneratedTickets();
            showNotification('Cleared all generated tickets', 'success');
        }

        function exportTickets(format) {
            if (generatedTickets.length === 0) {
                showNotification('No tickets to export', 'error');
                return;
            }
            
            let content, mimeType, extension;
            
            if (format === 'csv') {
                const headers = ['Ticket', 'Main Numbers', 'Bonus Numbers', 'Sum', 'Odd/Even'];
                const rows = generatedTickets.map(ticket => [
                    ticket.ticketNumber,
                    ticket.mainNumbers.join(','),
                    ticket.bonusNumbers ? ticket.bonusNumbers.join(',') : '',
                    getTicketSum(ticket),
                    getOddEvenRatio(ticket.mainNumbers)
                ]);
                
                content = [headers, ...rows].map(row => row.join(';')).join('\n');
                mimeType = 'text/csv';
                extension = 'csv';
            } else { // txt
                content = generatedTickets.map(ticket => {
                    let line = `Ticket ${ticket.ticketNumber}: ${ticket.mainNumbers.join(', ')}`;
                    if (ticket.bonusNumbers) {
                        line += ` | Bonus: ${ticket.bonusNumbers.join(', ')}`;
                    }
                    line += ` | Sum: ${getTicketSum(ticket)} | ${getOddEvenRatio(ticket.mainNumbers)}`;
                    return line;
                }).join('\n');
                
                mimeType = 'text/plain';
                extension = 'txt';
            }
            
            downloadFile(content, `lotto-tickets-${new Date().toISOString().slice(0, 10)}.${extension}`, mimeType);
            showNotification(`Exported tickets as ${format.toUpperCase()}`, 'success');
        }

        function copyToClipboard() {
            if (generatedTickets.length === 0) {
                showNotification('No tickets to copy', 'error');
                return;
            }
            
            const content = generatedTickets.map(ticket => {
                let line = `Ticket ${ticket.ticketNumber}: ${ticket.mainNumbers.join(', ')}`;
                if (ticket.bonusNumbers) {
                    line += ` | Bonus: ${ticket.bonusNumbers.join(', ')}`;
                }
                return line;
            }).join('\n');
            
            navigator.clipboard.writeText(content)
                .then(() => showNotification('Tickets copied to clipboard!', 'success'))
                .catch(() => showNotification('Failed to copy to clipboard', 'error'));
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function analyzeNumbers() {
            const input = document.getElementById('numbers-to-analyze').value.trim();
            if (!input) {
                showNotification('Please enter numbers to analyze', 'error');
                return;
            }
            
            const game = document.getElementById('analyzer-game').value;
            const config = lotteryConfigs[game];
            const expectedCount = config.mainPick + config.bonusPick;
            
            // Parse input - handle multiple formats
            const numberSets = input.split('\n').filter(line => line.trim());
            const parsedSets = [];
            
            for (const line of numberSets) {
                // Try different delimiters
                const numbers = line.split(/[,;\s-]+/).map(n => parseInt(n.trim())).filter(n => !isNaN(n));
                
                if (numbers.length === expectedCount) {
                    const mainNumbers = numbers.slice(0, config.mainPick).sort((a, b) => a - b);
                    const bonusNumbers = config.bonusPick > 0 ? numbers.slice(config.mainPick).sort((a, b) => a - b) : [];
                    
                    // Validate number ranges
                    const invalidMain = mainNumbers.find(n => n < 1 || n > config.mainPool);
                    const invalidBonus = bonusNumbers.find(n => n < 1 || n > config.bonusPool);
                    
                    if (invalidMain || invalidBonus) {
                        showNotification(`Numbers must be between 1-${config.mainPool} (main) and ${config.bonusPool ? `1-${config.bonusPool} (bonus)` : 'no bonus'}`, 'error');
                        return;
                    }
                    
                    parsedSets.push({ mainNumbers, bonusNumbers });
                }
            }
            
            if (parsedSets.length === 0) {
                showNotification(`Please enter valid numbers (${config.mainPick} main + ${config.bonusPick} bonus)`, 'error');
                return;
            }
            
            // Store analysis results
            analysisResults = {
                game,
                config,
                numbers: parsedSets,
                timestamp: new Date().toISOString()
            };
            
            renderAnalysisResults();
            showNotification(`Analyzed ${parsedSets.length} set(s) of numbers`, 'success');
        }

        function renderAnalysisResults() {
            if (!analysisResults.numbers || analysisResults.numbers.length === 0) {
                document.getElementById('analysis-stats').classList.add('hidden');
                document.getElementById('analysis-charts').classList.add('hidden');
                return;
            }
            
            document.getElementById('analysis-stats').classList.remove('hidden');
            document.getElementById('analysis-charts').classList.remove('hidden');
            
            // Basic statistics
            const sums = analysisResults.numbers.map(set => 
                set.mainNumbers.reduce((a, b) => a + b, 0) + 
                (set.bonusNumbers ? set.bonusNumbers.reduce((a, b) => a + b, 0) : 0)
            );
            
            const avgSum = sums.reduce((a, b) => a + b, 0) / sums.length;
            const minSum = Math.min(...sums);
            const maxSum = Math.max(...sums);
            
            document.getElementById('basic-stats').innerHTML = `
                <div class="grid grid-cols-2 gap-2">
                    <div>Number Sets:</div>
                    <div class="font-medium">${analysisResults.numbers.length}</div>
                    <div>Average Sum:</div>
                    <div class="font-medium">${avgSum.toFixed(1)}</div>
                    <div>Sum Range:</div>
                    <div class="font-medium">${minSum} - ${maxSum}</div>
                    <div>Median Sum:</div>
                    <div class="font-medium">${calculateMedian(sums).toFixed(1)}</div>
                </div>
            `;
            
            // Number properties
            const allMainNumbers = analysisResults.numbers.flatMap(set => set.mainNumbers);
            const allBonusNumbers = analysisResults.numbers.flatMap(set => set.bonusNumbers || []);
            
            const oddCount = allMainNumbers.filter(n => n % 2 !== 0).length;
            const evenCount = allMainNumbers.length - oddCount;
            
            const lowHighSplit = Math.floor(analysisResults.config.mainPool / 2);
            const lowCount = allMainNumbers.filter(n => n <= lowHighSplit).length;
            const highCount = allMainNumbers.length - lowCount;
            
            const primeCount = allMainNumbers.filter(isPrime).length;
            const fibCount = allMainNumbers.filter(isFibonacci).length;
            
            document.getElementById('number-properties').innerHTML = `
                <div class="grid grid-cols-2 gap-2">
                    <div>Odd/Even:</div>
                    <div class="font-medium">${oddCount} / ${evenCount} (${(oddCount / allMainNumbers.length * 100).toFixed(1)}%)</div>
                    <div>Low/High:</div>
                    <div class="font-medium">${lowCount} / ${highCount} (${(lowCount / allMainNumbers.length * 100).toFixed(1)}%)</div>
                    <div>Prime Numbers:</div>
                    <div class="font-medium">${primeCount} (${(primeCount / allMainNumbers.length * 100).toFixed(1)}%)</div>
                    <div>Fibonacci Numbers:</div>
                    <div class="font-medium">${fibCount} (${(fibCount / allMainNumbers.length * 100).toFixed(1)}%)</div>
                </div>
            `;
            
            // Pattern analysis
            const consecutivePairs = analysisResults.numbers.map(set => {
                const nums = [...set.mainNumbers].sort((a, b) => a - b);
                let pairs = 0;
                for (let i = 1; i < nums.length; i++) {
                    if (nums[i] === nums[i - 1] + 1) pairs++;
                }
                return pairs;
            }).reduce((a, b) => a + b, 0);
            
            const sameLastDigit = analysisResults.numbers.map(set => {
                const lastDigits = set.mainNumbers.map(n => n % 10);
                return new Set(lastDigits).size !== lastDigits.length;
            }).filter(Boolean).length;
            
            document.getElementById('pattern-analysis').innerHTML = `
                <div class="grid grid-cols-2 gap-2">
                    <div>Consecutive Pairs:</div>
                    <div class="font-medium">${consecutivePairs} (avg ${(consecutivePairs / analysisResults.numbers.length).toFixed(1)} per set)</div>
                    <div>Same Last Digit:</div>
                    <div class="font-medium">${sameLastDigit} set(s)</div>
                    <div>Number Spread:</div>
                    <div class="font-medium">${calculateSpread(allMainNumbers, analysisResults.config.mainPool)}</div>
                </div>
            `;
            
            // Advanced metrics
            const frequencyMap = Array(analysisResults.config.mainPool).fill(0);
            allMainNumbers.forEach(n => frequencyMap[n - 1]++);
            
            const mostFrequent = frequencyMap.indexOf(Math.max(...frequencyMap)) + 1;
            const leastFrequent = frequencyMap.indexOf(Math.min(...frequencyMap.filter(n => n > 0))) + 1;
            
            const gaps = analysisResults.numbers.flatMap(set => {
                const nums = [...set.mainNumbers].sort((a, b) => a - b);
                const gaps = [];
                for (let i = 1; i < nums.length; i++) {
                    gaps.push(nums[i] - nums[i - 1]);
                }
                return gaps;
            });
            
            const avgGap = gaps.length > 0 ? gaps.reduce((a, b) => a + b, 0) / gaps.length : 0;
            
            document.getElementById('advanced-metrics').innerHTML = `
                <div class="grid grid-cols-2 gap-2">
                    <div>Most Frequent:</div>
                    <div class="font-medium">#${mostFrequent} (${frequencyMap[mostFrequent - 1]} times)</div>
                    <div>Least Frequent:</div>
                    <div class="font-medium">#${leastFrequent} (${frequencyMap[leastFrequent - 1]} times)</div>
                    <div>Average Gap:</div>
                    <div class="font-medium">${avgGap.toFixed(1)}</div>
                    <div>Number Coverage:</div>
                    <div class="font-medium">${frequencyMap.filter(n => n > 0).length}/${analysisResults.config.mainPool} (${((frequencyMap.filter(n => n > 0).length / analysisResults.config.mainPool * 100).toFixed(1)}%)</div>
                </div>
            `;
            
            // Render charts
            renderAnalysisCharts();
        }

        function calculateSpread(numbers, poolSize) {
            const coverage = new Set(numbers).size;
            const range = Math.max(...numbers) - Math.min(...numbers);
            return `${coverage} unique, range ${range} (${(range / poolSize * 100).toFixed(1)}% of pool)`;
        }

        function renderAnalysisCharts() {
            if (!analysisResults.numbers || analysisResults.numbers.length === 0) return;
            
            const allMainNumbers = analysisResults.numbers.flatMap(set => set.mainNumbers);
            const mainPool = analysisResults.config.mainPool;
            
            // Frequency distribution chart
            const frequencyData = Array(mainPool).fill(0);
            allMainNumbers.forEach(n => frequencyData[n - 1]++);
            
            updateChart('frequency-chart', {
                type: 'bar',
                data: {
                    labels: Array.from({ length: mainPool }, (_, i) => i + 1),
                    datasets: [{
                        label: 'Number Frequency',
                        data: frequencyData,
                        backgroundColor: Array(mainPool).fill().map((_, i) => 
                            frequencyData[i] === Math.max(...frequencyData) ? 'rgba(239, 68, 68, 0.7)' :
                            frequencyData[i] === Math.min(...frequencyData.filter(n => n > 0)) ? 'rgba(59, 130, 246, 0.7)' :
                            'rgba(99, 102, 241, 0.7)'
                        ),
                        borderColor: Array(mainPool).fill().map((_, i) => 
                            frequencyData[i] === Math.max(...frequencyData) ? 'rgba(239, 68, 68, 1)' :
                            frequencyData[i] === Math.min(...frequencyData.filter(n => n > 0)) ? 'rgba(59, 130, 246, 1)' :
                            'rgba(99, 102, 241, 1)'
                        ),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: ctx => `${ctx.label}: ${ctx.raw} (${(ctx.raw / allMainNumbers.length * 100).toFixed(1)}%)` } }
                    },
                    scales: { y: { beginAtZero: true } }
                }
            });
            
            // Last digit distribution chart
            const lastDigitData = Array(10).fill(0);
            allMainNumbers.forEach(n => lastDigitData[n % 10]++);
            
            updateChart('last-digit-chart', {
                type: 'pie',
                data: {
                    labels: Array.from({ length: 10 }, (_, i) => i),
                    datasets: [{
                        label: 'Last Digit Frequency',
                        data: lastDigitData,
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.7)', 'rgba(234, 88, 12, 0.7)', 'rgba(234, 179, 8, 0.7)', 
                            'rgba(101, 163, 13, 0.7)', 'rgba(5, 150, 105, 0.7)', 'rgba(13, 148, 136, 0.7)', 
                            'rgba(2, 132, 199, 0.7)', 'rgba(79, 70, 229, 0.7)', 'rgba(147, 51, 234, 0.7)', 
                            'rgba(225, 29, 72, 0.7)'
                        ],
                        borderColor: [
                            'rgba(239, 68, 68, 1)', 'rgba(234, 88, 12, 1)', 'rgba(234, 179, 8, 1)', 
                            'rgba(101, 163, 13, 1)', 'rgba(5, 150, 105, 1)', 'rgba(13, 148, 136, 1)', 
                            'rgba(2, 132, 199, 1)', 'rgba(79, 70, 229, 1)', 'rgba(147, 51, 234, 1)', 
                            'rgba(225, 29, 72, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: { callbacks: { label: ctx => `Ends with ${ctx.label}: ${ctx.raw} (${(ctx.raw / allMainNumbers.length * 100).toFixed(1)}%)` } }
                    }
                }
            });
            
            // Sum distribution chart
            const sums = analysisResults.numbers.map(set => 
                set.mainNumbers.reduce((a, b) => a + b, 0) + 
                (set.bonusNumbers ? set.bonusNumbers.reduce((a, b) => a + b, 0) : 0)
            );
            
            const minSum = Math.min(...sums);
            const maxSum = Math.max(...sums);
            const sumRange = maxSum - minSum;
            const binSize = Math.max(5, Math.ceil(sumRange / 10));
            const bins = {};
            
            sums.forEach(sum => {
                const bin = Math.floor(sum / binSize) * binSize;
                bins[bin] = (bins[bin] || 0) + 1;
            });
            
            const sumLabels = Object.keys(bins).sort((a, b) => a - b).map(b => `${b}-${parseInt(b) + binSize - 1}`);
            const sumData = Object.keys(bins).sort((a, b) => a - b).map(b => bins[b]);
            
            updateChart('sum-chart', {
                type: 'bar',
                data: {
                    labels: sumLabels,
                    datasets: [{
                        label: 'Sum Distribution',
                        data: sumData,
                        backgroundColor: 'rgba(79, 70, 229, 0.7)',
                        borderColor: 'rgba(79, 70, 229, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: { callbacks: { label: ctx => `${ctx.label}: ${ctx.raw} (${(ctx.raw / sums.length * 100).toFixed(1)}%)` } }
                    },
                    scales: { y: { beginAtZero: true } }
                }
            });
            
            // Odd/even distribution chart
            const oddEvenData = analysisResults.numbers.map(set => {
                const odd = set.mainNumbers.filter(n => n % 2 !== 0).length;
                return `${odd}/${set.mainNumbers.length - odd}`;
            });
            
            const oddEvenCounts = {};
            oddEvenData.forEach(ratio => {
                oddEvenCounts[ratio] = (oddEvenCounts[ratio] || 0) + 1;
            });
            
            const oddEvenLabels = Object.keys(oddEvenCounts).sort();
            const oddEvenValues = oddEvenLabels.map(label => oddEvenCounts[label]);
            
            updateChart('odd-even-chart', {
                type: 'doughnut',
                data: {
                    labels: oddEvenLabels,
                    datasets: [{
                        label: 'Odd/Even Distribution',
                        data: oddEvenValues,
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.7)', 'rgba(59, 130, 246, 0.7)', 'rgba(234, 179, 8, 0.7)',
                            'rgba(16, 185, 129, 0.7)', 'rgba(139, 92, 246, 0.7)'
                        ],
                        borderColor: [
                            'rgba(239, 68, 68, 1)', 'rgba(59, 130, 246, 1)', 'rgba(234, 179, 8, 1)',
                            'rgba(16, 185, 129, 1)', 'rgba(139, 92, 246, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: { callbacks: { label: ctx => `${ctx.label} odd/even: ${ctx.raw} (${(ctx.raw / analysisResults.numbers.length * 100).toFixed(1)}%)` } }
                    }
                }
            });
        }

        function updateChart(chartId, config) {
            if (charts[chartId]) {
                charts[chartId].destroy();
            }
            
            const ctx = document.getElementById(chartId).getContext('2d');
            charts[chartId] = new Chart(ctx, config);
        }

        function clearAnalysis() {
            document.getElementById('numbers-to-analyze').value = '';
            analysisResults = {};
            document.getElementById('analysis-stats').classList.add('hidden');
            document.getElementById('analysis-charts').classList.add('hidden');
            document.getElementById('analysis-results-container').innerHTML = `
                <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg text-center">
                    <p class="text-gray-500 dark:text-gray-300">Enter numbers to analyze them</p>
                </div>
            `;
        }

        function exportAnalysis(format) {
            if (!analysisResults.numbers || analysisResults.numbers.length === 0) {
                showNotification('No analysis results to export', 'error');
                return;
            }
            
            let content, mimeType, extension;
            
            if (format === 'csv') {
                const headers = ['Set', 'Main Numbers', 'Bonus Numbers', 'Sum', 'Odd/Even', 'Low/High'];
                const rows = analysisResults.numbers.map((set, i) => [
                    i + 1,
                    set.mainNumbers.join(','),
                    set.bonusNumbers ? set.bonusNumbers.join(',') : '',
                    set.mainNumbers.reduce((a, b) => a + b, 0) + (set.bonusNumbers ? set.bonusNumbers.reduce((a, b) => a + b, 0) : 0),
                    `${set.mainNumbers.filter(n => n % 2 !== 0).length}/${set.mainNumbers.filter(n => n % 2 === 0).length}`,
                    `${set.mainNumbers.filter(n => n <= Math.floor(analysisResults.config.mainPool / 2)).length}/${set.mainNumbers.filter(n => n > Math.floor(analysisResults.config.mainPool / 2)).length}`
                ]);
                
                content = [headers, ...rows].map(row => row.join(';')).join('\n');
                mimeType = 'text/csv';
                extension = 'csv';
            } else { // txt
                content = `Analysis Results - ${analysisResults.game}\n`;
                content += `Generated on: ${new Date(analysisResults.timestamp).toLocaleString()}\n\n`;
                
                content += 'Number Sets:\n';
                analysisResults.numbers.forEach((set, i) => {
                    content += `Set ${i + 1}: ${set.mainNumbers.join(', ')}`;
                    if (set.bonusNumbers) {
                        content += ` | Bonus: ${set.bonusNumbers.join(', ')}`;
                    }
                    content += ` | Sum: ${set.mainNumbers.reduce((a, b) => a + b, 0) + (set.bonusNumbers ? set.bonusNumbers.reduce((a, b) => a + b, 0) : 0)}\n`;
                });
                
                const allMainNumbers = analysisResults.numbers.flatMap(set => set.mainNumbers);
                const frequencyMap = Array(analysisResults.config.mainPool).fill(0);
                allMainNumbers.forEach(n => frequencyMap[n - 1]++);
                
                content += '\nFrequency Analysis:\n';
                for (let i = 0; i < frequencyMap.length; i++) {
                    if (frequencyMap[i] > 0) {
                        content += `#${i + 1}: ${frequencyMap[i]} (${(frequencyMap[i] / allMainNumbers.length * 100).toFixed(1)}%)\n`;
                    }
                }
            }
            
            downloadFile(content, `lotto-analysis-${new Date().toISOString().slice(0, 10)}.${extension}`, mimeType);
            showNotification(`Exported analysis as ${format.toUpperCase()}`, 'success');
        }

        function loadHistory() {
            const game = document.getElementById('history-game').value;
            const dataSource = document.getElementById('data-source').value;
            const numDraws = parseInt(document.getElementById('num-draws').value) || 100;
            
            if (dataSource === 'sample') {
                historicalData = sampleHistoricalData[game].slice(0, numDraws);
                showNotification(`Loaded ${historicalData.length} sample historical draws`, 'success');
            } else if (dataSource === 'upload') {
                const fileInput = document.getElementById('csv-upload');
                if (fileInput.files.length === 0) {
                    showNotification('Please select a CSV file to upload', 'error');
                    return;
                }
                
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const csvData = e.target.result;
                        const lines = csvData.split('\n').filter(line => line.trim());
                        const headers = lines[0].split(',');
                        
                        historicalData = lines.slice(1).map(line => {
                            const values = line.split(',');
                            const date = values[0];
                            const mainNumbers = values.slice(1, 1 + lotteryConfigs[game].mainPick).map(Number).filter(n => !isNaN(n));
                            const bonusNumbers = lotteryConfigs[game].bonusPick > 0 
                                ? values.slice(1 + lotteryConfigs[game].mainPick, 1 + lotteryConfigs[game].mainPick + lotteryConfigs[game].bonusPick).map(Number).filter(n => !isNaN(n))
                                : [];
                            
                            return { date, numbers: mainNumbers, bonus: bonusNumbers };
                        }).filter(d => d.numbers.length === lotteryConfigs[game].mainPick && 
                                      d.bonus.length === lotteryConfigs[game].bonusPick);
                        
                        showNotification(`Loaded ${historicalData.length} draws from CSV`, 'success');
                        renderHistoryResults();
                    } catch (error) {
                        showNotification('Error parsing CSV file: ' + error.message, 'error');
                        console.error(error);
                    }
                };
                
                reader.readAsText(file);
                return;
            }
            
            renderHistoryResults();
        }

        function renderHistoryResults() {
            if (historicalData.length === 0) {
                document.getElementById('history-stats').classList.add('hidden');
                return;
            }
            
            document.getElementById('history-stats').classList.remove('hidden');
            
            // Data summary
            const firstDate = historicalData[historicalData.length - 1].date;
            const lastDate = historicalData[0].date;
            const daysBetween = (new Date(lastDate) - new Date(firstDate)) / (1000 * 60 * 60 * 24);
            const drawsPerWeek = (historicalData.length / (daysBetween / 7)).toFixed(1);
            
            document.getElementById('data-summary').innerHTML = `
                <div class="grid grid-cols-2 gap-2">
                    <div>Total Draws:</div>
                    <div class="font-medium">${historicalData.length}</div>
                    <div>Date Range:</div>
                    <div class="font-medium">${firstDate} to ${lastDate}</div>
                    <div>Days Covered:</div>
                    <div class="font-medium">${Math.round(daysBetween)}</div>
                    <div>Draws/Week:</div>
                    <div class="font-medium">${drawsPerWeek}</div>
                </div>
            `;
            
            // Frequent numbers
            const mainPool = lotteryConfigs[document.getElementById('history-game').value].mainPool;
            const frequencyMap = Array(mainPool).fill(0);
            
            historicalData.forEach(draw => {
                draw.numbers.forEach(n => frequencyMap[n - 1]++);
            });
            
            const sortedFrequency = frequencyMap.map((count, index) => ({ number: index + 1, count }))
                .sort((a, b) => b.count - a.count);
            
            const topNumbers = sortedFrequency.slice(0, 10);
            const coldNumbers = sortedFrequency.slice(-10).reverse();
            
            document.getElementById('frequent-numbers').innerHTML = `
                <div class="mb-2">
                    <h4 class="font-medium">Top 10 Hot Numbers</h4>
                    <div class="flex flex-wrap gap-1 mt-1">
                        ${topNumbers.map(num => `<span class="number-ball hot-number">${num.number}</span>`).join('')}
                    </div>
                </div>
                <div>
                    <h4 class="font-medium">Top 10 Cold Numbers</h4>
                    <div class="flex flex-wrap gap-1 mt-1">
                        ${coldNumbers.map(num => `<span class="number-ball cold-number">${num.number}</span>`).join('')}
                    </div>
                </div>
            `;
            
            // Render charts and table
            renderHistoryCharts();
            renderHistoryTable();
        }

        function renderHistoryCharts() {
            if (historicalData.length === 0) return;
            
            const game = document.getElementById('history-game').value;
            const config = lotteryConfigs[game];
            const mainPool = config.mainPool;
            
            // Heatmap chart (frequency)
            const frequencyMap = Array(mainPool).fill(0);
            historicalData.forEach(draw => {
                draw.numbers.forEach(n => frequencyMap[n - 1]++);
            });
            
            updateChart('heatmap-chart', {
                type: 'bar',
                data: {
                    labels: Array.from({ length: mainPool }, (_, i) => i + 1),
                    datasets: [{
                        label: 'Number Frequency',
                        data: frequencyMap,
                        backgroundColor: frequencyMap.map(count => {
                            const max = Math.max(...frequencyMap);
                            const ratio = count / max;
                            return `rgba(239, 68, 68, ${0.3 + 0.7 * ratio})`;
                        }),
                        borderColor: frequencyMap.map(count => {
                            const max = Math.max(...frequencyMap);
                            const ratio = count / max;
                            return `rgba(239, 68, 68, ${0.5 + 0.5 * ratio})`;
                        }),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: ctx => `${ctx.label}: ${ctx.raw} (${(ctx.raw / historicalData.length * 100).toFixed(1)}%)` } }
                    },
                    scales: { y: { beginAtZero: true } }
                }
            });
            
            // Frequency trend chart (top 5 numbers over time)
            const sortedFrequency = frequencyMap.map((count, index) => ({ number: index + 1, count }))
                .sort((a, b) => b.count - a.count);
            const top5Numbers = sortedFrequency.slice(0, 5).map(item => item.number);
            
            const trendData = {};
            top5Numbers.forEach(num => {
                trendData[num] = Array(historicalData.length).fill(0);
            });
            
            // Calculate cumulative frequency
            historicalData.forEach((draw, index) => {
                top5Numbers.forEach(num => {
                    const prev = index > 0 ? trendData[num][index - 1] : 0;
                    trendData[num][index] = draw.numbers.includes(num) ? prev + 1 : prev;
                });
            });
            
            updateChart('frequency-trend-chart', {
                type: 'line',
                data: {
                    labels: historicalData.map((_, i) => i + 1).reverse(),
                    datasets: top5Numbers.map((num, i) => ({
                        label: `#${num}`,
                        data: trendData[num],
                        borderColor: [
                            'rgba(239, 68, 68, 1)', 'rgba(234, 88, 12, 1)', 'rgba(234, 179, 8, 1)', 
                            'rgba(101, 163, 13, 1)', 'rgba(5, 150, 105, 1)'
                        ][i],
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.1)', 'rgba(234, 88, 12, 0.1)', 'rgba(234, 179, 8, 0.1)', 
                            'rgba(101, 163, 13, 0.1)', 'rgba(5, 150, 105, 0.1)'
                        ][i],
                        borderWidth: 2,
                        tension: 0.1,
                        fill: true
                    }))
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: { callbacks: { label: ctx => `${ctx.dataset.label}: ${ctx.raw} (${(ctx.raw / (ctx.dataIndex + 1) * 100).toFixed(1)}%)` } }
                    },
                    scales: { y: { beginAtZero: true } }
                }
            });
            
            // Gap analysis chart (time since last appearance)
            const lastSeen = {};
            const gapData = Array(mainPool).fill(0);
            
            historicalData.forEach((draw, index) => {
                draw.numbers.forEach(n => {
                    if (lastSeen[n] !== undefined) {
                        gapData[n - 1] += (index - lastSeen[n]);
                    }
                    lastSeen[n] = index;
                });
            });
            
            // Calculate average gap per number
            for (let i = 0; i < gapData.length; i++) {
                if (frequencyMap[i] > 1) {
                    gapData[i] = gapData[i] / (frequencyMap[i] - 1);
                } else {
                    gapData[i] = historicalData.length; // Only appeared once
                }
            }
            
            updateChart('gap-chart', {
                type: 'bar',
                data: {
                    labels: Array.from({ length: mainPool }, (_, i) => i + 1),
                    datasets: [{
                        label: 'Average Gap Between Appearances',
                        data: gapData,
                        backgroundColor: gapData.map(gap => {
                            const maxGap = Math.max(...gapData);
                            const ratio = gap / maxGap;
                            return `rgba(59, 130, 246, ${0.3 + 0.7 * ratio})`;
                        }),
                        borderColor: gapData.map(gap => {
                            const maxGap = Math.max(...gapData);
                            const ratio = gap / maxGap;
                            return `rgba(59, 130, 246, ${0.5 + 0.5 * ratio})`;
                        }),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: ctx => `${ctx.label}: ${ctx.raw.toFixed(1)} draws between appearances` } }
                    },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        function renderHistoryTable() {
            const startIdx = (currentHistoryPage - 1) * HISTORY_PER_PAGE;
            const endIdx = Math.min(startIdx + HISTORY_PER_PAGE, historicalData.length);
            const pageData = historicalData.slice(startIdx, endIdx).reverse();
            
            const tableBody = document.getElementById('history-table-body');
            tableBody.innerHTML = '';
            
            pageData.forEach(draw => {
                const row = document.createElement('tr');
                
                const dateCell = document.createElement('td');
                dateCell.className = 'px-4 py-2 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400';
                dateCell.textContent = draw.date;
                
                const numbersCell = document.createElement('td');
                numbersCell.className = 'px-4 py-2 whitespace-nowrap';
                numbersCell.innerHTML = draw.numbers.map(n => `<span class="number-ball main-ball">${n}</span>`).join('');
                
                const bonusCell = document.createElement('td');
                bonusCell.className = 'px-4 py-2 whitespace-nowrap';
                bonusCell.innerHTML = draw.bonus ? draw.bonus.map(n => `<span class="number-ball bonus-ball">${n}</span>`).join('') : '-';
                
                row.appendChild(dateCell);
                row.appendChild(numbersCell);
                row.appendChild(bonusCell);
                tableBody.appendChild(row);
            });
            
            // Update pagination info
            document.getElementById('history-pagination-info').textContent = 
                `Showing ${startIdx + 1}-${endIdx} of ${historicalData.length}`;
        }

        function clearHistory() {
            historicalData = [];
            currentHistoryPage = 1;
            document.getElementById('history-stats').classList.add('hidden');
            document.getElementById('history-results-container').innerHTML = `
                <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg text-center">
                    <p class="text-gray-500 dark:text-gray-300">Load historical data to see results</p>
                </div>
            `;
        }

        function exportHistory(format) {
            if (historicalData.length === 0) {
                showNotification('No historical data to export', 'error');
                return;
            }
            
            const game = document.getElementById('history-game').value;
            const config = lotteryConfigs[game];
            
            let content, mimeType, extension;
            
            if (format === 'csv') {
                const headers = ['Date', ...Array.from({ length: config.mainPick }, (_, i) => `Number ${i + 1}`)];
                if (config.bonusPick > 0) {
                    headers.push(...Array.from({ length: config.bonusPick }, (_, i) => `Bonus ${i + 1}`));
                }
                
                const rows = historicalData.map(draw => {
                    const row = [draw.date, ...draw.numbers];
                    if (draw.bonus) {
                        row.push(...draw.bonus);
                    }
                    return row;
                });
                
                content = [headers, ...rows].map(row => row.join(',')).join('\n');
                mimeType = 'text/csv';
                extension = 'csv';
            }
            
            downloadFile(content, `lotto-history-${game}-${new Date().toISOString().slice(0, 10)}.${extension}`, mimeType);
            showNotification(`Exported history as ${format.toUpperCase()}`, 'success');
        }

        function applyStrategy(strategy) {
            const game = document.getElementById('history-game').value || 'powerball';
            const config = lotteryConfigs[game];
            
            if (historicalData.length === 0) {
                showNotification('Please load historical data first', 'error');
                return;
            }
            
            let results;
            
            switch (strategy) {
                case 'frequency':
                    results = applyFrequencyStrategy();
                    break;
                case 'gap':
                    results = applyGapStrategy();
                    break;
                case 'pattern':
                    results = applyPatternStrategy();
                    break;
                default:
                    showNotification('Unknown strategy', 'error');
                    return;
            }
            
            renderStrategyResults(results, strategy);
            showNotification(`Applied ${strategy} strategy successfully`, 'success');
        }

        function applyFrequencyStrategy() {
            const mainPool = lotteryConfigs[document.getElementById('history-game').value].mainPool;
            const frequencyMap = Array(mainPool).fill(0);
            
            historicalData.forEach(draw => {
                draw.numbers.forEach(n => frequencyMap[n - 1]++);
            });
            
            const sortedFrequency = frequencyMap.map((count, index) => ({ number: index + 1, count }))
                .sort((a, b) => b.count - a.count);
            
            // Recommend top numbers but with some randomness to not always pick the absolute top
            const topNumbers = sortedFrequency.slice(0, 20); // Consider top 20
            const weightedNumbers = [];
            
            topNumbers.forEach((num, index) => {
                // Higher weight for top numbers, decreasing as we go down
                const weight = Math.max(1, 20 - index);
                for (let i = 0; i < weight; i++) {
                    weightedNumbers.push(num.number);
                }
            });
            
            // Generate 5 recommended sets
            const recommendedSets = [];
            for (let i = 0; i < 5; i++) {
                const set = [];
                const pool = [...weightedNumbers];
                
                while (set.length < lotteryConfigs[document.getElementById('history-game').value].mainPick && pool.length > 0) {
                    const index = Math.floor(Math.random() * pool.length);
                    const num = pool[index];
                    if (!set.includes(num)) {
                        set.push(num);
                    }
                    pool.splice(index, 1);
                }
                
                set.sort((a, b) => a - b);
                recommendedSets.push(set);
            }
            
            return {
                strategy: 'Frequency Analysis',
                description: 'Recommends numbers based on their historical frequency of appearance. Hot numbers are those that appear most often.',
                recommendedNumbers: recommendedSets,
                hotNumbers: sortedFrequency.slice(0, 10).map(item => item.number),
                coldNumbers: sortedFrequency.slice(-10).reverse().map(item => item.number)
            };
        }

        function applyGapStrategy() {
            const mainPool = lotteryConfigs[document.getElementById('history-game').value].mainPool;
            const frequencyMap = Array(mainPool).fill(0);
            const lastSeen = {};
            const gapData = Array(mainPool).fill(0);
            
            historicalData.forEach((draw, index) => {
                draw.numbers.forEach(n => {
                    if (lastSeen[n] !== undefined) {
                        gapData[n - 1] += (index - lastSeen[n]);
                    }
                    lastSeen[n] = index;
                    frequencyMap[n - 1]++;
                });
            });
            
            // Calculate average gap per number
            const avgGaps = [];
            for (let i = 0; i < gapData.length; i++) {
                if (frequencyMap[i] > 1) {
                    avgGaps.push({ number: i + 1, gap: gapData[i] / (frequencyMap[i] - 1) });
                } else {
                    avgGaps.push({ number: i + 1, gap: historicalData.length }); // Only appeared once
                }
            }
            
            // Sort by gap (descending) - numbers with largest gaps are "most due"
            avgGaps.sort((a, b) => b.gap - a.gap);
            
            // Recommend numbers with largest gaps but with some randomness
            const dueNumbers = avgGaps.slice(0, 20); // Consider top 20 most due
            const weightedNumbers = [];
            
            dueNumbers.forEach((num, index) => {
                // Higher weight for numbers with larger gaps
                const weight = Math.max(1, 20 - index);
                for (let i = 0; i < weight; i++) {
                    weightedNumbers.push(num.number);
                }
            });
            
            // Generate 5 recommended sets
            const recommendedSets = [];
            for (let i = 0; i < 5; i++) {
                const set = [];
                const pool = [...weightedNumbers];
                
                while (set.length < lotteryConfigs[document.getElementById('history-game').value].mainPick && pool.length > 0) {
                    const index = Math.floor(Math.random() * pool.length);
                    const num = pool[index];
                    if (!set.includes(num)) {
                        set.push(num);
                    }
                    pool.splice(index, 1);
                }
                
                set.sort((a, b) => a - b);
                recommendedSets.push(set);
            }
            
            return {
                strategy: 'Gap Analysis',
                description: 'Recommends numbers that are "due" to appear based on the time since their last appearance. Numbers with the longest gaps since last draw are considered most due.',
                recommendedNumbers: recommendedSets,
                dueNumbers: avgGaps.slice(0, 10).map(item => item.number),
                frequentNumbers: avgGaps.slice(-10).reverse().map(item => item.number) // Actually least due (most frequent)
            };
        }

        function applyPatternStrategy() {
            // This is a simplified pattern recognition strategy
            // In a real application, this would use more sophisticated pattern detection
            
            const mainPool = lotteryConfigs[document.getElementById('history-game').value].mainPool;
            
            // Analyze last digits
            const lastDigitCounts = Array(10).fill(0);
            historicalData.forEach(draw => {
                draw.numbers.forEach(n => lastDigitCounts[n % 10]++);
            });
            
            // Find most common last digits
            const lastDigitStats = lastDigitCounts.map((count, digit) => ({ digit, count }))
                .sort((a, b) => b.count - a.count);
            const commonLastDigits = lastDigitStats.slice(0, 3).map(item => item.digit);
            
            // Analyze number ranges (low, medium, high)
            const rangeSize = Math.floor(mainPool / 3);
            const rangeCounts = Array(3).fill(0);
            historicalData.forEach(draw => {
                draw.numbers.forEach(n => {
                    if (n <= rangeSize) rangeCounts[0]++;
                    else if (n <= rangeSize * 2) rangeCounts[1]++;
                    else rangeCounts[2]++;
                });
            });
            
            // Find most common range
            const mostCommonRange = rangeCounts.indexOf(Math.max(...rangeCounts));
            
            // Generate recommended numbers based on detected patterns
            const recommendedSets = [];
            for (let i = 0; i < 5; i++) {
                const set = [];
                const pool = Array.from({ length: mainPool }, (_, i) => i + 1)
                    .filter(n => {
                        // Prefer numbers with common last digits
                        if (commonLastDigits.includes(n % 10)) return true;
                        // And numbers in the most common range
                        if (mostCommonRange === 0 && n <= rangeSize) return true;
                        if (mostCommonRange === 1 && n > rangeSize && n <= rangeSize * 2) return true;
                        if (mostCommonRange === 2 && n > rangeSize * 2) return true;
                        return false;
                    });
                
                while (set.length < lotteryConfigs[document.getElementById('history-game').value].mainPick && pool.length > 0) {
                    const index = Math.floor(Math.random() * pool.length);
                    const num = pool[index];
                    if (!set.includes(num)) {
                        set.push(num);
                    }
                    pool.splice(index, 1);
                }
                
                set.sort((a, b) => a - b);
                recommendedSets.push(set);
            }
            
            return {
                strategy: 'Pattern Recognition',
                description: 'Recommends numbers based on detected patterns in historical data, including last digit distribution and number range preferences.',
                recommendedNumbers: recommendedSets,
                commonLastDigits,
                rangeDistribution: rangeCounts.map((count, i) => ({
                    range: i === 0 ? `1-${rangeSize}` : i === 1 ? `${rangeSize + 1}-${rangeSize * 2}` : `${rangeSize * 2 + 1}-${mainPool}`,
                    count,
                    percentage: (count / (historicalData.length * lotteryConfigs[document.getElementById('history-game').value].mainPick) * 100).toFixed(1) + '%'
                }))
            };
        }

        function buildCustomStrategy() {
            const components = Array.from(document.querySelectorAll('input[name="strategy-component"]:checked')).map(el => el.value);
            if (components.length === 0) {
                showNotification('Please select at least one strategy component', 'error');
                return;
            }
            
            const weights = {
                frequency: parseInt(document.getElementById('frequency-weight').value),
                gap: parseInt(document.getElementById('gap-weight').value),
                pattern: parseInt(document.getElementById('pattern-weight').value),
                other: parseInt(document.getElementById('other-weight').value)
            };
            
            // In a real application, this would combine the strategies based on weights
            // For this demo, we'll just show a message and apply a combined strategy
            
            const results = {
                strategy: 'Custom Strategy',
                description: `Combines ${components.join(', ')} with weights: Frequency (${weights.frequency}%), Gap (${weights.gap}%), Pattern (${weights.pattern}%), Other (${weights.other}%).`,
                recommendedNumbers: []
            };
            
            // Generate some "recommended" numbers based on the selected components
            const freqResults = components.includes('frequency') ? applyFrequencyStrategy() : null;
            const gapResults = components.includes('gap') ? applyGapStrategy() : null;
            const patternResults = components.includes('pattern') ? applyPatternStrategy() : null;
            
            // Combine recommendations (simplified for demo)
            const allNumbers = [];
            if (freqResults) allNumbers.push(...freqResults.hotNumbers);
            if (gapResults) allNumbers.push(...gapResults.dueNumbers);
            if (patternResults) {
                // For pattern, just pick some numbers that match the common patterns
                const mainPool = lotteryConfigs[document.getElementById('history-game').value].mainPool;
                const rangeSize = Math.floor(mainPool / 3);
                const commonDigits = patternResults.commonLastDigits;
                
                for (let i = 1; i <= mainPool; i++) {
                    if (commonDigits.includes(i % 10)) {
                        allNumbers.push(i);
                    }
                }
            }
            
            // Generate 5 recommended sets
            for (let i = 0; i < 5; i++) {
                const set = [];
                const pool = [...allNumbers];
                
                while (set.length < lotteryConfigs[document.getElementById('history-game').value].mainPick && pool.length > 0) {
                    const index = Math.floor(Math.random() * pool.length);
                    const num = pool[index];
                    if (!set.includes(num)) {
                        set.push(num);
                    }
                    pool.splice(index, 1);
                }
                
                set.sort((a, b) => a - b);
                results.recommendedNumbers.push(set);
            }
            
            renderStrategyResults(results);
            showNotification('Custom strategy applied successfully', 'success');
        }

        function renderStrategyResults(results, strategyType) {
            const container = document.getElementById('strategy-results');
            container.innerHTML = '';
            
            // Strategy overview
            const overviewCard = document.createElement('div');
            overviewCard.className = 'bg-white dark:bg-gray-700 p-4 rounded-lg shadow';
            overviewCard.innerHTML = `
                <h4 class="text-lg font-bold mb-2">${results.strategy}</h4>
                <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">${results.description}</p>
                ${strategyType === 'frequency' ? `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h5 class="font-medium mb-1">Top 10 Hot Numbers</h5>
                            <div class="flex flex-wrap gap-1">
                                ${results.hotNumbers.map(n => `<span class="number-ball hot-number">${n}</span>`).join('')}
                            </div>
                        </div>
                        <div>
                            <h5 class="font-medium mb-1">Top 10 Cold Numbers</h5>
                            <div class="flex flex-wrap gap-1">
                                ${results.coldNumbers.map(n => `<span class="number-ball cold-number">${n}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                ` : ''}
                ${strategyType === 'gap' ? `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h5 class="font-medium mb-1">Top 10 Due Numbers</h5>
                            <div class="flex flex-wrap gap-1">
                                ${results.dueNumbers.map(n => `<span class="number-ball due-number">${n}</span>`).join('')}
                            </div>
                        </div>
                        <div>
                            <h5 class="font-medium mb-1">Top 10 Frequent Numbers</h5>
                            <div class="flex flex-wrap gap-1">
                                ${results.frequentNumbers.map(n => `<span class="number-ball hot-number">${n}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                ` : ''}
                ${strategyType === 'pattern' ? `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h5 class="font-medium mb-1">Most Common Last Digits</h5>
                            <div class="flex flex-wrap gap-1">
                                ${results.commonLastDigits.map(d => `<span class="number-ball main-ball">${d}</span>`).join('')}
                            </div>
                        </div>
                        <div>
                            <h5 class="font-medium mb-1">Number Range Distribution</h5>
                            <div class="text-sm">
                                ${results.rangeDistribution.map(r => `${r.range}: ${r.count} (${r.percentage})`).join('<br>')}
                            </div>
                        </div>
                    </div>
                ` : ''}
            `;
            container.appendChild(overviewCard);
            
            // Recommended numbers
            const recCard = document.createElement('div');
            recCard.className = 'bg-white dark:bg-gray-700 p-4 rounded-lg shadow';
            recCard.innerHTML = `
                <h4 class="text-lg font-bold mb-2">Recommended Number Sets</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                    ${results.recommendedNumbers.map((set, i) => `
                        <div class="bg-gray-100 dark:bg-gray-600 p-3 rounded-lg">
                            <h5 class="font-medium text-center mb-2">Set ${i + 1}</h5>
                            <div class="flex flex-wrap justify-center gap-1">
                                ${set.map(n => `<span class="number-ball main-ball">${n}</span>`).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div class="mt-4 flex justify-center">
                    <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition" onclick="useRecommendedNumbers()">
                        Use These Numbers in Generator
                    </button>
                </div>
            `;
            container.appendChild(recCard);
        }

        function useRecommendedNumbers() {
            // This would transfer the recommended numbers to the generator tab
            // For this demo, we'll just show a message
            showNotification('Recommended numbers can now be used in the Smart Generator tab', 'success');
            openTab('smart-generator');
        }

        function calculateProbability() {
            const game = document.getElementById('probability-game').value;
            const config = lotteryConfigs[game];
            const mainPool = parseInt(document.getElementById('prob-main-pool').value) || config.mainPool;
            const mainPick = parseInt(document.getElementById('prob-main-pick').value) || config.mainPick;
            const bonusPool = parseInt(document.getElementById('prob-bonus-pool').value) || config.bonusPool;
            const bonusPick = parseInt(document.getElementById('prob-bonus-pick').value) || config.bonusPick;
            const numTickets = parseInt(document.getElementById('prob-tickets').value) || 1;
            
            // Calculate combinations
            const mainCombinations = math.combinations(mainPool, mainPick);
            const bonusCombinations = bonusPick > 0 ? math.combinations(bonusPool, bonusPick) : 1;
            const totalCombinations = mainCombinations * bonusCombinations;
            
            // Basic probabilities
            const jackpotProb = 1 / totalCombinations;
            const jackpotWithTickets = 1 - Math.pow(1 - jackpotProb, numTickets);
            
            // For games with bonus numbers, calculate partial matches
            let partialProbs = [];
            if (bonusPick > 0) {
                for (let m = 0; m <= mainPick; m++) {
                    for (let b = 0; b <= bonusPick; b++) {
                        if (m === mainPick && b === bonusPick) continue; // Jackpot already calculated
                        
                        const prob = (math.combinations(mainPick, m) * math.combinations(mainPool - mainPick, mainPick - m)) / mainCombinations *
                                     (math.combinations(bonusPick, b) * math.combinations(bonusPool - bonusPick, bonusPick - b)) / bonusCombinations;
                        
                        if (prob > 0) {
                            partialProbs.push({
                                match: `${m}/${mainPick} + ${b}/${bonusPick}`,
                                probability: prob,
                                oneIn: 1 / prob
                            });
                        }
                    }
                }
            } else {
                for (let m = 0; m < mainPick; m++) {
                    const prob = math.combinations(mainPick, m) * math.combinations(mainPool - mainPick, mainPick - m) / mainCombinations;
                    partialProbs.push({
                        match: `${m}/${mainPick}`,
                        probability: prob,
                        oneIn: 1 / prob
                    });
                }
            }
            
            // Sort partial probabilities by likelihood
            partialProbs.sort((a, b) => b.probability - a.probability);
            
            // Store results
            const probResults = {
                game,
                config: { mainPool, mainPick, bonusPool, bonusPick },
                numTickets,
                jackpotProb,
                jackpotWithTickets,
                partialProbs,
                totalCombinations,
                timestamp: new Date().toISOString()
            };
            
            renderProbabilityResults(probResults);
            showNotification('Probability calculation completed', 'success');
        }

        function renderProbabilityResults(results) {
            document.getElementById('probability-results').classList.remove('hidden');
            
            // Basic probabilities
            document.getElementById('basic-probabilities').innerHTML = `
                <div class="grid grid-cols-2 gap-2">
                    <div>Total Combinations:</div>
                    <div class="font-medium">${results.totalCombinations.toLocaleString()}</div>
                    <div>Jackpot Probability:</div>
                    <div class="font-medium">1 in ${(1 / results.jackpotProb).toLocaleString()}</div>
                    <div>With ${results.numTickets} ticket(s):</div>
                    <div class="font-medium">${(results.jackpotWithTickets * 100).toFixed(10)}% chance</div>
                </div>
            `;
            
            // Winning chances
            let partialsHtml = '<div class="grid grid-cols-3 gap-2">';
            partialsHtml += '<div class="font-medium">Match</div><div class="font-medium">Probability</div><div class="font-medium">1 in</div>';
            
            results.partialProbs.forEach(prob => {
                partialsHtml += `
                    <div>${prob.match}</div>
                    <div>${(prob.probability * 100).toFixed(6)}%</div>
                    <div>${prob.oneIn.toLocaleString(undefined, { maximumFractionDigits: 1 })}</div>
                `;
            });
            
            partialsHtml += '</div>';
            document.getElementById('winning-chances').innerHTML = partialsHtml;
            
            // Render charts
            renderProbabilityCharts(results);
            
            // Initialize expected value
            updateExpectedValue();
        }

        function renderProbabilityCharts(results) {
            // Probability distribution chart
            const labels = ['Jackpot', ...results.partialProbs.map(p => p.match)];
            const data = [results.jackpotProb, ...results.partialProbs.map(p => p.probability)];
            
            // Convert to logarithmic scale for better visualization
            const logData = data.map(d => Math.log10(d));
            const minLog = Math.min(...logData);
            const maxLog = Math.max(...logData);
            
            updateChart('probability-chart', {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Probability (log scale)',
                        data: logData,
                        backgroundColor: 'rgba(79, 70, 229, 0.7)',
                        borderColor: 'rgba(79, 70, 229, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: ctx => {
                                    const value = Math.pow(10, ctx.raw);
                                    return `${labels[ctx.dataIndex]}: ${value.toExponential(4)} (1 in ${(1/value).toLocaleString(undefined, { maximumFractionDigits: 1 })})`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: minLog - 1,
                            max: maxLog + 1,
                            ticks: {
                                callback: value => `10^${value}`
                            }
                        }
                    }
                }
            });
        }

        function updateExpectedValue() {
            const jackpot = parseFloat(document.getElementById('jackpot-value').value) || 0;
            const taxRate = parseFloat(document.getElementById('tax-value').value) || 0;
            
            if (!document.getElementById('probability-results').classList.contains('hidden')) {
                const jackpotProb = 1 / (1 / analysisResults.jackpotProb); // Get from results
                const netJackpot = jackpot * (1 - taxRate / 100);
                const expectedValue = netJackpot * jackpotProb;
                
                document.getElementById('expected-value').textContent = `$${expectedValue.toFixed(2)}`;
                document.getElementById('ev-explanation').textContent = 
                    `Based on jackpot of $${jackpot.toLocaleString()} after ${taxRate}% tax and winning probability`;
            } else {
                document.getElementById('expected-value').textContent = '$0.00';
                document.getElementById('ev-explanation').textContent = 'Calculate probabilities first';
            }
        }

        function resetProbability() {
            document.getElementById('probability-results').classList.add('hidden');
            document.getElementById('probability-results-container').innerHTML = `
                <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg text-center">
                    <p class="text-gray-500 dark:text-gray-300">Calculate probabilities to see results</p>
                </div>
            `;
        }

        function exportProbability(format) {
            // Similar to other export functions
            showNotification('Export feature would save probability report here', 'info');
        }

        function predictNextDraw() {
            if (historicalData.length === 0) {
                showNotification('Please load historical data first', 'error');
                return;
            }
            
            // Simulate AI prediction - in a real app this would use actual ML models
            const game = document.getElementById('history-game').value;
            const config = lotteryConfigs[game];
            const mainPool = config.mainPool;
            
            // Get frequency data
            const frequencyMap = Array(mainPool).fill(0);
            historicalData.forEach(draw => {
                draw.numbers.forEach(n => frequencyMap[n - 1]++);
            });
            
            // Get gap data (time since last appearance)
            const lastSeen = {};
            historicalData.forEach((draw, index) => {
                draw.numbers.forEach(n => lastSeen[n] = index);
            });
            
            const currentDrawIndex = historicalData.length;
            const gaps = frequencyMap.map((_, index) => currentDrawIndex - (lastSeen[index + 1] || 0));
            
            // Combine factors (frequency and gap) to generate "predictions"
            const scores = frequencyMap.map((count, index) => {
                const normalizedFreq = count / historicalData.length;
                const normalizedGap = gaps[index] / currentDrawIndex;
                
                // Higher score for frequent numbers that haven't appeared recently
                return {
                    number: index + 1,
                    score: normalizedFreq * Math.pow(normalizedGap, 0.5) // Weight gap less than frequency
                };
            });
            
            // Sort by score
            scores.sort((a, b) => b.score - a.score);
            
            // Generate prediction results
            const predictionResults = {
                type: 'Next Draw Prediction',
                predictedNumbers: scores.slice(0, config.mainPick).map(item => item.number).sort((a, b) => a - b),
                confidenceScores: scores.slice(0, config.mainPick).map(item => ({
                    number: item.number,
                    score: (item.score / scores[0].score * 100).toFixed(1) + '%' // Relative to top score
                })),
                analysis: `Based on ${historicalData.length} historical draws, these numbers combine frequency and "due-ness" factors.`,
                timestamp: new Date().toISOString()
            };
            
            renderPredictionResults(predictionResults);
            showNotification('Next draw prediction generated', 'success');
        }

        function predictMultipleDraws() {
            if (historicalData.length === 0) {
                showNotification('Please load historical data first', 'error');
                return;
            }
            
            const game = document.getElementById('history-game').value;
            const config = lotteryConfigs[game];
            
            // Generate predictions for 5 draws (simulated)
            const allPredictions = [];
            for (let i = 0; i < 5; i++) {
                // Each "prediction" is slightly different
                const prediction = generateRandomPrediction(config.mainPool, config.mainPick, i);
                allPredictions.push({
                    draw: i + 1,
                    numbers: prediction.numbers,
                    confidence: prediction.confidence
                });
            }
            
            const predictionResults = {
                type: 'Multiple Draw Forecast',
                predictions: allPredictions,
                analysis: `Forecast for next 5 draws based on historical patterns and trends. Confidence scores indicate relative strength of prediction.`,
                timestamp: new Date().toISOString()
            };
            
            renderMultiPredictionResults(predictionResults);
            showNotification('Multiple draw forecast generated', 'success');
        }

        function generateRandomPrediction(mainPool, mainPick, offset) {
            // This is a simulation - real AI would use actual models
            const baseNumbers = Array.from({ length: mainPool }, (_, i) => i + 1);
            
            // Simulate some numbers being more likely
            const weightedNumbers = [];
            for (let i = 0; i < baseNumbers.length; i++) {
                // Make numbers divisible by (offset + 2) more likely to simulate a "pattern"
                const weight = (i + 1) % (offset + 2) === 0 ? 3 : 1;
                for (let j = 0; j < weight; j++) {
                    weightedNumbers.push(i + 1);
                }
            }
            
            // Pick numbers
            const prediction = [];
            const pool = [...weightedNumbers];
            
            while (prediction.length < mainPick && pool.length > 0) {
                const index = Math.floor(Math.random() * pool.length);
                const num = pool[index];
                if (!prediction.includes(num)) {
                    prediction.push(num);
                }
                pool.splice(index, 1);
            }
            
            return {
                numbers: prediction.sort((a, b) => a - b),
                confidence: (70 + Math.random() * 25).toFixed(1) + '%' // Random confidence 70-95%
            };
        }

        function showCustomPredictionModal() {
            document.getElementById('custom-prediction-modal').classList.remove('hidden');
        }

        function runCustomPrediction() {
            const model = document.getElementById('prediction-model').value;
            const historyRange = document.getElementById('history-range').value;
            const numPredictions = parseInt(document.getElementById('num-predictions').value) || 5;
            
            // Close modal
            document.getElementById('custom-prediction-modal').classList.add('hidden');
            
            // Simulate prediction based on settings
            const game = document.getElementById('history-game').value || 'powerball';
            const config = lotteryConfigs[game];
            
            const predictions = [];
            for (let i = 0; i < numPredictions; i++) {
                predictions.push(generateRandomPrediction(config.mainPool, config.mainPick, i));
            }
            
            const predictionResults = {
                type: `Custom Prediction (${model} model)`,
                predictions: predictions.map((pred, i) => ({
                    draw: i + 1,
                    numbers: pred.numbers,
                    confidence: pred.confidence
                })),
                analysis: `Custom prediction using ${model} model with ${historyRange} year(s) of historical data.`,
                timestamp: new Date().toISOString()
            };
            
            renderMultiPredictionResults(predictionResults);
            showNotification('Custom prediction completed', 'success');
        }

        function renderPredictionResults(results) {
            document.getElementById('prediction-results').classList.remove('hidden');
            
            // Predicted numbers
            document.getElementById('predicted-numbers').innerHTML = 
                results.predictedNumbers.map(n => `<span class="number-ball main-ball animate-pulse">${n}</span>`).join('');
            
            // Confidence scores
            document.getElementById('confidence-scores').innerHTML = `
                <div class="grid grid-cols-2 gap-2">
                    ${results.confidenceScores.map(cs => `
                        <div>#${cs.number}</div>
                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5">
                            <div class="bg-blue-600 h-2.5 rounded-full" style="width: ${cs.score}"></div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Prediction analysis
            document.getElementById('prediction-analysis').innerHTML = `
                <p class="mb-2">${results.analysis}</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Generated on ${new Date(results.timestamp).toLocaleString()}</p>
            `;
            
            // Render chart
            renderPredictionChart(results);
        }

        function renderMultiPredictionResults(results) {
            document.getElementById('prediction-results').classList.remove('hidden');
            
            // Predicted numbers
            document.getElementById('predicted-numbers').innerHTML = `
                <div class="space-y-4">
                    ${results.predictions.map(pred => `
                        <div>
                            <h5 class="font-medium mb-1">Draw ${pred.draw}</h5>
                            <div class="flex flex-wrap gap-1 mb-1">
                                ${pred.numbers.map(n => `<span class="number-ball main-ball">${n}</span>`).join('')}
                            </div>
                            <div class="text-sm text-gray-600 dark:text-gray-300">Confidence: ${pred.confidence}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Confidence scores
            document.getElementById('confidence-scores').innerHTML = `
                <div class="space-y-2">
                    ${results.predictions.map(pred => `
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>Draw ${pred.draw}</span>
                                <span>${pred.confidence}</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2.5">
                                <div class="bg-blue-600 h-2.5 rounded-full" style="width: ${pred.confidence}"></div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Prediction analysis
            document.getElementById('prediction-analysis').innerHTML = `
                <p class="mb-2">${results.analysis}</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Generated on ${new Date(results.timestamp).toLocaleString()}</p>
            `;
            
            // Render chart
            renderMultiPredictionChart(results);
        }

        function renderPredictionChart(results) {
            updateChart('prediction-chart', {
                type: 'radar',
                data: {
                    labels: results.confidenceScores.map(cs => `#${cs.number}`),
                    datasets: [{
                        label: 'Confidence Score',
                        data: results.confidenceScores.map(cs => parseFloat(cs.score)),
                        backgroundColor: 'rgba(79, 70, 229, 0.2)',
                        borderColor: 'rgba(79, 70, 229, 1)',
                        pointBackgroundColor: 'rgba(79, 70, 229, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(79, 70, 229, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        r: {
                            angleLines: { display: true },
                            suggestedMin: 0,
                            suggestedMax: 100
                        }
                    }
                }
            });
        }

        function renderMultiPredictionChart(results) {
            const numbers = new Set();
            results.predictions.forEach(pred => {
                pred.numbers.forEach(n => numbers.add(n));
            });
            
            const numberList = Array.from(numbers).sort((a, b) => a - b);
            const datasets = results.predictions.map((pred, i) => {
                const data = numberList.map(n => pred.numbers.includes(n) ? 100 : 0);
                const color = `hsl(${i * (360 / results.predictions.length)}, 70%, 50%)`;
                
                return {
                    label: `Draw ${pred.draw}`,
                    data: data,
                    backgroundColor: color.replace(')', ', 0.2)').replace('hsl', 'hsla'),
                    borderColor: color.replace(')', ', 1)').replace('hsl', 'hsla'),
                    pointBackgroundColor: color.replace(')', ', 1)').replace('hsl', 'hsla'),
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: color.replace(')', ', 1)').replace('hsl', 'hsla')
                };
            });
            
            updateChart('prediction-chart', {
                type: 'radar',
                data: {
                    labels: numberList.map(n => `#${n}`),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    scales: {
                        r: {
                            angleLines: { display: true },
                            suggestedMin: 0,
                            suggestedMax: 100
                        }
                    }
                }
            });
        }

        function exportPredictions(format) {
            // Similar to other export functions
            showNotification('Export feature would save prediction results here', 'info');
        }

        function reverseEngineerSeed() {
            const numbersInput = document.getElementById('generated-numbers').value.trim();
            if (!numbersInput) {
                showNotification('Please enter numbers to analyze', 'error');
                return;
            }
            
            const game = document.getElementById('reverse-game').value;
            const config = lotteryConfigs[game];
            const method = document.getElementById('reverse-method').value;
            const expectedCount = config.mainPick + config.bonusPick;
            
            // Parse numbers
            const numbers = numbersInput.split(/[,;\s-]+/).map(n => parseInt(n.trim())).filter(n => !isNaN(n));
            if (numbers.length !== expectedCount) {
                showNotification(`Please enter exactly ${expectedCount} numbers`, 'error');
                return;
            }
            
            // Validate number ranges
            const invalidMain = numbers.slice(0, config.mainPick).find(n => n < 1 || n > config.mainPool);
            const invalidBonus = config.bonusPick > 0 ? numbers.slice(config.mainPick).find(n => n < 1 || n > config.bonusPool) : null;
            
            if (invalidMain || invalidBonus) {
                showNotification(`Numbers must be between 1-${config.mainPool} (main) and ${config.bonusPool ? `1-${config.bonusPool} (bonus)` : 'no bonus'}`, 'error');
                return;
            }
            
            const mainNumbers = numbers.slice(0, config.mainPick).sort((a, b) => a - b);
            const bonusNumbers = config.bonusPick > 0 ? numbers.slice(config.mainPick).sort((a, b) => a - b) : [];
            
            // Try to find possible seeds (simulated - in reality this would be more complex)
            const possibleSeeds = [];
            const maxAttempts = 10000; // Limit for performance
            
            for (let seed = 1; seed <= maxAttempts; seed++) {
                let seedValue = seed;
                
                function seededRandom() {
                    seedValue = (seedValue * 9301 + 49297) % 233280;
                    return seedValue / 233280;
                }
                
                let generated = [];
                let pool = Array.from({ length: config.mainPool }, (_, i) => i + 1);
                
                if (method === 'fisher-yates') {
                    for (let j = pool.length - 1; j > 0; j--) {
                        const k = Math.floor(seededRandom() * (j + 1));
                        [pool[j], pool[k]] = [pool[k], pool[j]];
                    }
                    generated = pool.slice(0, config.mainPick).sort((a, b) => a - b);
                } else if (method === 'low-high') {
                    const low = pool.slice(0, Math.floor(pool.length / 2));
                    const high = pool.slice(Math.floor(pool.length / 2));
                    
                    for (let j = 0; j < Math.ceil(config.mainPick / 2); j++) {
                        const index = Math.floor(seededRandom() * low.length);
                        generated.push(low.splice(index, 1)[0]);
                    }
                    for (let j = 0; j < Math.floor(config.mainPick / 2); j++) {
                        const index = Math.floor(seededRandom() * high.length);
                        generated.push(high.splice(index, 1)[0]);
                    }
                    generated.sort((a, b) => a - b);
                } else if (method === 'odd-even') {
                    const odd = pool.filter(n => n % 2 !== 0);
                    const even = pool.filter(n => n % 2 === 0);
                    
                    for (let j = 0; j < Math.floor(config.mainPick / 2); j++) {
                        const index = Math.floor(seededRandom() * odd.length);
                        generated.push(odd.splice(index, 1)[0]);
                    }
                    for (let j = 0; j < Math.ceil(config.mainPick / 2); j++) {
                        const index = Math.floor(seededRandom() * even.length);
                        generated.push(even.splice(index, 1)[0]);
                    }
                    generated.sort((a, b) => a - b);
                } else {
                    for (let j = 0; j < config.mainPick; j++) {
                        const index = Math.floor(seededRandom() * pool.length);
                        generated.push(pool.splice(index, 1)[0]);
                    }
                    generated.sort((a, b) => a - b);
                }
                
                if (config.bonusPick > 0) {
                    pool = Array.from({ length: config.bonusPool }, (_, i) => i + 1);
                    for (let j = 0; j < config.bonusPick; j++) {
                        const index = Math.floor(seededRandom() * pool.length);
                        generated.push(pool.splice(index, 1)[0]);
                    }
                }
                
                if (generated.every((n, i) => n === numbers[i])) {
                    possibleSeeds.push(seed);
                    if (possibleSeeds.length >= 5) break;
                }
            }
            
            // Store results
            const reverseResults = {
                inputNumbers: numbers,
                mainNumbers,
                bonusNumbers,
                possibleSeeds,
                method,
                attempts: maxAttempts,
                timestamp: new Date().toISOString()
            };
            
            renderReverseResults(reverseResults);
            
            if (possibleSeeds.length > 0) {
                showNotification(`Found ${possibleSeeds.length} possible seed(s)`, 'success');
            } else {
                showNotification(`No matching seeds found in ${maxAttempts} attempts`, 'error');
            }
        }

        function renderReverseResults(results) {
            document.getElementById('seed-results').classList.remove('hidden');
            
            // Possible seeds
            document.getElementById('possible-seeds').innerHTML = results.possibleSeeds.length > 0
                ? results.possibleSeeds.map(seed => `<div class="mb-1"><span class="font-medium">${seed}</span> - <button class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300" onclick="testSeed(${seed})">Test</button></div>`).join('')
                : `No matching seeds found in ${results.attempts} attempts.`;
            
            // Seed validation
            document.getElementById('seed-validation').innerHTML = `
                <div class="grid grid-cols-2 gap-2">
                    <div>Input Numbers:</div>
                    <div class="font-medium">${results.inputNumbers.join(', ')}</div>
                    <div>Generation Method:</div>
                    <div class="font-medium">${results.method}</div>
                    <div>Seed Attempts:</div>
                    <div class="font-medium">${results.attempts}</div>
                    <div>Possible Seeds:</div>
                    <div class="font-medium">${results.possibleSeeds.length}</div>
                </div>
            `;
            
            // Seed test table
            const tableBody = document.getElementById('seed-test-body');
            tableBody.innerHTML = '';
            
            if (results.possibleSeeds.length > 0) {
                // Test first 3 seeds
                const seedsToTest = results.possibleSeeds.slice(0, 3);
                
                seedsToTest.forEach(seed => {
                    const row = document.createElement('tr');
                    
                    const seedCell = document.createElement('td');
                    seedCell.className = 'px-4 py-2 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400';
                    seedCell.textContent = seed;
                    
                    const numbersCell = document.createElement('td');
                    numbersCell.className = 'px-4 py-2 whitespace-nowrap text-sm';
                    
                    // Generate numbers with this seed
                    const generated = generateNumbersWithSeed(seed, results.method, lotteryConfigs[document.getElementById('reverse-game').value]);
                    numbersCell.innerHTML = generated.mainNumbers.map(n => `<span class="number-ball main-ball">${n}</span>`).join('') +
                        (generated.bonusNumbers.length > 0 ? ' + ' + generated.bonusNumbers.map(n => `<span class="number-ball bonus-ball">${n}</span>`).join('') : '');
                    
                    const matchCell = document.createElement('td');
                    matchCell.className = 'px-4 py-2 whitespace-nowrap text-sm';
                    
                    const isMatch = generated.mainNumbers.every((n, i) => n === results.mainNumbers[i]) &&
                        (generated.bonusNumbers.length === 0 || generated.bonusNumbers.every((n, i) => n === results.bonusNumbers[i]));
                    
                    matchCell.innerHTML = isMatch 
                        ? '<span class="text-green-600 dark:text-green-400">‚úì Match</span>'
                        : '<span class="text-red-600 dark:text-red-400">‚úó No Match</span>';
                    
                    row.appendChild(seedCell);
                    row.appendChild(numbersCell);
                    row.appendChild(matchCell);
                    tableBody.appendChild(row);
                });
            }
            
            // Seed analysis
            document.getElementById('seed-analysis').innerHTML = `
                <p class="mb-2">Seed reverse engineering attempts to find the random seed that would generate the specified numbers using the selected generation method.</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Analysis performed on ${new Date(results.timestamp).toLocaleString()}</p>
            `;
        }

        function generateNumbersWithSeed(seed, method, config) {
            let seedValue = seed;
            
            function seededRandom() {
                seedValue = (seedValue * 9301 + 49297) % 233280;
                return seedValue / 233280;
            }
            
            const mainNumbers = [];
            let bonusNumbers = [];
            let pool = Array.from({ length: config.mainPool }, (_, i) => i + 1);
            
            if (method === 'fisher-yates') {
                for (let j = pool.length - 1; j > 0; j--) {
                    const k = Math.floor(seededRandom() * (j + 1));
                    [pool[j], pool[k]] = [pool[k], pool[j]];
                }
                mainNumbers.push(...pool.slice(0, config.mainPick).sort((a, b) => a - b));
            } else if (method === 'low-high') {
                const low = pool.slice(0, Math.floor(pool.length / 2));
                const high = pool.slice(Math.floor(pool.length / 2));
                
                for (let j = 0; j < Math.ceil(config.mainPick / 2); j++) {
                    const index = Math.floor(seededRandom() * low.length);
                    mainNumbers.push(low.splice(index, 1)[0]);
                }
                for (let j = 0; j < Math.floor(config.mainPick / 2); j++) {
                    const index = Math.floor(seededRandom() * high.length);
                    mainNumbers.push(high.splice(index, 1)[0]);
                }
                mainNumbers.sort((a, b) => a - b);
            } else if (method === 'odd-even') {
                const odd = pool.filter(n => n % 2 !== 0);
                const even = pool.filter(n => n % 2 === 0);
                
                for (let j = 0; j < Math.floor(config.mainPick / 2); j++) {
                    const index = Math.floor(seededRandom() * odd.length);
                    mainNumbers.push(odd.splice(index, 1)[0]);
                }
                for (let j = 0; j < Math.ceil(config.mainPick / 2); j++) {
                    const index = Math.floor(seededRandom() * even.length);
                    mainNumbers.push(even.splice(index, 1)[0]);
                }
                mainNumbers.sort((a, b) => a - b);
            } else {
                for (let j = 0; j < config.mainPick; j++) {
                    const index = Math.floor(seededRandom() * pool.length);
                    mainNumbers.push(pool.splice(index, 1)[0]);
                }
                mainNumbers.sort((a, b) => a - b);
            }
            
            if (config.bonusPick > 0) {
                pool = Array.from({ length: config.bonusPool }, (_, i) => i + 1);
                for (let j = 0; j < config.bonusPick; j++) {
                    const index = Math.floor(seededRandom() * pool.length);
                    bonusNumbers.push(pool.splice(index, 1)[0]);
                }
                bonusNumbers.sort((a, b) => a - b);
            }
            
            return { mainNumbers, bonusNumbers };
        }

        function testSeed(seed) {
            const method = document.getElementById('reverse-method').value;
            const game = document.getElementById('reverse-game').value;
            const config = lotteryConfigs[game];
            
            const generated = generateNumbersWithSeed(seed, method, config);
            const numbersStr = generated.mainNumbers.join(', ') + 
                (generated.bonusNumbers.length > 0 ? ', ' + generated.bonusNumbers.join(', ') : '');
            
            showNotification(`Seed ${seed} generates: ${numbersStr}`, 'info');
        }

        function clearReverse() {
            document.getElementById('generated-numbers').value = '';
            document.getElementById('seed-results').classList.add('hidden');
            document.getElementById('seed-results-container').innerHTML = `
                <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg text-center">
                    <p class="text-gray-500 dark:text-gray-300">Enter numbers to see potential seed results</p>
                </div>
            `;
        }

        function exportSeedResults(format) {
            // Similar to other export functions
            showNotification('Export feature would save seed analysis here', 'info');
        }

        function generateWheelingSystem() {
            const game = document.getElementById('lottery-game').value;
            const config = lotteryConfigs[game];
            const mainPool = parseInt(document.getElementById('main-pool').value) || config.mainPool;
            const mainPick = parseInt(document.getElementById('main-pick').value) || config.mainPick;
            
            // Simple wheeling system - in reality this would be more sophisticated
            const wheelSize = Math.min(12, mainPool);
            const numbers = Array.from({ length: wheelSize }, (_, i) => i + 1);
            
            // Generate tickets that cover all combinations with a certain coverage
            const tickets = [];
            
            // This is a simplified example - real wheeling systems are more complex
            for (let i = 0; i < numbers.length - mainPick + 1; i++) {
                const ticket = numbers.slice(i, i + mainPick);
                if (ticket.length === mainPick) {
                    tickets.push({
                        mainNumbers: [...ticket],
                        bonusNumbers: [],
                        ticketNumber: i + 1
                    });
                }
            }
            
            // Add some random tickets to fill out the wheel
            while (tickets.length < 8) {
                const ticket = [];
                const pool = [...numbers];
                
                while (ticket.length < mainPick && pool.length > 0) {
                    const index = Math.floor(Math.random() * pool.length);
                    ticket.push(pool.splice(index, 1)[0]);
                }
                
                tickets.push({
                    mainNumbers: ticket.sort((a, b) => a - b),
                    bonusNumbers: [],
                    ticketNumber: tickets.length + 1
                });
            }
            
            generatedTickets = tickets;
            renderGeneratedTickets();
            showNotification(`Generated wheeling system with ${tickets.length} tickets`, 'success');
        }
    </script>
</body>
</html>
